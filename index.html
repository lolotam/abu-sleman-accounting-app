<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام أبو سليمان للمحاسبة</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background-color: #f5f5f5;
        }

        .login-container {
            width: 400px;
            margin: 100px auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }

        .app-title {
            color: #009688;
            margin-bottom: 10px;
        }

        .app-subtitle {
            color: #757575;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .btn {
            background-color: #009688;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #00796b;
        }

        .error-message {
            color: #f44336;
            margin-top: 20px;
            display: none;
        }

        .version {
            margin-top: 20px;
            color: #757575;
            font-size: 12px;
        }

        /* Dashboard Styles */
        .dashboard-container {
            display: none;
            width: 100%;
            height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: #00796b;
            color: white;
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            padding-top: 20px;
        }

        .sidebar-header {
            padding: 0 20px 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: bold;
        }

        .sidebar-subtitle {
            opacity: 0.8;
            font-size: 14px;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }

        .menu-item:hover, .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item i {
            margin-left: 10px;
            font-size: 18px;
        }

        .content {
            margin-right: 250px;
            padding: 20px;
        }

        .page-title {
            font-size: 24px;
            color: #009688;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            flex: 1;
            min-width: 200px;
        }

        .card-title {
            color: #757575;
            font-size: 16px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 24px;
            font-weight: bold;
            color: #009688;
            margin-bottom: 10px;
        }

        .card-footer {
            font-size: 12px;
            color: #4caf50;
        }

        .transactions-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .transactions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .transactions-title {
            font-size: 18px;
            color: #333;
        }

        .view-all {
            color: #009688;
            cursor: pointer;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: right;
            padding: 10px;
            border-bottom: 2px solid #eee;
            color: #757575;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .status-paid {
            color: #4caf50;
        }

        .status-pending {
            color: #ff9800;
        }

        .actions-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            background-color: white;
            border: 1px solid #009688;
            color: #009688;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
        }

        .action-btn:hover {
            background-color: #e0f2f1;
        }

        .action-btn i {
            margin-left: 5px;
        }

        /* Data Tables Styles */
        .page-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .primary-btn {
            background-color: #009688;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .primary-btn i {
            margin-left: 8px;
        }

        .secondary-btn {
            background-color: white;
            color: #009688;
            border: 1px solid #009688;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-right: 10px;
        }

        .secondary-btn i {
            margin-left: 8px;
        }

        .search-container {
            position: relative;
            margin-right: auto;
            margin-left: 10px;
        }

        .search-input {
            padding: 10px 15px 10px 40px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 250px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #757575;
        }

        .data-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            text-align: right;
            padding: 12px 15px;
            border-bottom: 2px solid #eee;
            color: #757575;
            font-weight: bold;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background-color: #f9f9f9;
        }

        .status-active {
            color: #4caf50;
            background-color: rgba(76, 175, 80, 0.1);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .status-low {
            color: #ff9800;
            background-color: rgba(255, 152, 0, 0.1);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .status-inactive {
            color: #f44336;
            background-color: rgba(244, 67, 54, 0.1);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }

        .actions-cell {
            white-space: nowrap;
        }

        .action-icon {
            cursor: pointer;
            padding: 5px;
            font-size: 16px;
            transition: color 0.3s;
        }

        .edit-icon {
            color: #2196f3;
        }

        .edit-icon:hover {
            color: #0b7dda;
        }

        .delete-icon {
            color: #f44336;
        }

        .delete-icon:hover {
            color: #d32f2f;
        }

        .invoice-icon {
            color: #009688;
        }

        .invoice-icon:hover {
            color: #00796b;
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }

        .pagination-info {
            color: #757575;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
        }

        .pagination-btn {
            background-color: white;
            border: 1px solid #ddd;
            padding: 5px 10px;
            margin: 0 5px;
            cursor: pointer;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-current {
            padding: 5px 10px;
            background-color: #009688;
            color: white;
            border-radius: 3px;
        }

        /* Tabs Styles */
        .tabs-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            color: #666;
        }

        .tab:hover {
            background-color: #e0f2f1;
        }

        .tab.active {
            background-color: white;
            color: #009688;
            border-bottom: 2px solid #009688;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 500px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .modal-close {
            cursor: pointer;
            font-size: 20px;
            color: #757575;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-row {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background-color: white;
        }

        /* Tabs Styles */
        .tabs-container {
            width: 100%;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab:hover {
            color: #009688;
        }

        .tab.active {
            color: #009688;
            border-bottom: 2px solid #009688;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Form Container */
        .form-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 30px;
        }

        .form-container h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
        }

        .form-container p {
            margin-bottom: 20px;
            color: #757575;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Report Styles */
        .report-filters {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .report-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .summary-card {
            flex: 1;
            min-width: 200px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 15px;
            text-align: center;
        }

        .summary-title {
            color: #757575;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .summary-value {
            font-size: 24px;
            font-weight: bold;
            color: #009688;
        }

        .report-chart {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .report-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        /* POS Styles */
        .pos-container {
            display: flex;
            height: calc(100vh - 120px);
            overflow: hidden;
        }

        .pos-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-left: 1px solid #ddd;
            overflow: hidden;
        }

        .pos-right {
            width: 400px;
            display: flex;
            flex-direction: column;
            background-color: #f9f9f9;
            padding: 15px;
            overflow: hidden;
        }

        .pos-header {
            padding: 15px;
            border-bottom: 1px solid #ddd;
        }

        .pos-search {
            position: relative;
            margin-bottom: 15px;
        }

        .pos-search input {
            width: 100%;
            padding: 10px 15px;
            padding-left: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .pos-search i {
            position: absolute;
            left: 15px;
            top: 12px;
            color: #666;
        }

        .pos-categories {
            display: flex;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .pos-category {
            padding: 8px 15px;
            margin-left: 10px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            white-space: nowrap;
        }

        .pos-category.active {
            background-color: #009688;
            color: white;
        }

        .pos-products {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            padding: 15px;
            overflow-y: auto;
        }

        .pos-product {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pos-product:hover {
            border-color: #009688;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .pos-product img {
            width: 80px;
            height: 80px;
            object-fit: contain;
            margin-bottom: 10px;
        }

        .pos-product-name {
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 14px;
            height: 40px;
            overflow: hidden;
        }

        .pos-product-price {
            color: #009688;
            font-weight: bold;
        }

        .pos-customer {
            display: flex;
            margin-bottom: 15px;
        }

        .pos-customer select {
            flex: 1;
            margin-left: 10px;
        }

        .pos-cart {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
        }

        .pos-cart-table {
            width: 100%;
            border-collapse: collapse;
        }

        .pos-cart-table th, .pos-cart-table td {
            padding: 10px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }

        .pos-cart-table th {
            background-color: #f0f0f0;
            font-weight: bold;
        }

        .pos-cart-table .remove-item {
            color: #e53935;
            cursor: pointer;
        }

        .pos-totals {
            margin-bottom: 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }

        .pos-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .pos-discount {
            display: flex;
            width: 120px;
        }

        .pos-discount input {
            width: 70px;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            text-align: center;
        }

        .pos-discount select {
            width: 50px;
            border: 1px solid #ddd;
            border-right: none;
            border-radius: 0 4px 4px 0;
            background-color: #f0f0f0;
        }

        .pos-grand-total {
            font-weight: bold;
            font-size: 18px;
            color: #009688;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }

        .pos-payment {
            margin-bottom: 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }

        .pos-payment-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .pos-payment-row select, .pos-payment-row input {
            width: 150px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .pos-actions {
            display: flex;
            justify-content: space-between;
        }

        .pos-actions button {
            flex: 1;
            margin: 0 5px;
        }

        /* Export Dropdown Styles */
        .export-dropdown {
            position: relative;
            display: inline-block;
        }

        .export-dropdown-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 160px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 1;
            border-radius: 4px;
            right: 0;
        }

        .export-dropdown-content a {
            color: #333;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: right;
        }

        .export-dropdown-content a:hover {
            background-color: #f1f1f1;
        }

        .export-dropdown:hover .export-dropdown-content {
            display: block;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }

            .print-section, .print-section * {
                visibility: visible;
            }

            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }

            .no-print {
                display: none !important;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="database.js"></script>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <h1 class="app-title">نظام أبو سليمان للمحاسبة</h1>
        <p class="app-subtitle">نظام إدارة مالية متكامل</p>

        <div class="form-group">
            <label for="username">اسم المستخدم</label>
            <input type="text" id="username" class="form-control" value="admin">
        </div>

        <div class="form-group">
            <label for="password">كلمة المرور</label>
            <input type="password" id="password" class="form-control" value="admin123">
        </div>

        <button class="btn" id="loginBtn">تسجيل الدخول</button>

        <p class="error-message" id="errorMessage">اسم المستخدم أو كلمة المرور غير صحيحة</p>

        <p class="version">الإصدار 1.0.0</p>
    </div>

    <!-- Dashboard Screen -->
    <div class="dashboard-container" id="dashboardScreen">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">أبو سليمان</div>
                <div class="sidebar-subtitle">نظام المحاسبة</div>
            </div>

            <div class="menu-item active" data-page="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>لوحة التحكم</span>
            </div>

            <div class="menu-item" data-page="products">
                <i class="fas fa-box"></i>
                <span>المنتجات</span>
            </div>

            <div class="menu-item" data-page="customers">
                <i class="fas fa-users"></i>
                <span>العملاء</span>
            </div>

            <div class="menu-item" data-page="suppliers">
                <i class="fas fa-truck"></i>
                <span>الموردين</span>
            </div>

            <div class="menu-item" data-page="pos">
                <i class="fas fa-cash-register"></i>
                <span>نقاط البيع</span>
            </div>

            <div class="menu-item" data-page="sales">
                <i class="fas fa-shopping-cart"></i>
                <span>المبيعات</span>
            </div>

            <div class="menu-item" data-page="purchases">
                <i class="fas fa-shopping-bag"></i>
                <span>المشتريات</span>
            </div>

            <div class="menu-item" data-page="inventory">
                <i class="fas fa-boxes"></i>
                <span>المخزون</span>
            </div>

            <div class="menu-item" data-page="expenses">
                <i class="fas fa-money-bill-wave"></i>
                <span>المصروفات</span>
            </div>

            <div class="menu-item" data-page="accounting">
                <i class="fas fa-calculator"></i>
                <span>المحاسبة</span>
            </div>

            <div class="menu-item" data-page="reports">
                <i class="fas fa-chart-bar"></i>
                <span>التقارير</span>
            </div>

            <div class="menu-item" data-page="settings">
                <i class="fas fa-cog"></i>
                <span>الإعدادات</span>
            </div>

            <div class="menu-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                <span>تسجيل الخروج</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="content">
            <h1 class="page-title" id="pageTitle">لوحة التحكم</h1>

            <!-- POS Content -->
            <div id="posContent" style="display: none;">
                <div class="pos-container">
                    <div class="pos-left">
                        <div class="pos-header">
                            <div class="pos-search">
                                <input type="text" placeholder="بحث عن منتج (اسم، كود، باركود)..." id="posSearchInput">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="pos-categories">
                                <button class="pos-category active" data-category="all">الكل</button>
                                <button class="pos-category" data-category="electronics">إلكترونيات</button>
                                <button class="pos-category" data-category="computers">حاسبات</button>
                                <button class="pos-category" data-category="accessories">ملحقات</button>
                                <button class="pos-category" data-category="printers">طابعات</button>
                            </div>
                        </div>
                        <div class="pos-products" id="posProducts">
                            <!-- سيتم ملؤها ديناميكيًا -->
                        </div>
                    </div>
                    <div class="pos-right">
                        <div class="pos-customer">
                            <select class="form-select" id="posCustomer">
                                <option value="">عميل نقدي</option>
                                <!-- سيتم ملؤها ديناميكيًا -->
                            </select>
                            <button class="secondary-btn" id="addPosCustomerBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="pos-cart">
                            <table class="pos-cart-table">
                                <thead>
                                    <tr>
                                        <th>المنتج</th>
                                        <th>السعر</th>
                                        <th>الكمية</th>
                                        <th>الإجمالي</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="posCartItems">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                        <div class="pos-totals">
                            <div class="pos-total-row">
                                <span>الإجمالي:</span>
                                <span id="posSubtotal">0.00 ر.س</span>
                            </div>
                            <div class="pos-total-row">
                                <span>الخصم:</span>
                                <div class="pos-discount">
                                    <input type="number" id="posDiscountValue" value="0" min="0">
                                    <select id="posDiscountType">
                                        <option value="percentage">%</option>
                                        <option value="fixed">ر.س</option>
                                    </select>
                                </div>
                            </div>
                            <div class="pos-total-row">
                                <span>الضريبة (15%):</span>
                                <span id="posTax">0.00 ر.س</span>
                            </div>
                            <div class="pos-total-row pos-grand-total">
                                <span>الإجمالي النهائي:</span>
                                <span id="posTotal">0.00 ر.س</span>
                            </div>
                        </div>
                        <div class="pos-payment">
                            <div class="pos-payment-row">
                                <span>طريقة الدفع:</span>
                                <select class="form-select" id="posPaymentMethod">
                                    <option value="cash">نقدي</option>
                                    <option value="card">بطاقة ائتمان</option>
                                    <option value="bank">تحويل بنكي</option>
                                    <option value="credit">آجل</option>
                                </select>
                            </div>
                            <div class="pos-payment-row">
                                <span>المدفوع:</span>
                                <input type="number" id="posPaidAmount" value="0" min="0">
                            </div>
                            <div class="pos-payment-row">
                                <span>المتبقي:</span>
                                <span id="posRemainingAmount">0.00 ر.س</span>
                            </div>
                            <div class="pos-payment-row">
                                <span>الباقي:</span>
                                <span id="posChangeAmount">0.00 ر.س</span>
                            </div>
                        </div>
                        <div class="pos-actions">
                            <button class="secondary-btn" id="posCancelBtn">
                                <i class="fas fa-times"></i>
                                إلغاء
                            </button>
                            <button class="secondary-btn" id="posSaveBtn">
                                <i class="fas fa-save"></i>
                                حفظ
                            </button>
                            <button class="primary-btn" id="posPayBtn">
                                <i class="fas fa-check"></i>
                                دفع
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboardContent">
                <!-- Summary Cards -->
                <div class="cards-container">
                    <div class="card">
                        <div class="card-title">المبيعات</div>
                        <div class="card-value">25,000 ر.س</div>
                        <div class="card-footer">
                            <i class="fas fa-arrow-up"></i>
                            15.2% مقارنة بالشهر الماضي
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">المشتريات</div>
                        <div class="card-value">15,000 ر.س</div>
                        <div class="card-footer">
                            <i class="fas fa-arrow-up"></i>
                            8.7% مقارنة بالشهر الماضي
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">المصروفات</div>
                        <div class="card-value">3,000 ر.س</div>
                        <div class="card-footer">
                            <i class="fas fa-arrow-up"></i>
                            5.2% مقارنة بالشهر الماضي
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">صافي الربح</div>
                        <div class="card-value">7,000 ر.س</div>
                        <div class="card-footer">
                            <i class="fas fa-arrow-up"></i>
                            12.5% مقارنة بالشهر الماضي
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="transactions-container">
                    <div class="transactions-header">
                        <div class="transactions-title">المعاملات الأخيرة</div>
                        <div class="view-all">عرض الكل</div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>النوع</th>
                                <th>الرقم</th>
                                <th>العميل/المورد</th>
                                <th>المبلغ</th>
                                <th>الحالة</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>15/05/2023</td>
                                <td>فاتورة مبيعات</td>
                                <td>SI230500001</td>
                                <td>عميل 1</td>
                                <td>1,500 ر.س</td>
                                <td class="status-paid">مدفوعة</td>
                            </tr>
                            <tr>
                                <td>14/05/2023</td>
                                <td>فاتورة مشتريات</td>
                                <td>PI230500001</td>
                                <td>مورد 1</td>
                                <td>800 ر.س</td>
                                <td class="status-paid">مدفوعة</td>
                            </tr>
                            <tr>
                                <td>13/05/2023</td>
                                <td>فاتورة مبيعات</td>
                                <td>SI230500002</td>
                                <td>عميل 2</td>
                                <td>2,200 ر.س</td>
                                <td class="status-pending">معلقة</td>
                            </tr>
                            <tr>
                                <td>12/05/2023</td>
                                <td>فاتورة مشتريات</td>
                                <td>PI230500002</td>
                                <td>مورد 2</td>
                                <td>1,100 ر.س</td>
                                <td class="status-pending">معلقة</td>
                            </tr>
                            <tr>
                                <td>11/05/2023</td>
                                <td>فاتورة مبيعات</td>
                                <td>SI230500003</td>
                                <td>عميل 3</td>
                                <td>950 ر.س</td>
                                <td class="status-paid">مدفوعة</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Quick Actions -->
                <div class="actions-container">
                    <button class="action-btn">
                        <i class="fas fa-plus-circle"></i>
                        فاتورة مبيعات جديدة
                    </button>
                    <button class="action-btn">
                        <i class="fas fa-plus-circle"></i>
                        فاتورة مشتريات جديدة
                    </button>
                    <button class="action-btn">
                        <i class="fas fa-plus-circle"></i>
                        مصروف جديد
                    </button>
                    <button class="action-btn">
                        <i class="fas fa-file-alt"></i>
                        إنشاء تقرير
                    </button>
                </div>
            </div>

            <!-- Products Page Content -->
            <div id="productsContent" style="display: none;">
                <div class="page-actions">
                    <button class="primary-btn" id="addProductBtn">
                        <i class="fas fa-plus"></i>
                        إضافة منتج جديد
                    </button>
                    <div class="export-dropdown">
                        <button class="secondary-btn" id="exportProductsBtn">
                            <i class="fas fa-file-export"></i>
                            تصدير
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportProductsExcel">تصدير إلى Excel</a>
                            <a href="#" id="exportProductsPDF">تصدير إلى PDF</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" placeholder="بحث..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="data-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>الكود</th>
                                <th>الباركود</th>
                                <th>اسم المنتج</th>
                                <th>الوحدة</th>
                                <th>سعر الشراء</th>
                                <th>سعر البيع</th>
                                <th>المخزون</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>P001</td>
                                <td>123456789</td>
                                <td>لابتوب HP ProBook</td>
                                <td>قطعة</td>
                                <td>3,500 ر.س</td>
                                <td>4,200 ر.س</td>
                                <td>15</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>P002</td>
                                <td>987654321</td>
                                <td>طابعة Canon</td>
                                <td>قطعة</td>
                                <td>800 ر.س</td>
                                <td>950 ر.س</td>
                                <td>8</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>P003</td>
                                <td>456789123</td>
                                <td>ماوس لاسلكي</td>
                                <td>قطعة</td>
                                <td>50 ر.س</td>
                                <td>75 ر.س</td>
                                <td>42</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>P004</td>
                                <td>789123456</td>
                                <td>لوحة مفاتيح</td>
                                <td>قطعة</td>
                                <td>70 ر.س</td>
                                <td>100 ر.س</td>
                                <td>25</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>P005</td>
                                <td>321654987</td>
                                <td>شاشة Samsung</td>
                                <td>قطعة</td>
                                <td>900 ر.س</td>
                                <td>1,100 ر.س</td>
                                <td>5</td>
                                <td><span class="status-low">مخزون منخفض</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span class="pagination-info">عرض 1-5 من 5 منتجات</span>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                            <span class="pagination-current">1</span>
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Customers Page Content -->
            <div id="customersContent" style="display: none;">
                <div class="page-actions">
                    <button class="primary-btn" id="addCustomerBtn">
                        <i class="fas fa-plus"></i>
                        إضافة عميل جديد
                    </button>
                    <div class="export-dropdown">
                        <button class="secondary-btn" id="exportCustomersBtn">
                            <i class="fas fa-file-export"></i>
                            تصدير
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportCustomersExcel">تصدير إلى Excel</a>
                            <a href="#" id="exportCustomersPDF">تصدير إلى PDF</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" placeholder="بحث..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="data-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>الكود</th>
                                <th>اسم العميل</th>
                                <th>جهة الاتصال</th>
                                <th>الهاتف</th>
                                <th>البريد الإلكتروني</th>
                                <th>الرصيد</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>C001</td>
                                <td>شركة الأمل التجارية</td>
                                <td>أحمد محمد</td>
                                <td>0555123456</td>
                                <td>info@alamal.com</td>
                                <td>12,500 ر.س</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                    <i class="fas fa-file-invoice-dollar action-icon invoice-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>C002</td>
                                <td>مؤسسة النور</td>
                                <td>خالد عبدالله</td>
                                <td>0555789456</td>
                                <td>info@alnoor.com</td>
                                <td>5,800 ر.س</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                    <i class="fas fa-file-invoice-dollar action-icon invoice-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>C003</td>
                                <td>شركة السلام</td>
                                <td>محمد علي</td>
                                <td>0555456123</td>
                                <td>info@alsalam.com</td>
                                <td>8,200 ر.س</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                    <i class="fas fa-file-invoice-dollar action-icon invoice-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>C004</td>
                                <td>مؤسسة الفجر</td>
                                <td>سعيد محمد</td>
                                <td>0555321654</td>
                                <td>info@alfajr.com</td>
                                <td>3,500 ر.س</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                    <i class="fas fa-file-invoice-dollar action-icon invoice-icon"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span class="pagination-info">عرض 1-4 من 4 عملاء</span>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                            <span class="pagination-current">1</span>
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sales Page Content -->
            <div id="salesContent" style="display: none;">
                <div class="page-actions">
                    <button class="primary-btn" id="addSaleBtn">
                        <i class="fas fa-plus"></i>
                        فاتورة مبيعات جديدة
                    </button>
                    <div class="export-dropdown">
                        <button class="secondary-btn" id="exportSalesBtn">
                            <i class="fas fa-file-export"></i>
                            تصدير
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportSalesExcel">تصدير إلى Excel</a>
                            <a href="#" id="exportSalesPDF">تصدير إلى PDF</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" placeholder="بحث..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="data-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>العميل</th>
                                <th>إجمالي الفاتورة</th>
                                <th>المدفوع</th>
                                <th>المتبقي</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>INV-2023-001</td>
                                <td>15/05/2023</td>
                                <td>شركة الأمل التجارية</td>
                                <td>4,500 ر.س</td>
                                <td>4,500 ر.س</td>
                                <td>0 ر.س</td>
                                <td><span class="status-active">مدفوعة</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-eye action-icon view-icon"></i>
                                    <i class="fas fa-print action-icon print-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>INV-2023-002</td>
                                <td>14/05/2023</td>
                                <td>مؤسسة النور</td>
                                <td>2,800 ر.س</td>
                                <td>1,500 ر.س</td>
                                <td>1,300 ر.س</td>
                                <td><span class="status-low">مدفوعة جزئياً</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-eye action-icon view-icon"></i>
                                    <i class="fas fa-print action-icon print-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                            <tr>
                                <td>INV-2023-003</td>
                                <td>13/05/2023</td>
                                <td>شركة السلام</td>
                                <td>3,200 ر.س</td>
                                <td>0 ر.س</td>
                                <td>3,200 ر.س</td>
                                <td><span class="status-inactive">غير مدفوعة</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-eye action-icon view-icon"></i>
                                    <i class="fas fa-print action-icon print-icon"></i>
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span class="pagination-info">عرض 1-3 من 3 فواتير</span>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                            <span class="pagination-current">1</span>
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Expenses Page Content -->
            <div id="expensesContent" style="display: none;">
                <div class="page-actions">
                    <button class="primary-btn" id="addExpenseBtn">
                        <i class="fas fa-plus"></i>
                        مصروف جديد
                    </button>
                    <div class="export-dropdown">
                        <button class="secondary-btn" id="exportExpensesBtn">
                            <i class="fas fa-file-export"></i>
                            تصدير
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportExpensesExcel">تصدير إلى Excel</a>
                            <a href="#" id="exportExpensesPDF">تصدير إلى PDF</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" placeholder="بحث..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="data-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>التاريخ</th>
                                <th>الفئة</th>
                                <th>الوصف</th>
                                <th>المبلغ</th>
                                <th>طريقة الدفع</th>
                                <th>المستفيد</th>
                                <th>الملاحظات</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملؤها ديناميكيًا -->
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span class="pagination-info">عرض 0-0 من 0 مصروفات</span>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                            <span class="pagination-current">1</span>
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Purchases Page Content -->
            <div id="purchasesContent" style="display: none;">
                <div class="page-actions">
                    <button class="primary-btn" id="addPurchaseBtn">
                        <i class="fas fa-plus"></i>
                        فاتورة مشتريات جديدة
                    </button>
                    <div class="export-dropdown">
                        <button class="secondary-btn" id="exportPurchasesBtn">
                            <i class="fas fa-file-export"></i>
                            تصدير
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportPurchasesExcel">تصدير إلى Excel</a>
                            <a href="#" id="exportPurchasesPDF">تصدير إلى PDF</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" placeholder="بحث..." class="search-input" id="purchasesSearchInput">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="data-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>رقم الفاتورة</th>
                                <th>التاريخ</th>
                                <th>المورد</th>
                                <th>إجمالي الفاتورة</th>
                                <th>المدفوع</th>
                                <th>المتبقي</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="purchasesTableBody">
                            <!-- سيتم ملؤها ديناميكيًا -->
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span class="pagination-info" id="purchasesPaginationInfo">عرض 0-0 من 0 فواتير</span>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                            <span class="pagination-current">1</span>
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Suppliers Page Content -->
            <div id="suppliersContent" style="display: none;">
                <div class="page-actions">
                    <button class="primary-btn" id="addSupplierBtn">
                        <i class="fas fa-plus"></i>
                        مورد جديد
                    </button>
                    <div class="export-dropdown">
                        <button class="secondary-btn" id="exportSuppliersBtn">
                            <i class="fas fa-file-export"></i>
                            تصدير
                        </button>
                        <div class="export-dropdown-content">
                            <a href="#" id="exportSuppliersExcel">تصدير إلى Excel</a>
                            <a href="#" id="exportSuppliersPDF">تصدير إلى PDF</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" placeholder="بحث..." class="search-input">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                </div>

                <div class="data-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>الكود</th>
                                <th>اسم المورد</th>
                                <th>جهة الاتصال</th>
                                <th>رقم الهاتف</th>
                                <th>البريد الإلكتروني</th>
                                <th>الرصيد</th>
                                <th>الحالة</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- سيتم ملؤها ديناميكيًا -->
                        </tbody>
                    </table>

                    <div class="pagination">
                        <span class="pagination-info">عرض 0-0 من 0 موردين</span>
                        <div class="pagination-controls">
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                            <span class="pagination-current">1</span>
                            <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Inventory Management Page Content -->
            <div id="inventoryContent" style="display: none;">
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="inventory-status">حالة المخزون</div>
                        <div class="tab" data-tab="inventory-transactions">حركات المخزون</div>
                        <div class="tab" data-tab="inventory-adjustment">تسوية المخزون</div>
                    </div>

                    <!-- Inventory Status Tab -->
                    <div class="tab-content active" id="inventory-status">
                        <div class="page-actions">
                            <button class="secondary-btn">
                                <i class="fas fa-file-export"></i>
                                تصدير
                            </button>
                            <div class="search-container">
                                <input type="text" placeholder="بحث..." class="search-input" id="inventory-search">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                        </div>

                        <div class="data-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>الكود</th>
                                        <th>اسم المنتج</th>
                                        <th>الوحدة</th>
                                        <th>المخزون الحالي</th>
                                        <th>الحد الأدنى</th>
                                        <th>سعر الشراء</th>
                                        <th>سعر البيع</th>
                                        <th>القيمة</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="inventory-status-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>

                            <div class="pagination">
                                <span class="pagination-info" id="inventory-pagination-info">عرض 0-0 من 0 منتجات</span>
                                <div class="pagination-controls">
                                    <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                                    <span class="pagination-current">1</span>
                                    <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory Transactions Tab -->
                    <div class="tab-content" id="inventory-transactions">
                        <div class="page-actions">
                            <button class="secondary-btn">
                                <i class="fas fa-file-export"></i>
                                تصدير
                            </button>
                            <div class="search-container">
                                <input type="text" placeholder="بحث..." class="search-input">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                        </div>

                        <div class="data-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>المنتج</th>
                                        <th>نوع الحركة</th>
                                        <th>الكمية</th>
                                        <th>المرجع</th>
                                        <th>المستخدم</th>
                                        <th>ملاحظات</th>
                                    </tr>
                                </thead>
                                <tbody id="inventory-transactions-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>

                            <div class="pagination">
                                <span class="pagination-info">عرض 0-0 من 0 حركات</span>
                                <div class="pagination-controls">
                                    <button class="pagination-btn" disabled><i class="fas fa-chevron-right"></i></button>
                                    <span class="pagination-current">1</span>
                                    <button class="pagination-btn" disabled><i class="fas fa-chevron-left"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Inventory Adjustment Tab -->
                    <div class="tab-content" id="inventory-adjustment">
                        <div class="form-container">
                            <h3>تسوية المخزون</h3>
                            <p>استخدم هذا النموذج لتعديل كميات المخزون يدويًا (جرد، إضافة، خصم)</p>

                            <div class="form-row">
                                <label class="form-label">المنتج</label>
                                <select class="form-select" id="adjustment-product">
                                    <option value="">اختر المنتج</option>
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </select>
                            </div>

                            <div class="form-row">
                                <label class="form-label">الكمية الحالية</label>
                                <input type="text" class="form-input" id="adjustment-current-quantity" readonly>
                            </div>

                            <div class="form-row">
                                <label class="form-label">نوع التسوية</label>
                                <select class="form-select" id="adjustment-type">
                                    <option value="set">تعيين كمية محددة</option>
                                    <option value="add">إضافة كمية</option>
                                    <option value="subtract">خصم كمية</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label class="form-label">الكمية الجديدة</label>
                                <input type="number" class="form-input" id="adjustment-new-quantity" min="0" step="1">
                            </div>

                            <div class="form-row">
                                <label class="form-label">ملاحظات</label>
                                <textarea class="form-input" id="adjustment-notes" rows="3" placeholder="سبب التسوية"></textarea>
                            </div>

                            <div class="form-actions">
                                <button class="primary-btn" id="save-adjustment-btn">حفظ التسوية</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Page Content -->
            <div id="reportsContent" style="display: none;">
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="sales-report">تقرير المبيعات</div>
                        <div class="tab" data-tab="inventory-report">تقرير المخزون</div>
                        <div class="tab" data-tab="customers-report">تقرير العملاء</div>
                        <div class="tab" data-tab="profit-report">تقرير الأرباح</div>
                    </div>

                    <!-- Sales Report Tab -->
                    <div class="tab-content active" id="sales-report">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>من تاريخ</label>
                                    <input type="date" id="sales-from-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <label>إلى تاريخ</label>
                                    <input type="date" id="sales-to-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <label>العميل</label>
                                    <select id="sales-customer" class="form-select">
                                        <option value="">جميع العملاء</option>
                                        <!-- سيتم ملؤها ديناميكيًا -->
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>الحالة</label>
                                    <select id="sales-status" class="form-select">
                                        <option value="">جميع الحالات</option>
                                        <option value="paid">مدفوعة</option>
                                        <option value="partial">مدفوعة جزئياً</option>
                                        <option value="unpaid">غير مدفوعة</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <button id="generate-sales-report" class="primary-btn">
                                        <i class="fas fa-chart-line"></i>
                                        إنشاء التقرير
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="report-summary">
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المبيعات</div>
                                <div class="summary-value" id="sales-total">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">عدد الفواتير</div>
                                <div class="summary-value" id="sales-count">0</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">متوسط قيمة الفاتورة</div>
                                <div class="summary-value" id="sales-average">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المدفوعات</div>
                                <div class="summary-value" id="sales-paid">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المتبقي</div>
                                <div class="summary-value" id="sales-due">0 ر.س</div>
                            </div>
                        </div>

                        <div class="report-chart">
                            <canvas id="sales-chart" height="300"></canvas>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-sales-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-sales-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>رقم الفاتورة</th>
                                        <th>التاريخ</th>
                                        <th>العميل</th>
                                        <th>إجمالي الفاتورة</th>
                                        <th>المدفوع</th>
                                        <th>المتبقي</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="sales-report-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Inventory Report Tab -->
                    <div class="tab-content" id="inventory-report">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>المنتج</label>
                                    <select id="inventory-product" class="form-select">
                                        <option value="">جميع المنتجات</option>
                                        <!-- سيتم ملؤها ديناميكيًا -->
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>الحالة</label>
                                    <select id="inventory-status" class="form-select">
                                        <option value="">جميع الحالات</option>
                                        <option value="low">مخزون منخفض</option>
                                        <option value="out">نفاذ المخزون</option>
                                        <option value="available">متوفر</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <button id="generate-inventory-report" class="primary-btn">
                                        <i class="fas fa-chart-line"></i>
                                        إنشاء التقرير
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="report-summary">
                            <div class="summary-card">
                                <div class="summary-title">إجمالي قيمة المخزون</div>
                                <div class="summary-value" id="inventory-value">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">عدد المنتجات</div>
                                <div class="summary-value" id="inventory-count">0</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">منتجات منخفضة المخزون</div>
                                <div class="summary-value" id="inventory-low">0</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">منتجات نفذت من المخزون</div>
                                <div class="summary-value" id="inventory-out">0</div>
                            </div>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-inventory-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-inventory-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>الكود</th>
                                        <th>اسم المنتج</th>
                                        <th>الوحدة</th>
                                        <th>المخزون الحالي</th>
                                        <th>الحد الأدنى</th>
                                        <th>سعر الشراء</th>
                                        <th>سعر البيع</th>
                                        <th>القيمة</th>
                                        <th>الحالة</th>
                                    </tr>
                                </thead>
                                <tbody id="inventory-report-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Customers Report Tab -->
                    <div class="tab-content" id="customers-report">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>العميل</label>
                                    <select id="customer-select" class="form-select">
                                        <option value="">جميع العملاء</option>
                                        <!-- سيتم ملؤها ديناميكيًا -->
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>من تاريخ</label>
                                    <input type="date" id="customer-from-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <label>إلى تاريخ</label>
                                    <input type="date" id="customer-to-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <button id="generate-customer-report" class="primary-btn">
                                        <i class="fas fa-chart-line"></i>
                                        إنشاء التقرير
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="report-summary">
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المبيعات</div>
                                <div class="summary-value" id="customer-sales">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المدفوعات</div>
                                <div class="summary-value" id="customer-paid">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المستحقات</div>
                                <div class="summary-value" id="customer-due">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">عدد الفواتير</div>
                                <div class="summary-value" id="customer-invoices">0</div>
                            </div>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-customer-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-customer-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>الكود</th>
                                        <th>اسم العميل</th>
                                        <th>رقم الهاتف</th>
                                        <th>إجمالي المبيعات</th>
                                        <th>إجمالي المدفوعات</th>
                                        <th>الرصيد المستحق</th>
                                        <th>عدد الفواتير</th>
                                    </tr>
                                </thead>
                                <tbody id="customers-report-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Profit Report Tab -->
                    <div class="tab-content" id="profit-report">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>من تاريخ</label>
                                    <input type="date" id="profit-from-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <label>إلى تاريخ</label>
                                    <input type="date" id="profit-to-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <button id="generate-profit-report" class="primary-btn">
                                        <i class="fas fa-chart-line"></i>
                                        إنشاء التقرير
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="report-summary">
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المبيعات</div>
                                <div class="summary-value" id="profit-sales">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">تكلفة المبيعات</div>
                                <div class="summary-value" id="profit-cost">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">إجمالي الربح</div>
                                <div class="summary-value" id="profit-gross">0 ر.س</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">هامش الربح</div>
                                <div class="summary-value" id="profit-margin">0%</div>
                            </div>
                        </div>

                        <div class="report-chart">
                            <canvas id="profit-chart" height="300"></canvas>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-profit-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-profit-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>الفترة</th>
                                        <th>المبيعات</th>
                                        <th>تكلفة المبيعات</th>
                                        <th>إجمالي الربح</th>
                                        <th>هامش الربح</th>
                                    </tr>
                                </thead>
                                <tbody id="profit-report-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page Content -->
            <div id="settingsContent" style="display: none;">
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="general-settings">الإعدادات العامة</div>
                        <div class="tab" data-tab="backup-restore">النسخ الاحتياطي واستعادة البيانات</div>
                        <div class="tab" data-tab="users-settings">إدارة المستخدمين</div>
                    </div>

                    <!-- General Settings Tab -->
                    <div class="tab-content active" id="general-settings">
                        <div class="form-container">
                            <h3>الإعدادات العامة</h3>

                            <div class="form-row">
                                <label class="form-label">اسم الشركة</label>
                                <input type="text" class="form-input" id="companyName" value="نظام أبو سليمان للمحاسبة">
                            </div>

                            <div class="form-row">
                                <label class="form-label">شعار الشركة</label>
                                <div style="display: flex; align-items: center;">
                                    <input type="file" id="companyLogo" accept="image/*" style="display: none;">
                                    <button class="secondary-btn" id="uploadLogoBtn">
                                        <i class="fas fa-upload"></i>
                                        تحميل شعار
                                    </button>
                                    <div id="logoPreview" style="margin-right: 10px; width: 50px; height: 50px; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-image" style="color: #ddd; font-size: 24px;"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="form-row">
                                <label class="form-label">العنوان</label>
                                <input type="text" class="form-input" id="companyAddress" placeholder="أدخل عنوان الشركة">
                            </div>

                            <div class="form-row">
                                <label class="form-label">رقم الهاتف</label>
                                <input type="text" class="form-input" id="companyPhone" placeholder="أدخل رقم هاتف الشركة">
                            </div>

                            <div class="form-row">
                                <label class="form-label">البريد الإلكتروني</label>
                                <input type="email" class="form-input" id="companyEmail" placeholder="أدخل البريد الإلكتروني للشركة">
                            </div>

                            <div class="form-row">
                                <label class="form-label">الرقم الضريبي</label>
                                <input type="text" class="form-input" id="taxNumber" placeholder="أدخل الرقم الضريبي">
                            </div>

                            <div class="form-row">
                                <label class="form-label">نسبة الضريبة (%)</label>
                                <input type="number" class="form-input" id="taxRate" value="15" min="0" max="100">
                            </div>

                            <div class="form-row">
                                <label class="form-label">العملة</label>
                                <select class="form-select" id="currency">
                                    <option value="KWD">دينار كويتي (د.ك)</option>
                                    <option value="SAR">ريال سعودي (ر.س)</option>
                                    <option value="USD">دولار أمريكي ($)</option>
                                    <option value="EUR">يورو (€)</option>
                                    <option value="AED">درهم إماراتي (د.إ)</option>
                                    <option value="QAR">ريال قطري (ر.ق)</option>
                                    <option value="BHD">دينار بحريني (د.ب)</option>
                                    <option value="OMR">ريال عماني (ر.ع)</option>
                                    <option value="EGP">جنيه مصري (ج.م)</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <label class="form-label">رمز العملة</label>
                                <input type="text" class="form-input" id="currencySymbol" value="د.ك" placeholder="رمز العملة">
                            </div>

                            <div class="form-actions">
                                <button class="primary-btn" id="saveSettingsBtn">
                                    <i class="fas fa-save"></i>
                                    حفظ الإعدادات
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Backup & Restore Tab -->
                    <div class="tab-content" id="backup-restore">
                        <div class="form-container">
                            <h3>النسخ الاحتياطي واستعادة البيانات</h3>
                            <p>استخدم هذه الأدوات لإنشاء نسخة احتياطية من بيانات النظام أو استعادة البيانات من نسخة احتياطية سابقة.</p>

                            <div class="card" style="margin-bottom: 20px; padding: 20px;">
                                <h4 style="margin-top: 0;">إنشاء نسخة احتياطية</h4>
                                <p>قم بإنشاء نسخة احتياطية من جميع بيانات النظام وتنزيلها كملف.</p>
                                <button class="primary-btn" id="createBackupBtn">
                                    <i class="fas fa-download"></i>
                                    إنشاء نسخة احتياطية
                                </button>
                            </div>

                            <div class="card" style="margin-bottom: 20px; padding: 20px;">
                                <h4 style="margin-top: 0;">استعادة البيانات</h4>
                                <p>استعادة بيانات النظام من نسخة احتياطية سابقة. <strong>تحذير:</strong> سيتم استبدال جميع البيانات الحالية.</p>
                                <div style="display: flex; align-items: center;">
                                    <input type="file" id="restoreFile" accept=".json" style="display: none;">
                                    <button class="secondary-btn" id="selectRestoreFileBtn">
                                        <i class="fas fa-upload"></i>
                                        اختيار ملف
                                    </button>
                                    <span id="selectedFileName" style="margin-right: 10px; color: #666;">لم يتم اختيار ملف</span>
                                </div>
                                <button class="primary-btn" id="restoreBackupBtn" style="margin-top: 10px;" disabled>
                                    <i class="fas fa-undo"></i>
                                    استعادة البيانات
                                </button>
                            </div>

                            <div class="card" style="margin-bottom: 20px; padding: 20px; background-color: #ffebee;">
                                <h4 style="margin-top: 0; color: #d32f2f;">إعادة تعيين قاعدة البيانات</h4>
                                <p>حذف قاعدة البيانات الحالية وإعادة إنشائها من جديد. <strong>تحذير:</strong> سيتم حذف جميع البيانات الحالية نهائياً.</p>
                                <button class="danger-btn" id="resetDbBtn" style="background-color: #d32f2f; color: white;">
                                    <i class="fas fa-trash"></i>
                                    إعادة تعيين قاعدة البيانات
                                </button>
                            </div>

                            <div class="card" style="padding: 20px;">
                                <h4 style="margin-top: 0;">تصدير البيانات</h4>
                                <p>تصدير بيانات محددة من النظام.</p>
                                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                    <button class="secondary-btn" id="exportAllDataBtn">
                                        <i class="fas fa-file-export"></i>
                                        تصدير جميع البيانات
                                    </button>
                                    <button class="secondary-btn" id="exportProductsDataBtn">
                                        <i class="fas fa-file-export"></i>
                                        تصدير المنتجات
                                    </button>
                                    <button class="secondary-btn" id="exportCustomersDataBtn">
                                        <i class="fas fa-file-export"></i>
                                        تصدير العملاء
                                    </button>
                                    <button class="secondary-btn" id="exportSuppliersDataBtn">
                                        <i class="fas fa-file-export"></i>
                                        تصدير الموردين
                                    </button>
                                    <button class="secondary-btn" id="exportInvoicesDataBtn">
                                        <i class="fas fa-file-export"></i>
                                        تصدير الفواتير
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Users Management Tab -->
                    <div class="tab-content" id="users-settings">
                        <div class="form-container">
                            <h3>إدارة المستخدمين</h3>
                            <p>إدارة حسابات المستخدمين وصلاحياتهم في النظام.</p>

                            <div style="margin-bottom: 20px;">
                                <button class="primary-btn" id="addUserBtn">
                                    <i class="fas fa-user-plus"></i>
                                    إضافة مستخدم جديد
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>اسم المستخدم</th>
                                        <th>الاسم الكامل</th>
                                        <th>البريد الإلكتروني</th>
                                        <th>الدور</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <tr>
                                        <td>admin</td>
                                        <td>مدير النظام</td>
                                        <td>admin@example.com</td>
                                        <td>مدير</td>
                                        <td><span class="status-active">نشط</span></td>
                                        <td class="actions-cell">
                                            <i class="fas fa-edit action-icon edit-icon"></i>
                                            <i class="fas fa-key action-icon password-icon"></i>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Accounting Page Content -->
            <div id="accountingContent" style="display: none;">
                <div class="tabs-container">
                    <div class="tabs">
                        <div class="tab active" data-tab="general-ledger">دفتر الأستاذ العام</div>
                        <div class="tab" data-tab="accounts-receivable">حسابات العملاء</div>
                        <div class="tab" data-tab="accounts-payable">حسابات الموردين</div>
                        <div class="tab" data-tab="journal-entries">قيود اليومية</div>
                        <div class="tab" data-tab="financial-statements">التقارير المالية</div>
                    </div>

                    <!-- General Ledger Tab -->
                    <div class="tab-content active" id="general-ledger">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>من تاريخ</label>
                                    <input type="date" id="ledger-from-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <label>إلى تاريخ</label>
                                    <input type="date" id="ledger-to-date" class="form-input">
                                </div>
                                <div class="filter-group">
                                    <label>الحساب</label>
                                    <select id="ledger-account" class="form-select">
                                        <option value="">جميع الحسابات</option>
                                        <option value="1000">1000 - الصندوق</option>
                                        <option value="1100">1100 - البنك</option>
                                        <option value="1200">1200 - المخزون</option>
                                        <option value="1300">1300 - العملاء</option>
                                        <option value="2000">2000 - الموردين</option>
                                        <option value="3000">3000 - رأس المال</option>
                                        <option value="4000">4000 - المبيعات</option>
                                        <option value="5000">5000 - المشتريات</option>
                                        <option value="6000">6000 - المصروفات</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <button id="generate-ledger-report" class="primary-btn">
                                        <i class="fas fa-search"></i>
                                        عرض
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-ledger-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-ledger-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>التاريخ</th>
                                        <th>رقم القيد</th>
                                        <th>البيان</th>
                                        <th>رقم الحساب</th>
                                        <th>اسم الحساب</th>
                                        <th>مدين</th>
                                        <th>دائن</th>
                                        <th>الرصيد</th>
                                    </tr>
                                </thead>
                                <tbody id="ledger-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Accounts Receivable Tab -->
                    <div class="tab-content" id="accounts-receivable">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>العميل</label>
                                    <select id="ar-customer" class="form-select">
                                        <option value="">جميع العملاء</option>
                                        <!-- سيتم ملؤها ديناميكيًا -->
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>حالة الفاتورة</label>
                                    <select id="ar-status" class="form-select">
                                        <option value="">جميع الحالات</option>
                                        <option value="unpaid">غير مدفوعة</option>
                                        <option value="partial">مدفوعة جزئياً</option>
                                        <option value="paid">مدفوعة</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <button id="generate-ar-report" class="primary-btn">
                                        <i class="fas fa-search"></i>
                                        عرض
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="report-summary">
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المستحقات</div>
                                <div class="summary-value" id="ar-total">0 د.ك</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">عدد الفواتير</div>
                                <div class="summary-value" id="ar-count">0</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">متوسط المستحقات</div>
                                <div class="summary-value" id="ar-average">0 د.ك</div>
                            </div>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-ar-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-ar-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>رقم الفاتورة</th>
                                        <th>التاريخ</th>
                                        <th>العميل</th>
                                        <th>إجمالي الفاتورة</th>
                                        <th>المدفوع</th>
                                        <th>المتبقي</th>
                                        <th>تاريخ الاستحقاق</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="ar-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Accounts Payable Tab -->
                    <div class="tab-content" id="accounts-payable">
                        <div class="report-filters">
                            <div class="filter-row">
                                <div class="filter-group">
                                    <label>المورد</label>
                                    <select id="ap-supplier" class="form-select">
                                        <option value="">جميع الموردين</option>
                                        <!-- سيتم ملؤها ديناميكيًا -->
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label>حالة الفاتورة</label>
                                    <select id="ap-status" class="form-select">
                                        <option value="">جميع الحالات</option>
                                        <option value="unpaid">غير مدفوعة</option>
                                        <option value="partial">مدفوعة جزئياً</option>
                                        <option value="paid">مدفوعة</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <button id="generate-ap-report" class="primary-btn">
                                        <i class="fas fa-search"></i>
                                        عرض
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="report-summary">
                            <div class="summary-card">
                                <div class="summary-title">إجمالي المستحقات</div>
                                <div class="summary-value" id="ap-total">0 د.ك</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">عدد الفواتير</div>
                                <div class="summary-value" id="ap-count">0</div>
                            </div>
                            <div class="summary-card">
                                <div class="summary-title">متوسط المستحقات</div>
                                <div class="summary-value" id="ap-average">0 د.ك</div>
                            </div>
                        </div>

                        <div class="data-container">
                            <div class="report-actions">
                                <button class="secondary-btn" id="print-ap-report">
                                    <i class="fas fa-print"></i>
                                    طباعة
                                </button>
                                <button class="secondary-btn" id="export-ap-report">
                                    <i class="fas fa-file-export"></i>
                                    تصدير Excel
                                </button>
                            </div>

                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>رقم الفاتورة</th>
                                        <th>التاريخ</th>
                                        <th>المورد</th>
                                        <th>إجمالي الفاتورة</th>
                                        <th>المدفوع</th>
                                        <th>المتبقي</th>
                                        <th>تاريخ الاستحقاق</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="ap-table">
                                    <!-- سيتم ملؤها ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other Pages Content (Hidden by default) -->
            <div id="otherContent" style="display: none;">
                <div class="card" style="padding: 50px; text-align: center;">
                    <h2 style="margin-bottom: 20px; color: #757575;">هذه الصفحة قيد التطوير</h2>
                    <p>سيتم إضافة هذه الميزة في الإصدار القادم من النظام.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة منتج جديد</div>
                <div class="modal-close" id="closeProductModal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label class="form-label">الكود</label>
                    <input type="text" class="form-input" id="productCode" placeholder="أدخل كود المنتج">
                </div>
                <div class="form-row">
                    <label class="form-label">الباركود</label>
                    <input type="text" class="form-input" id="productBarcode" placeholder="أدخل باركود المنتج">
                </div>
                <div class="form-row">
                    <label class="form-label">اسم المنتج</label>
                    <input type="text" class="form-input" id="productName" placeholder="أدخل اسم المنتج">
                </div>
                <div class="form-row">
                    <label class="form-label">الوحدة</label>
                    <select class="form-select" id="productUnit">
                        <option value="قطعة">قطعة</option>
                        <option value="كرتون">كرتون</option>
                        <option value="كيلو">كيلو</option>
                        <option value="متر">متر</option>
                        <option value="لتر">لتر</option>
                    </select>
                </div>
                <div class="form-row">
                    <label class="form-label">سعر الشراء</label>
                    <input type="number" class="form-input" id="productPurchasePrice" placeholder="أدخل سعر الشراء">
                </div>
                <div class="form-row">
                    <label class="form-label">سعر البيع</label>
                    <input type="number" class="form-input" id="productSalePrice" placeholder="أدخل سعر البيع">
                </div>
                <div class="form-row">
                    <label class="form-label">المخزون الأولي</label>
                    <input type="number" class="form-input" id="productInitialStock" placeholder="أدخل المخزون الأولي">
                </div>
                <div class="form-row">
                    <label class="form-label">حد الطلب</label>
                    <input type="number" class="form-input" id="productMinStock" placeholder="أدخل حد الطلب">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" id="cancelProductBtn">إلغاء</button>
                <button class="primary-btn" id="saveProductBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- Customer Modal -->
    <div class="modal" id="customerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة عميل جديد</div>
                <div class="modal-close" id="closeCustomerModal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label class="form-label">الكود</label>
                    <input type="text" class="form-input" id="customerCode" placeholder="أدخل كود العميل">
                </div>
                <div class="form-row">
                    <label class="form-label">اسم العميل</label>
                    <input type="text" class="form-input" id="customerName" placeholder="أدخل اسم العميل">
                </div>
                <div class="form-row">
                    <label class="form-label">جهة الاتصال</label>
                    <input type="text" class="form-input" id="customerContact" placeholder="أدخل اسم جهة الاتصال">
                </div>
                <div class="form-row">
                    <label class="form-label">الهاتف</label>
                    <input type="text" class="form-input" id="customerPhone" placeholder="أدخل رقم الهاتف">
                </div>
                <div class="form-row">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" id="customerEmail" placeholder="أدخل البريد الإلكتروني">
                </div>
                <div class="form-row">
                    <label class="form-label">العنوان</label>
                    <input type="text" class="form-input" id="customerAddress" placeholder="أدخل العنوان">
                </div>
                <div class="form-row">
                    <label class="form-label">الرصيد الافتتاحي</label>
                    <input type="number" class="form-input" id="customerBalance" placeholder="أدخل الرصيد الافتتاحي">
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" id="cancelCustomerBtn">إلغاء</button>
                <button class="primary-btn" id="saveCustomerBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- Expense Modal -->
    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة مصروف جديد</div>
                <div class="modal-close" id="closeExpenseModal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label class="form-label">التاريخ</label>
                    <input type="date" class="form-input" id="expenseDate">
                </div>
                <div class="form-row">
                    <label class="form-label">الفئة</label>
                    <select class="form-select" id="expenseCategory">
                        <option value="">اختر الفئة</option>
                        <option value="رواتب">رواتب</option>
                        <option value="إيجار">إيجار</option>
                        <option value="مرافق">مرافق (كهرباء، ماء، إنترنت)</option>
                        <option value="صيانة">صيانة</option>
                        <option value="تسويق">تسويق وإعلان</option>
                        <option value="مكتبية">مستلزمات مكتبية</option>
                        <option value="سفر">سفر ومواصلات</option>
                        <option value="تأمين">تأمين</option>
                        <option value="ضرائب">ضرائب ورسوم</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                <div class="form-row">
                    <label class="form-label">الوصف</label>
                    <input type="text" class="form-input" id="expenseDescription" placeholder="أدخل وصف المصروف">
                </div>
                <div class="form-row">
                    <label class="form-label">المبلغ</label>
                    <input type="number" class="form-input" id="expenseAmount" placeholder="أدخل مبلغ المصروف">
                </div>
                <div class="form-row">
                    <label class="form-label">طريقة الدفع</label>
                    <select class="form-select" id="expensePaymentMethod">
                        <option value="cash">نقدي</option>
                        <option value="bank">تحويل بنكي</option>
                        <option value="check">شيك</option>
                        <option value="card">بطاقة ائتمان</option>
                    </select>
                </div>
                <div class="form-row">
                    <label class="form-label">المستفيد</label>
                    <input type="text" class="form-input" id="expenseBeneficiary" placeholder="أدخل اسم المستفيد">
                </div>
                <div class="form-row">
                    <label class="form-label">رقم المرجع</label>
                    <input type="text" class="form-input" id="expenseReference" placeholder="أدخل رقم المرجع (اختياري)">
                </div>
                <div class="form-row">
                    <label class="form-label">ملاحظات</label>
                    <textarea class="form-input" id="expenseNotes" placeholder="أدخل ملاحظات إضافية"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" id="cancelExpenseBtn">إلغاء</button>
                <button class="primary-btn" id="saveExpenseBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div class="modal" id="supplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة مورد جديد</div>
                <div class="modal-close" id="closeSupplierModal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <label class="form-label">الكود</label>
                    <input type="text" class="form-input" id="supplierCode" placeholder="أدخل كود المورد">
                </div>
                <div class="form-row">
                    <label class="form-label">اسم المورد</label>
                    <input type="text" class="form-input" id="supplierName" placeholder="أدخل اسم المورد">
                </div>
                <div class="form-row">
                    <label class="form-label">جهة الاتصال</label>
                    <input type="text" class="form-input" id="supplierContact" placeholder="أدخل اسم جهة الاتصال">
                </div>
                <div class="form-row">
                    <label class="form-label">الهاتف</label>
                    <input type="text" class="form-input" id="supplierPhone" placeholder="أدخل رقم الهاتف">
                </div>
                <div class="form-row">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-input" id="supplierEmail" placeholder="أدخل البريد الإلكتروني">
                </div>
                <div class="form-row">
                    <label class="form-label">العنوان</label>
                    <input type="text" class="form-input" id="supplierAddress" placeholder="أدخل العنوان">
                </div>
                <div class="form-row">
                    <label class="form-label">الرصيد الافتتاحي</label>
                    <input type="number" class="form-input" id="supplierBalance" placeholder="أدخل الرصيد الافتتاحي">
                </div>
                <div class="form-row">
                    <label class="form-label">ملاحظات</label>
                    <textarea class="form-input" id="supplierNotes" placeholder="أدخل ملاحظات إضافية"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" id="cancelSupplierBtn">إلغاء</button>
                <button class="primary-btn" id="saveSupplierBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- Purchase Invoice Modal -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content" style="width: 90%; max-width: 1200px;">
            <div class="modal-header">
                <div class="modal-title">فاتورة مشتريات جديدة</div>
                <div class="modal-close" id="closePurchaseModal">&times;</div>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">رقم الفاتورة</label>
                        <input type="text" class="form-input" id="purchaseInvoiceNumber" placeholder="رقم الفاتورة">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">التاريخ</label>
                        <input type="date" class="form-input" id="purchaseInvoiceDate">
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label class="form-label">المورد</label>
                        <select class="form-select" id="purchaseInvoiceSupplier">
                            <option value="">اختر المورد</option>
                            <!-- سيتم ملؤها ديناميكيًا -->
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">طريقة الدفع</label>
                        <select class="form-select" id="purchaseInvoicePaymentMethod">
                            <option value="cash">نقدي</option>
                            <option value="card">بطاقة ائتمان</option>
                            <option value="bank">تحويل بنكي</option>
                            <option value="credit">آجل</option>
                        </select>
                    </div>
                    <div class="form-group" style="flex: 2;">
                        <label class="form-label">ملاحظات</label>
                        <input type="text" class="form-input" id="purchaseInvoiceNotes" placeholder="ملاحظات">
                    </div>
                </div>

                <div class="table-container" style="margin: 20px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <h3>بنود الفاتورة</h3>
                        <button class="secondary-btn" id="addPurchaseItemBtn">
                            <i class="fas fa-plus"></i>
                            إضافة بند
                        </button>
                    </div>
                    <table class="data-table" id="purchaseInvoiceItemsTable">
                        <thead>
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>المنتج</th>
                                <th style="width: 100px;">الكمية</th>
                                <th style="width: 150px;">سعر الشراء</th>
                                <th style="width: 150px;">الخصم</th>
                                <th style="width: 150px;">الإجمالي</th>
                                <th style="width: 50px;"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>
                                    <select class="form-select" style="width: 100%;">
                                        <option value="">اختر الصنف</option>
                                        <!-- سيتم ملؤها ديناميكيًا -->
                                    </select>
                                </td>
                                <td><input type="number" class="form-input item-quantity" value="1" min="1"></td>
                                <td><input type="number" class="form-input item-price" value="0" min="0"></td>
                                <td><input type="number" class="form-input item-discount" value="0" min="0"></td>
                                <td class="item-total">0 ر.س</td>
                                <td class="actions-cell">
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="form-row" style="justify-content: flex-end;">
                    <div class="form-group" style="width: 300px;">
                        <label class="form-label">الإجمالي قبل الضريبة</label>
                        <input type="text" class="form-input" id="purchaseInvoiceSubtotal" value="0 ر.س" readonly>
                    </div>
                </div>
                <div class="form-row" style="justify-content: flex-end;">
                    <div class="form-group" style="width: 300px;">
                        <label class="form-label">الخصم</label>
                        <input type="number" class="form-input" id="purchaseInvoiceDiscount" value="0" min="0">
                    </div>
                </div>
                <div class="form-row" style="justify-content: flex-end;">
                    <div class="form-group" style="width: 300px;">
                        <label class="form-label">الضريبة (15%)</label>
                        <input type="text" class="form-input" id="purchaseInvoiceTax" value="0 ر.س" readonly>
                    </div>
                </div>
                <div class="form-row" style="justify-content: flex-end;">
                    <div class="form-group" style="width: 300px;">
                        <label class="form-label">الإجمالي النهائي</label>
                        <input type="text" class="form-input" id="purchaseInvoiceTotal" value="0 ر.س" readonly>
                    </div>
                </div>
                <div class="form-row" style="justify-content: flex-end;">
                    <div class="form-group" style="width: 300px;">
                        <label class="form-label">المدفوع</label>
                        <input type="number" class="form-input" id="purchaseInvoicePaid" value="0" min="0">
                    </div>
                </div>
                <div class="form-row" style="justify-content: flex-end;">
                    <div class="form-group" style="width: 300px;">
                        <label class="form-label">المتبقي</label>
                        <input type="text" class="form-input" id="purchaseInvoiceRemaining" value="0 ر.س" readonly>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" id="cancelPurchaseBtn">إلغاء</button>
                <button class="primary-btn" id="savePurchaseBtn">حفظ</button>
            </div>
        </div>
    </div>

    <!-- Sales Invoice Modal -->
    <div class="modal" id="saleModal">
        <div class="modal-content" style="width: 800px; max-width: 95%;">
            <div class="modal-header">
                <div class="modal-title">فاتورة مبيعات جديدة</div>
                <div class="modal-close" id="closeSaleModal">&times;</div>
            </div>
            <div class="modal-body">
                <!-- Invoice Header -->
                <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                    <div style="flex: 1;">
                        <div class="form-row">
                            <label class="form-label">رقم الفاتورة</label>
                            <input type="text" class="form-input" id="invoiceNumber" value="INV-2023-004" readonly>
                        </div>
                        <div class="form-row">
                            <label class="form-label">التاريخ</label>
                            <input type="date" class="form-input" id="invoiceDate" value="2023-05-16">
                        </div>
                    </div>
                    <div style="flex: 1;">
                        <div class="form-row">
                            <label class="form-label">العميل</label>
                            <select class="form-select" id="invoiceCustomer">
                                <option value="">اختر العميل</option>
                                <option value="1">شركة الأمل التجارية</option>
                                <option value="2">مؤسسة النور</option>
                                <option value="3">شركة السلام</option>
                                <option value="4">مؤسسة الفجر</option>
                            </select>
                        </div>
                        <div class="form-row">
                            <label class="form-label">طريقة الدفع</label>
                            <select class="form-select" id="invoicePaymentMethod">
                                <option value="cash">نقدي</option>
                                <option value="credit">آجل</option>
                                <option value="bank">تحويل بنكي</option>
                                <option value="check">شيك</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Invoice Items -->
                <div style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3 style="margin: 0;">بنود الفاتورة</h3>
                        <button class="secondary-btn" id="addItemBtn">
                            <i class="fas fa-plus"></i>
                            إضافة صنف
                        </button>
                    </div>

                    <table class="data-table" id="invoiceItemsTable">
                        <thead>
                            <tr>
                                <th style="width: 5%;">#</th>
                                <th style="width: 30%;">الصنف</th>
                                <th style="width: 10%;">الكمية</th>
                                <th style="width: 15%;">سعر الوحدة</th>
                                <th style="width: 10%;">الخصم</th>
                                <th style="width: 15%;">الإجمالي</th>
                                <th style="width: 15%;">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>
                                    <select class="form-select" style="width: 100%;">
                                        <option value="">اختر الصنف</option>
                                        <option value="1">لابتوب HP ProBook</option>
                                        <option value="2">طابعة Canon</option>
                                        <option value="3">ماوس لاسلكي</option>
                                        <option value="4">لوحة مفاتيح</option>
                                        <option value="5">شاشة Samsung</option>
                                    </select>
                                </td>
                                <td><input type="number" class="form-input item-quantity" value="1" min="1"></td>
                                <td><input type="number" class="form-input item-price" value="4200" min="0"></td>
                                <td><input type="number" class="form-input item-discount" value="0" min="0"></td>
                                <td class="item-total">4,200 ر.س</td>
                                <td class="actions-cell">
                                    <i class="fas fa-trash action-icon delete-icon"></i>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Invoice Totals -->
                <div style="display: flex; justify-content: flex-end;">
                    <div style="width: 300px;">
                        <div class="form-row">
                            <label class="form-label">الإجمالي</label>
                            <input type="text" class="form-input" id="invoiceSubtotal" value="4,200 ر.س" readonly>
                        </div>
                        <div class="form-row">
                            <label class="form-label">الخصم</label>
                            <input type="number" class="form-input" id="invoiceDiscount" value="0" min="0">
                        </div>
                        <div class="form-row">
                            <label class="form-label">الضريبة (15%)</label>
                            <input type="text" class="form-input" id="invoiceTax" value="630 ر.س" readonly>
                        </div>
                        <div class="form-row">
                            <label class="form-label">الإجمالي النهائي</label>
                            <input type="text" class="form-input" id="invoiceTotal" value="4,830 ر.س" readonly style="font-weight: bold; color: #009688;">
                        </div>
                        <div class="form-row">
                            <label class="form-label">المدفوع</label>
                            <input type="number" class="form-input" id="invoicePaid" value="4830" min="0">
                        </div>
                        <div class="form-row">
                            <label class="form-label">المتبقي</label>
                            <input type="text" class="form-input" id="invoiceRemaining" value="0 ر.س" readonly>
                        </div>
                    </div>
                </div>

                <!-- Notes -->
                <div class="form-row">
                    <label class="form-label">ملاحظات</label>
                    <textarea class="form-input" id="invoiceNotes" rows="3" placeholder="أدخل ملاحظات الفاتورة"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" id="cancelSaleBtn">إلغاء</button>
                <button class="primary-btn" id="saveSaleBtn">حفظ</button>
            </div>
        </div>
    </div>

    <script>
        // تهيئة قاعدة البيانات عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // إضافة وظائف النسخ الاحتياطي واستعادة البيانات
            // إضافة وظائف المخزون
            window.db.inventory = {
                // الحصول على جميع حركات المخزون
                getTransactions: function() {
                    return new Promise((resolve, reject) => {
                        try {
                            const transactions = JSON.parse(localStorage.getItem('inventory_transactions')) || [];
                            resolve(transactions);
                        } catch (error) {
                            reject(error);
                        }
                    });
                },

                // إضافة حركة مخزون جديدة
                addTransaction: function(transaction) {
                    return new Promise((resolve, reject) => {
                        try {
                            const transactions = JSON.parse(localStorage.getItem('inventory_transactions')) || [];

                            // إضافة معرف للحركة
                            transaction.id = transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1;

                            // إضافة الحركة إلى المصفوفة
                            transactions.push(transaction);

                            // حفظ المصفوفة في التخزين المحلي
                            localStorage.setItem('inventory_transactions', JSON.stringify(transactions));

                            resolve(transaction.id);
                        } catch (error) {
                            reject(error);
                        }
                    });
                }
            };

            // إضافة وظائف التقارير
            window.db.reports = {
                // تقرير المخزون
                inventory: function() {
                    return new Promise((resolve, reject) => {
                        try {
                            // الحصول على جميع المنتجات
                            window.db.products.getAll()
                                .then(products => {
                                    // حساب قيمة المخزون لكل منتج
                                    const productsWithValue = products.map(product => {
                                        const stock = product.stock || 0;
                                        const value = stock * product.purchasePrice;

                                        return {
                                            ...product,
                                            stock,
                                            value
                                        };
                                    });

                                    // حساب إحصائيات المخزون
                                    const totalValue = productsWithValue.reduce((sum, product) => sum + product.value, 0);
                                    const lowStockCount = productsWithValue.filter(product => product.stock <= product.minStock && product.stock > 0).length;
                                    const outOfStockCount = productsWithValue.filter(product => product.stock === 0).length;

                                    resolve({
                                        products: productsWithValue,
                                        stats: {
                                            totalValue,
                                            totalCount: productsWithValue.length,
                                            lowStockCount,
                                            outOfStockCount
                                        }
                                    });
                                })
                                .catch(error => reject(error));
                        } catch (error) {
                            reject(error);
                        }
                    });
                }
            };

            // إضافة وظيفة حذف قاعدة البيانات
            window.db.deleteDatabase = function() {
                return new Promise((resolve, reject) => {
                    try {
                        // استدعاء وظيفة حذف قاعدة البيانات من ملف database.js
                        deleteDatabase()
                            .then(() => {
                                console.log('تم حذف قاعدة البيانات بنجاح');
                                resolve(true);
                            })
                            .catch(error => {
                                console.error('خطأ في حذف قاعدة البيانات:', error);
                                reject(error);
                            });
                    } catch (error) {
                        console.error('خطأ غير متوقع في حذف قاعدة البيانات:', error);
                        reject(error);
                    }
                });
            };

            window.db.backup = {
                // إنشاء نسخة احتياطية من جميع البيانات
                create: function() {
                    return new Promise((resolve, reject) => {
                        try {
                            // جمع جميع البيانات من التخزين المحلي
                            const backupData = {
                                products: JSON.parse(localStorage.getItem('products')) || [],
                                customers: JSON.parse(localStorage.getItem('customers')) || [],
                                suppliers: JSON.parse(localStorage.getItem('suppliers')) || [],
                                invoices: JSON.parse(localStorage.getItem('invoices')) || [],
                                expenses: JSON.parse(localStorage.getItem('expenses')) || [],
                                inventory_transactions: JSON.parse(localStorage.getItem('inventory_transactions')) || [],
                                settings: JSON.parse(localStorage.getItem('settings')) || {},
                                users: JSON.parse(localStorage.getItem('users')) || [],
                                version: '1.0',
                                timestamp: new Date().toISOString()
                            };

                            resolve(backupData);
                        } catch (error) {
                            reject(error);
                        }
                    });
                },

                // استعادة البيانات من نسخة احتياطية
                restore: function(backupData) {
                    return new Promise((resolve, reject) => {
                        try {
                            // التحقق من صحة البيانات
                            if (!backupData || typeof backupData !== 'object') {
                                reject(new Error('بيانات النسخة الاحتياطية غير صالحة'));
                                return;
                            }

                            // استعادة البيانات إلى التخزين المحلي
                            if (Array.isArray(backupData.products)) {
                                localStorage.setItem('products', JSON.stringify(backupData.products));
                            }

                            if (Array.isArray(backupData.customers)) {
                                localStorage.setItem('customers', JSON.stringify(backupData.customers));
                            }

                            if (Array.isArray(backupData.suppliers)) {
                                localStorage.setItem('suppliers', JSON.stringify(backupData.suppliers));
                            }

                            if (Array.isArray(backupData.invoices)) {
                                localStorage.setItem('invoices', JSON.stringify(backupData.invoices));
                            }

                            if (Array.isArray(backupData.expenses)) {
                                localStorage.setItem('expenses', JSON.stringify(backupData.expenses));
                            }

                            if (Array.isArray(backupData.inventory_transactions)) {
                                localStorage.setItem('inventory_transactions', JSON.stringify(backupData.inventory_transactions));
                            }

                            if (backupData.settings && typeof backupData.settings === 'object') {
                                localStorage.setItem('settings', JSON.stringify(backupData.settings));
                            }

                            if (Array.isArray(backupData.users)) {
                                localStorage.setItem('users', JSON.stringify(backupData.users));
                            }

                            resolve(true);
                        } catch (error) {
                            reject(error);
                        }
                    });
                }
            };

            // التحقق من وجود كائن قاعدة البيانات
            if (!window.db || typeof window.db.init !== 'function') {
                console.error('خطأ: كائن قاعدة البيانات غير موجود أو وظيفة init غير موجودة');
                alert('خطأ في تهيئة قاعدة البيانات: كائن قاعدة البيانات غير موجود أو وظيفة init غير موجودة');
                return;
            }

            // تهيئة قاعدة البيانات
            window.db.init()
                .then((dbInstance) => {
                    console.log('تم تهيئة قاعدة البيانات بنجاح', dbInstance);

                    // التحقق من وجود مخازن البيانات
                    if (dbInstance && dbInstance.objectStoreNames) {
                        console.log('مخازن البيانات المتاحة:', Array.from(dbInstance.objectStoreNames));
                    }

                    // تعيين رمز العملة الافتراضي
                    window.currencySymbol = 'د.ك'; // الدينار الكويتي

                    loadInitialData();
                })
                .catch(error => {
                    console.error('خطأ في تهيئة قاعدة البيانات:', error);
                    alert('حدث خطأ في تهيئة قاعدة البيانات. يرجى تحديث الصفحة والمحاولة مرة أخرى.');
                });
        });

        // تحميل البيانات الأولية
        function loadInitialData() {
            // تحميل المنتجات
            window.db.products.getAll()
                .then(products => {
                    console.log('تم تحميل المنتجات:', products);
                    if (products.length === 0) {
                        // إضافة بعض المنتجات الافتراضية إذا كانت قاعدة البيانات فارغة
                        const defaultProducts = [
                            {
                                code: 'P001',
                                barcode: '123456789',
                                name: 'لابتوب HP ProBook',
                                description: 'لابتوب HP ProBook i7',
                                unit: 'قطعة',
                                purchasePrice: 3500,
                                salePrice: 4200,
                                minStock: 5,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'P002',
                                barcode: '987654321',
                                name: 'طابعة Canon',
                                description: 'طابعة Canon ليزر',
                                unit: 'قطعة',
                                purchasePrice: 800,
                                salePrice: 950,
                                minStock: 3,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'P003',
                                barcode: '456789123',
                                name: 'ماوس لاسلكي',
                                description: 'ماوس لاسلكي Logitech',
                                unit: 'قطعة',
                                purchasePrice: 50,
                                salePrice: 75,
                                minStock: 10,
                                isActive: true,
                                createdAt: new Date()
                            }
                        ];

                        // إضافة المنتجات الافتراضية
                        defaultProducts.forEach(product => {
                            window.db.products.add(product)
                                .then(id => console.log(`تم إضافة المنتج ${product.name} بنجاح، المعرف: ${id}`))
                                .catch(error => console.error(`خطأ في إضافة المنتج ${product.name}:`, error));
                        });
                    }
                })
                .catch(error => console.error('خطأ في تحميل المنتجات:', error));

            // تحميل العملاء
            window.db.customers.getAll()
                .then(customers => {
                    console.log('تم تحميل العملاء:', customers);
                    if (customers.length === 0) {
                        // إضافة بعض العملاء الافتراضيين إذا كانت قاعدة البيانات فارغة
                        const defaultCustomers = [
                            {
                                code: 'C001',
                                name: 'شركة الأمل التجارية',
                                contactPerson: 'أحمد محمد',
                                phone: '0555123456',
                                email: 'info@alamal.com',
                                address: 'الرياض - شارع الملك فهد',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'C002',
                                name: 'مؤسسة النور',
                                contactPerson: 'خالد عبدالله',
                                phone: '0555789456',
                                email: 'info@alnoor.com',
                                address: 'جدة - شارع التحلية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            }
                        ];

                        // إضافة العملاء الافتراضيين
                        defaultCustomers.forEach(customer => {
                            window.db.customers.add(customer)
                                .then(id => console.log(`تم إضافة العميل ${customer.name} بنجاح، المعرف: ${id}`))
                                .catch(error => console.error(`خطأ في إضافة العميل ${customer.name}:`, error));
                        });
                    }
                })
                .catch(error => console.error('خطأ في تحميل العملاء:', error));

            // تحميل الموردين
            window.db.suppliers.getAll()
                .then(suppliers => {
                    console.log('تم تحميل الموردين:', suppliers);
                    if (suppliers.length === 0) {
                        // إضافة بعض الموردين الافتراضيين إذا كانت قاعدة البيانات فارغة
                        const defaultSuppliers = [
                            {
                                code: 'S001',
                                name: 'شركة الإلكترونيات المتقدمة',
                                contactPerson: 'أحمد محمد',
                                phone: '0555555555',
                                email: 'ahmed@example.com',
                                address: 'الرياض، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S002',
                                name: 'مؤسسة التقنية الحديثة',
                                contactPerson: 'محمد علي',
                                phone: '0566666666',
                                email: 'mohammed@example.com',
                                address: 'جدة، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S003',
                                name: 'شركة الأجهزة الذكية',
                                contactPerson: 'خالد عبدالله',
                                phone: '0577777777',
                                email: 'khaled@example.com',
                                address: 'الدمام، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S004',
                                name: 'مؤسسة الحاسبات المتطورة',
                                contactPerson: 'سعيد محمد',
                                phone: '0588888888',
                                email: 'saeed@example.com',
                                address: 'المدينة المنورة، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S005',
                                name: 'شركة الطابعات العالمية',
                                contactPerson: 'فهد سعد',
                                phone: '0599999999',
                                email: 'fahad@example.com',
                                address: 'مكة المكرمة، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S006',
                                name: 'مؤسسة الشبكات المتكاملة',
                                contactPerson: 'عبدالرحمن علي',
                                phone: '0511111111',
                                email: 'abdulrahman@example.com',
                                address: 'الطائف، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S007',
                                name: 'شركة البرمجيات المتقدمة',
                                contactPerson: 'ياسر أحمد',
                                phone: '0522222222',
                                email: 'yasser@example.com',
                                address: 'أبها، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S008',
                                name: 'مؤسسة الأمن السيبراني',
                                contactPerson: 'عمر محمد',
                                phone: '0533333333',
                                email: 'omar@example.com',
                                address: 'الخبر، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S009',
                                name: 'شركة الاتصالات الرقمية',
                                contactPerson: 'ناصر سعيد',
                                phone: '0544444444',
                                email: 'nasser@example.com',
                                address: 'الجبيل، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S010',
                                name: 'مؤسسة الخدمات التقنية',
                                contactPerson: 'سلطان فهد',
                                phone: '0555555556',
                                email: 'sultan@example.com',
                                address: 'ينبع، السعودية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            // إضافة 20 موردًا جديدًا
                            {
                                code: 'S011',
                                name: 'شركة الأثاث المنزلي',
                                contactPerson: 'عبدالعزيز محمد',
                                phone: '0577777779',
                                email: 'abdulaziz@example.com',
                                address: 'الكويت - الفروانية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S012',
                                name: 'مؤسسة الإلكترونيات الحديثة',
                                contactPerson: 'فيصل العتيبي',
                                phone: '0588888890',
                                email: 'faisal.otaibi@example.com',
                                address: 'الكويت - حولي',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S013',
                                name: 'شركة الأجهزة المنزلية الذكية',
                                contactPerson: 'خالد الدوسري',
                                phone: '0599999991',
                                email: 'khaled.dossary@example.com',
                                address: 'الكويت - السالمية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S014',
                                name: 'مؤسسة المستلزمات المكتبية',
                                contactPerson: 'سعد العجمي',
                                phone: '0511111113',
                                email: 'saad.ajmi@example.com',
                                address: 'الكويت - الجهراء',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S015',
                                name: 'شركة الأدوات المنزلية',
                                contactPerson: 'عبدالله المطيري',
                                phone: '0522222224',
                                email: 'abdullah.mutairi@example.com',
                                address: 'الكويت - الأحمدي',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S016',
                                name: 'مؤسسة الديكورات الداخلية',
                                contactPerson: 'محمد الشمري',
                                phone: '0533333335',
                                email: 'mohammed.shammari@example.com',
                                address: 'الكويت - مبارك الكبير',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S017',
                                name: 'شركة الأثاث المكتبي الفاخر',
                                contactPerson: 'عمر الرشيدي',
                                phone: '0544444446',
                                email: 'omar.rashidi@example.com',
                                address: 'الكويت - الفحيحيل',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S018',
                                name: 'مؤسسة الأجهزة الكهربائية',
                                contactPerson: 'ناصر العنزي',
                                phone: '0555555558',
                                email: 'nasser.anazi@example.com',
                                address: 'الكويت - الشويخ',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S019',
                                name: 'شركة المفروشات العصرية',
                                contactPerson: 'بدر الهاجري',
                                phone: '0566666669',
                                email: 'badr.hajri@example.com',
                                address: 'الكويت - الرقة',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S020',
                                name: 'مؤسسة الأدوات الصحية',
                                contactPerson: 'سلطان القحطاني',
                                phone: '0577777780',
                                email: 'sultan.qahtani@example.com',
                                address: 'الكويت - العاصمة',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S021',
                                name: 'شركة مواد البناء الحديثة',
                                contactPerson: 'فهد المالكي',
                                phone: '0588888891',
                                email: 'fahad.malki@example.com',
                                address: 'الكويت - حولي',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S022',
                                name: 'مؤسسة الأدوات الزراعية',
                                contactPerson: 'عبدالرحمن الحربي',
                                phone: '0599999992',
                                email: 'abdulrahman.harbi@example.com',
                                address: 'الكويت - الفروانية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S023',
                                name: 'شركة المعدات الثقيلة',
                                contactPerson: 'سعود العتيبي',
                                phone: '0511111114',
                                email: 'saud.otaibi@example.com',
                                address: 'الكويت - الجهراء',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S024',
                                name: 'مؤسسة الأدوات الكهربائية',
                                contactPerson: 'طلال الرشيدي',
                                phone: '0522222225',
                                email: 'talal.rashidi@example.com',
                                address: 'الكويت - السالمية',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S025',
                                name: 'شركة الأجهزة الطبية المتطورة',
                                contactPerson: 'مشعل العازمي',
                                phone: '0533333336',
                                email: 'meshal.azmi@example.com',
                                address: 'الكويت - الأحمدي',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S026',
                                name: 'مؤسسة الأدوات الرياضية المتخصصة',
                                contactPerson: 'عادل المطيري',
                                phone: '0544444447',
                                email: 'adel.mutairi@example.com',
                                address: 'الكويت - مبارك الكبير',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S027',
                                name: 'شركة الأثاث المنزلي الفاخر',
                                contactPerson: 'يوسف الكندري',
                                phone: '0555555559',
                                email: 'yousef.kandari@example.com',
                                address: 'الكويت - الفحيحيل',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S028',
                                name: 'مؤسسة الإلكترونيات الاستهلاكية',
                                contactPerson: 'جاسم العنزي',
                                phone: '0566666670',
                                email: 'jassim.anazi@example.com',
                                address: 'الكويت - الشويخ',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S029',
                                name: 'شركة الأدوات المنزلية العصرية',
                                contactPerson: 'فيصل الشمري',
                                phone: '0577777781',
                                email: 'faisal.shammari@example.com',
                                address: 'الكويت - الرقة',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            },
                            {
                                code: 'S030',
                                name: 'مؤسسة التجهيزات الفندقية',
                                contactPerson: 'عبدالله الخالدي',
                                phone: '0588888892',
                                email: 'abdullah.khalidi@example.com',
                                address: 'الكويت - العاصمة',
                                balance: 0,
                                isActive: true,
                                createdAt: new Date()
                            }
                        ];

                        // إضافة الموردين الافتراضيين
                        defaultSuppliers.forEach(supplier => {
                            window.db.suppliers.add(supplier)
                                .then(id => console.log(`تم إضافة المورد ${supplier.name} بنجاح، المعرف: ${id}`))
                                .catch(error => console.error(`خطأ في إضافة المورد ${supplier.name}:`, error));
                        });
                    }
                })
                .catch(error => console.error('خطأ في تحميل الموردين:', error));
        }

        // Login functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');

            if (!username || !password) {
                errorMessage.textContent = 'الرجاء إدخال اسم المستخدم وكلمة المرور';
                errorMessage.style.display = 'block';
                return;
            }

            // التحقق من صحة بيانات تسجيل الدخول
            window.db.auth.login(username, password)
                .then(user => {
                    console.log('تم تسجيل الدخول بنجاح:', user);

                    // تخزين بيانات المستخدم في الجلسة
                    sessionStorage.setItem('currentUser', JSON.stringify(user));

                    // إخفاء شاشة تسجيل الدخول وإظهار الشاشة الرئيسية
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('dashboardScreen').style.display = 'block';
                    errorMessage.style.display = 'none';

                    // تحميل الإعدادات أولاً
                    loadSettings();

                    // تحميل البيانات في الشاشة الرئيسية
                    loadDashboardData();
                    loadProductsData();
                    loadCustomersData();
                    loadSuppliersData();
                    loadExpensesData();
                    loadInvoicesData();
                    loadPurchasesData(); // تحميل بيانات المشتريات
                    loadInventoryData(); // تحميل بيانات المخزون
                    loadPosData();

                    console.log('تم تحميل جميع البيانات');

                    // تعيين التاريخ الافتراضي في حقول التقارير
                    const today = new Date();
                    const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);

                    // تنسيق التاريخ بصيغة YYYY-MM-DD
                    const formatDate = (date) => {
                        return date.toISOString().split('T')[0];
                    };

                    // تعيين التواريخ الافتراضية في تقرير المبيعات
                    document.getElementById('sales-from-date').value = formatDate(firstDayOfMonth);
                    document.getElementById('sales-to-date').value = formatDate(today);

                    // تعيين التواريخ الافتراضية في تقرير العملاء
                    document.getElementById('customer-from-date').value = formatDate(firstDayOfMonth);
                    document.getElementById('customer-to-date').value = formatDate(today);

                    // تعيين التواريخ الافتراضية في تقرير الأرباح
                    document.getElementById('profit-from-date').value = formatDate(firstDayOfMonth);
                    document.getElementById('profit-to-date').value = formatDate(today);

                    // تحميل العملاء في قائمة تقرير المبيعات
                    window.db.customers.getAll()
                        .then(customers => {
                            const customerSelect = document.getElementById('sales-customer');
                            customerSelect.innerHTML = '<option value="">جميع العملاء</option>';

                            customers.forEach(customer => {
                                const option = document.createElement('option');
                                option.value = customer.id;
                                option.text = customer.name;
                                customerSelect.add(option);
                            });
                        })
                        .catch(error => console.error('خطأ في تحميل العملاء:', error));
                })
                .catch(error => {
                    console.error('خطأ في تسجيل الدخول:', error);
                    errorMessage.textContent = error.message || 'اسم المستخدم أو كلمة المرور غير صحيحة';
                    errorMessage.style.display = 'block';
                });
        });

        // وظائف تحميل البيانات

        // تحميل بيانات لوحة التحكم
        function loadDashboardData() {
            // تحميل الفواتير لحساب المبيعات
            window.db.invoices.getAll()
                .then(invoices => {
                    // حساب إجمالي المبيعات والمشتريات
                    let totalSales = 0;
                    let totalPurchases = 0;

                    invoices.forEach(invoice => {
                        if (invoice.type === 'sale') {
                            totalSales += invoice.total;
                        } else if (invoice.type === 'purchase') {
                            totalPurchases += invoice.total;
                        }
                    });

                    // تحديث بطاقات الإحصائيات
                    document.querySelector('#dashboardContent .card:nth-child(1) .card-value').textContent = totalSales.toLocaleString() + ' ' + window.currencySymbol;
                    document.querySelector('#dashboardContent .card:nth-child(2) .card-value').textContent = totalPurchases.toLocaleString() + ' ' + window.currencySymbol;

                    // حساب المصروفات والأرباح (مبسط)
                    const expenses = totalPurchases * 0.2; // افتراضي: المصروفات 20% من المشتريات
                    const profit = totalSales - totalPurchases - expenses;

                    document.querySelector('#dashboardContent .card:nth-child(3) .card-value').textContent = expenses.toLocaleString() + ' ' + window.currencySymbol;
                    document.querySelector('#dashboardContent .card:nth-child(4) .card-value').textContent = profit.toLocaleString() + ' ' + window.currencySymbol;

                    // تحديث جدول المعاملات الأخيرة
                    const tbody = document.querySelector('#dashboardContent .transactions-container table tbody');
                    tbody.innerHTML = ''; // مسح الجدول

                    // ترتيب الفواتير حسب التاريخ (الأحدث أولاً)
                    invoices.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // عرض آخر 5 فواتير
                    const recentInvoices = invoices.slice(0, 5);

                    recentInvoices.forEach(invoice => {
                        const row = document.createElement('tr');

                        // تحديد حالة الفاتورة
                        let statusText = '';
                        let statusClass = '';

                        if (invoice.remaining <= 0) {
                            statusText = 'مدفوعة';
                            statusClass = 'status-paid';
                        } else if (invoice.paid > 0) {
                            statusText = 'مدفوعة جزئياً';
                            statusClass = 'status-pending';
                        } else {
                            statusText = 'غير مدفوعة';
                            statusClass = 'status-inactive';
                        }

                        row.innerHTML = `
                            <td>${new Date(invoice.date).toLocaleDateString()}</td>
                            <td>${invoice.type === 'sale' ? 'فاتورة مبيعات' : 'فاتورة مشتريات'}</td>
                            <td>${invoice.invoiceNumber}</td>
                            <td>${invoice.customerName || invoice.supplierName || ''}</td>
                            <td>${invoice.total.toLocaleString()} ${window.currencySymbol}</td>
                            <td class="${statusClass}">${statusText}</td>
                        `;

                        tbody.appendChild(row);
                    });
                })
                .catch(error => console.error('خطأ في تحميل بيانات لوحة التحكم:', error));
        }

        // تحميل بيانات الموردين
        function loadSuppliersData() {
            console.log('جاري تحميل بيانات الموردين...');

            // التحقق من وجود وظيفة getAll في كائن suppliers
            if (!window.db.suppliers || typeof window.db.suppliers.getAll !== 'function') {
                console.error('خطأ: وظيفة window.db.suppliers.getAll غير موجودة');
                alert('خطأ في تحميل بيانات الموردين: وظيفة getAll غير موجودة');
                return;
            }

            window.db.suppliers.getAll()
                .then(suppliers => {
                    console.log('تم استلام بيانات الموردين:', suppliers);
                    const tbody = document.querySelector('#suppliersContent .data-table tbody');

                    if (!tbody) {
                        console.error('خطأ: لم يتم العثور على جدول الموردين في الصفحة');
                        return;
                    }

                    tbody.innerHTML = ''; // مسح الجدول

                    if (suppliers.length === 0) {
                        console.log('لا توجد بيانات موردين');
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td colspan="8" style="text-align: center;">لا توجد بيانات موردين</td>
                        `;
                        tbody.appendChild(row);
                    } else {
                        suppliers.forEach(supplier => {
                            const row = document.createElement('tr');

                            row.innerHTML = `
                                <td>${supplier.code}</td>
                                <td>${supplier.name}</td>
                                <td>${supplier.contactPerson || ''}</td>
                                <td>${supplier.phone || ''}</td>
                                <td>${supplier.email || ''}</td>
                                <td>${supplier.balance.toLocaleString()} ${window.currencySymbol || 'د.ك'}</td>
                                <td><span class="status-active">نشط</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-edit action-icon edit-icon" data-id="${supplier.id}"></i>
                                    <i class="fas fa-trash action-icon delete-icon" data-id="${supplier.id}"></i>
                                    <i class="fas fa-file-invoice-dollar action-icon invoice-icon" data-id="${supplier.id}"></i>
                                </td>
                            `;

                            tbody.appendChild(row);
                        });
                    }

                    // تحديث معلومات الصفحة
                    const paginationInfo = document.querySelector('#suppliersContent .pagination-info');
                    if (paginationInfo) {
                        paginationInfo.textContent = `عرض 1-${suppliers.length} من ${suppliers.length} موردين`;
                    }
                })
                .catch(error => {
                    console.error('خطأ في تحميل بيانات الموردين:', error);
                    alert('حدث خطأ في تحميل بيانات الموردين: ' + error.message);
                });
        }

        // تحميل بيانات المخزون
        function loadInventoryData() {
            console.log('جاري تحميل بيانات المخزون...');

            // تحميل المنتجات أولاً
            window.db.products.getAll()
                .then(products => {
                    console.log('تم تحميل المنتجات:', products);

                    // تحديث جدول حالة المخزون
                    const tbody = document.getElementById('inventory-status-table');
                    tbody.innerHTML = ''; // مسح الجدول

                    products.forEach(product => {
                        const row = document.createElement('tr');

                        // تحديد حالة المخزون
                        let stockStatus = 'متوفر';
                        let stockStatusClass = 'status-active';

                        const stock = product.stock || 0;
                        const minStock = product.minStock || 0;

                        if (stock === 0) {
                            stockStatus = 'نفاذ المخزون';
                            stockStatusClass = 'status-inactive';
                        } else if (stock <= minStock) {
                            stockStatus = 'مخزون منخفض';
                            stockStatusClass = 'status-low';
                        }

                        // حساب قيمة المخزون
                        const value = stock * product.purchasePrice;

                        row.innerHTML = `
                            <td>${product.code}</td>
                            <td>${product.name}</td>
                            <td>${product.unit}</td>
                            <td>${stock}</td>
                            <td>${minStock}</td>
                            <td>${product.purchasePrice.toLocaleString()} ${window.currencySymbol}</td>
                            <td>${product.salePrice.toLocaleString()} ${window.currencySymbol}</td>
                            <td>${value.toLocaleString()} ${window.currencySymbol}</td>
                            <td><span class="${stockStatusClass}">${stockStatus}</span></td>
                        `;

                        tbody.appendChild(row);
                    });

                    // تحديث معلومات الصفحة
                    document.getElementById('inventory-pagination-info').textContent = `عرض 1-${products.length} من ${products.length} منتجات`;

                    // تحميل المنتجات في قائمة تسوية المخزون
                    const productSelect = document.getElementById('adjustment-product');
                    productSelect.innerHTML = '<option value="">اختر المنتج</option>';

                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.text = `${product.name} (${product.code})`;
                        option.dataset.stock = product.stock || 0;
                        productSelect.add(option);
                    });

                    // حساب إحصائيات المخزون
                    const totalValue = products.reduce((sum, product) => sum + ((product.stock || 0) * product.purchasePrice), 0);
                    const lowStockCount = products.filter(product => (product.stock || 0) <= (product.minStock || 0) && (product.stock || 0) > 0).length;
                    const outOfStockCount = products.filter(product => (product.stock || 0) === 0).length;

                    // تحديث إحصائيات تقرير المخزون
                    document.getElementById('inventory-value').textContent = totalValue.toLocaleString() + ' ' + window.currencySymbol;
                    document.getElementById('inventory-count').textContent = products.length;
                    document.getElementById('inventory-low').textContent = lowStockCount;
                    document.getElementById('inventory-out').textContent = outOfStockCount;
                })
                .catch(error => console.error('خطأ في تحميل بيانات المخزون:', error));

            // تحميل حركات المخزون
            window.db.inventory.getTransactions()
                .then(transactions => {
                    console.log('تم تحميل حركات المخزون:', transactions);

                    // ترتيب الحركات حسب التاريخ (الأحدث أولاً)
                    transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // تحديث جدول حركات المخزون
                    const tbody = document.getElementById('inventory-transactions-table');
                    tbody.innerHTML = ''; // مسح الجدول

                    if (transactions.length === 0) {
                        // إضافة صف يشير إلى عدم وجود حركات
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td colspan="7" style="text-align: center;">لا توجد حركات مخزون</td>
                        `;
                        tbody.appendChild(row);
                    } else {
                        transactions.forEach(transaction => {
                            const row = document.createElement('tr');

                            // تحديد نوع الحركة
                            let typeText = '';

                            switch (transaction.type) {
                                case 'add':
                                    typeText = 'إضافة';
                                    break;
                                case 'subtract':
                                    typeText = 'خصم';
                                    break;
                                case 'set':
                                    typeText = 'تعيين';
                                    break;
                                case 'sale':
                                    typeText = 'بيع';
                                    break;
                                case 'purchase':
                                    typeText = 'شراء';
                                    break;
                                default:
                                    typeText = transaction.type;
                            }

                            row.innerHTML = `
                                <td>${new Date(transaction.date).toLocaleDateString()}</td>
                                <td>${transaction.productName || 'غير معروف'}</td>
                                <td>${typeText}</td>
                                <td>${transaction.quantity}</td>
                                <td>${transaction.reference || '-'}</td>
                                <td>${transaction.userName || 'غير معروف'}</td>
                                <td>${transaction.notes || '-'}</td>
                            `;

                            tbody.appendChild(row);
                        });
                    }
                })
                .catch(error => console.error('خطأ في تحميل حركات المخزون:', error));
        }

        // تحميل بيانات المنتجات
        function loadProductsData() {
            window.db.products.getAll()
                .then(products => {
                    const tbody = document.querySelector('#productsContent .data-table tbody');
                    tbody.innerHTML = ''; // مسح الجدول

                    products.forEach(product => {
                        const row = document.createElement('tr');

                        // تحديد حالة المخزون
                        let stockStatus = 'نشط';
                        let stockStatusClass = 'status-active';

                        if (product.stock <= product.minStock) {
                            stockStatus = 'مخزون منخفض';
                            stockStatusClass = 'status-low';
                        }

                        row.innerHTML = `
                            <td>${product.code}</td>
                            <td>${product.barcode || ''}</td>
                            <td>${product.name}</td>
                            <td>${product.unit}</td>
                            <td>${product.purchasePrice.toLocaleString()} ${window.currencySymbol}</td>
                            <td>${product.salePrice.toLocaleString()} ${window.currencySymbol}</td>
                            <td>${product.stock || 0}</td>
                            <td><span class="${stockStatusClass}">${stockStatus}</span></td>
                            <td class="actions-cell">
                                <i class="fas fa-edit action-icon edit-icon" data-id="${product.id}"></i>
                                <i class="fas fa-trash action-icon delete-icon" data-id="${product.id}"></i>
                            </td>
                        `;

                        tbody.appendChild(row);
                    });
                })
                .catch(error => console.error('خطأ في تحميل بيانات المنتجات:', error));
        }

        // تحميل بيانات العملاء
        function loadCustomersData() {
            window.db.customers.getAll()
                .then(customers => {
                    const tbody = document.querySelector('#customersContent .data-table tbody');
                    tbody.innerHTML = ''; // مسح الجدول

                    customers.forEach(customer => {
                        const row = document.createElement('tr');

                        row.innerHTML = `
                            <td>${customer.code}</td>
                            <td>${customer.name}</td>
                            <td>${customer.contactPerson || ''}</td>
                            <td>${customer.phone || ''}</td>
                            <td>${customer.email || ''}</td>
                            <td>${customer.balance.toLocaleString()} ${window.currencySymbol}</td>
                            <td><span class="status-active">نشط</span></td>
                            <td class="actions-cell">
                                <i class="fas fa-edit action-icon edit-icon" data-id="${customer.id}"></i>
                                <i class="fas fa-trash action-icon delete-icon" data-id="${customer.id}"></i>
                                <i class="fas fa-file-invoice-dollar action-icon invoice-icon" data-id="${customer.id}"></i>
                            </td>
                        `;

                        tbody.appendChild(row);
                    });
                })
                .catch(error => console.error('خطأ في تحميل بيانات العملاء:', error));
        }

        // تحميل بيانات فواتير المبيعات
        function loadInvoicesData() {
            window.db.invoices.getAll()
                .then(invoices => {
                    // تصفية فواتير المبيعات فقط
                    const salesInvoices = invoices.filter(invoice => invoice.type === 'sale');

                    const tbody = document.querySelector('#salesContent .data-table tbody');
                    tbody.innerHTML = ''; // مسح الجدول

                    salesInvoices.forEach(invoice => {
                        const row = document.createElement('tr');

                        // تحديد حالة الفاتورة
                        let statusText = '';
                        let statusClass = '';

                        if (invoice.remaining <= 0) {
                            statusText = 'مدفوعة';
                            statusClass = 'status-active';
                        } else if (invoice.paid > 0) {
                            statusText = 'مدفوعة جزئياً';
                            statusClass = 'status-low';
                        } else {
                            statusText = 'غير مدفوعة';
                            statusClass = 'status-inactive';
                        }

                        row.innerHTML = `
                            <td>${invoice.invoiceNumber}</td>
                            <td>${new Date(invoice.date).toLocaleDateString()}</td>
                            <td>${invoice.customerName}</td>
                            <td>${invoice.total.toLocaleString()} ر.س</td>
                            <td>${invoice.paid.toLocaleString()} ر.س</td>
                            <td>${invoice.remaining.toLocaleString()} ر.س</td>
                            <td><span class="${statusClass}">${statusText}</span></td>
                            <td class="actions-cell">
                                <i class="fas fa-eye action-icon view-icon" data-id="${invoice.id}"></i>
                                <i class="fas fa-print action-icon print-icon" data-id="${invoice.id}"></i>
                                <i class="fas fa-trash action-icon delete-icon" data-id="${invoice.id}"></i>
                            </td>
                        `;

                        tbody.appendChild(row);
                    });
                })
                .catch(error => console.error('خطأ في تحميل بيانات فواتير المبيعات:', error));
        }

        // تحميل بيانات فواتير المشتريات
        function loadPurchasesData() {
            console.log('جاري تحميل بيانات فواتير المشتريات...');

            // التحقق من وجود وظيفة getAll في كائن invoices
            if (!window.db.invoices || typeof window.db.invoices.getAll !== 'function') {
                console.error('خطأ: وظيفة window.db.invoices.getAll غير موجودة');
                alert('خطأ في تحميل بيانات فواتير المشتريات: وظيفة getAll غير موجودة');
                return;
            }

            window.db.invoices.getAll()
                .then(invoices => {
                    console.log('تم استلام بيانات الفواتير:', invoices);

                    // تصفية الفواتير للحصول على فواتير المشتريات فقط
                    const purchaseInvoices = invoices.filter(invoice => invoice.type === 'purchase');
                    console.log('فواتير المشتريات:', purchaseInvoices);

                    // ترتيب الفواتير حسب التاريخ (الأحدث أولاً)
                    purchaseInvoices.sort((a, b) => new Date(b.date) - new Date(a.date));

                    // تحديث جدول الفواتير
                    const tbody = document.getElementById('purchasesTableBody');

                    if (!tbody) {
                        console.error('خطأ: لم يتم العثور على جدول المشتريات في الصفحة');
                        return;
                    }

                    tbody.innerHTML = ''; // مسح الجدول

                    if (purchaseInvoices.length === 0) {
                        // إضافة صف يشير إلى عدم وجود فواتير
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td colspan="8" style="text-align: center;">لا توجد فواتير مشتريات</td>
                        `;
                        tbody.appendChild(row);
                    } else {
                        purchaseInvoices.forEach(invoice => {
                            const row = document.createElement('tr');

                            // تحديد حالة الفاتورة
                            let statusText = '';
                            let statusClass = '';

                            if (invoice.remaining <= 0) {
                                statusText = 'مدفوعة';
                                statusClass = 'status-active';
                            } else if (invoice.paid > 0) {
                                statusText = 'مدفوعة جزئياً';
                                statusClass = 'status-low';
                            } else {
                                statusText = 'غير مدفوعة';
                                statusClass = 'status-inactive';
                            }

                            row.innerHTML = `
                                <td>${invoice.invoiceNumber}</td>
                                <td>${new Date(invoice.date).toLocaleDateString()}</td>
                                <td>${invoice.supplierName || 'مورد نقدي'}</td>
                                <td>${invoice.total.toLocaleString()} ${window.currencySymbol}</td>
                                <td>${invoice.paid.toLocaleString()} ${window.currencySymbol}</td>
                                <td>${invoice.remaining.toLocaleString()} ${window.currencySymbol}</td>
                                <td><span class="${statusClass}">${statusText}</span></td>
                                <td class="actions-cell">
                                    <i class="fas fa-eye action-icon view-icon" data-id="${invoice.id}"></i>
                                    <i class="fas fa-print action-icon print-icon" data-id="${invoice.id}"></i>
                                    <i class="fas fa-trash action-icon delete-icon" data-id="${invoice.id}"></i>
                                </td>
                            `;

                            tbody.appendChild(row);
                        });
                    }

                    // تحديث معلومات الصفحة
                    document.getElementById('purchasesPaginationInfo').textContent =
                        `عرض 1-${purchaseInvoices.length} من ${purchaseInvoices.length} فواتير`;
                })
                .catch(error => console.error('خطأ في تحميل بيانات فواتير المشتريات:', error));
        }

        // تحميل بيانات المحاسبة
        function loadAccountingData() {
            console.log('جاري تحميل بيانات المحاسبة...');

            // تحميل بيانات حسابات العملاء
            loadAccountsReceivable();

            // تحميل بيانات حسابات الموردين
            loadAccountsPayable();

            // تحميل بيانات دفتر الأستاذ العام
            loadGeneralLedger();
        }

        // تحميل بيانات حسابات العملاء
        function loadAccountsReceivable() {
            window.db.invoices.getAll()
                .then(invoices => {
                    // تصفية الفواتير للحصول على فواتير المبيعات فقط
                    const salesInvoices = invoices.filter(invoice => invoice.type === 'sale');

                    // تحديث جدول حسابات العملاء
                    const tbody = document.getElementById('ar-table');
                    tbody.innerHTML = ''; // مسح الجدول

                    if (salesInvoices.length === 0) {
                        // إضافة صف يشير إلى عدم وجود فواتير
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td colspan="9" style="text-align: center;">لا توجد فواتير مبيعات</td>
                        `;
                        tbody.appendChild(row);
                    } else {
                        // حساب إجماليات
                        let totalDue = 0;
                        let invoiceCount = 0;

                        salesInvoices.forEach(invoice => {
                            if (invoice.remaining > 0) {
                                invoiceCount++;
                                totalDue += invoice.remaining;

                                const row = document.createElement('tr');

                                // تحديد حالة الفاتورة
                                let statusText = '';
                                let statusClass = '';

                                if (invoice.remaining <= 0) {
                                    statusText = 'مدفوعة';
                                    statusClass = 'status-active';
                                } else if (invoice.paid > 0) {
                                    statusText = 'مدفوعة جزئياً';
                                    statusClass = 'status-low';
                                } else {
                                    statusText = 'غير مدفوعة';
                                    statusClass = 'status-inactive';
                                }

                                // تاريخ الاستحقاق (افتراضي: 30 يوم من تاريخ الفاتورة)
                                const dueDate = new Date(invoice.date);
                                dueDate.setDate(dueDate.getDate() + 30);

                                row.innerHTML = `
                                    <td>${invoice.invoiceNumber}</td>
                                    <td>${new Date(invoice.date).toLocaleDateString()}</td>
                                    <td>${invoice.customerName || 'عميل نقدي'}</td>
                                    <td>${invoice.total.toLocaleString()} ${window.currencySymbol}</td>
                                    <td>${invoice.paid.toLocaleString()} ${window.currencySymbol}</td>
                                    <td>${invoice.remaining.toLocaleString()} ${window.currencySymbol}</td>
                                    <td>${dueDate.toLocaleDateString()}</td>
                                    <td><span class="${statusClass}">${statusText}</span></td>
                                    <td class="actions-cell">
                                        <i class="fas fa-eye action-icon view-icon" data-id="${invoice.id}"></i>
                                        <i class="fas fa-print action-icon print-icon" data-id="${invoice.id}"></i>
                                        <i class="fas fa-money-bill-wave action-icon payment-icon" data-id="${invoice.id}"></i>
                                    </td>
                                `;

                                tbody.appendChild(row);
                            }
                        });

                        // تحديث الإحصائيات
                        document.getElementById('ar-total').textContent = totalDue.toLocaleString() + ' ' + window.currencySymbol;
                        document.getElementById('ar-count').textContent = invoiceCount;
                        document.getElementById('ar-average').textContent = invoiceCount > 0 ?
                            (totalDue / invoiceCount).toLocaleString() + ' ' + window.currencySymbol :
                            '0 ' + window.currencySymbol;
                    }
                })
                .catch(error => console.error('خطأ في تحميل بيانات حسابات العملاء:', error));
        }

        // تحميل بيانات حسابات الموردين
        function loadAccountsPayable() {
            window.db.invoices.getAll()
                .then(invoices => {
                    // تصفية الفواتير للحصول على فواتير المشتريات فقط
                    const purchaseInvoices = invoices.filter(invoice => invoice.type === 'purchase');

                    // تحديث جدول حسابات الموردين
                    const tbody = document.getElementById('ap-table');
                    tbody.innerHTML = ''; // مسح الجدول

                    if (purchaseInvoices.length === 0) {
                        // إضافة صف يشير إلى عدم وجود فواتير
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td colspan="9" style="text-align: center;">لا توجد فواتير مشتريات</td>
                        `;
                        tbody.appendChild(row);
                    } else {
                        // حساب إجماليات
                        let totalDue = 0;
                        let invoiceCount = 0;

                        purchaseInvoices.forEach(invoice => {
                            if (invoice.remaining > 0) {
                                invoiceCount++;
                                totalDue += invoice.remaining;

                                const row = document.createElement('tr');

                                // تحديد حالة الفاتورة
                                let statusText = '';
                                let statusClass = '';

                                if (invoice.remaining <= 0) {
                                    statusText = 'مدفوعة';
                                    statusClass = 'status-active';
                                } else if (invoice.paid > 0) {
                                    statusText = 'مدفوعة جزئياً';
                                    statusClass = 'status-low';
                                } else {
                                    statusText = 'غير مدفوعة';
                                    statusClass = 'status-inactive';
                                }

                                // تاريخ الاستحقاق (افتراضي: 30 يوم من تاريخ الفاتورة)
                                const dueDate = new Date(invoice.date);
                                dueDate.setDate(dueDate.getDate() + 30);

                                row.innerHTML = `
                                    <td>${invoice.invoiceNumber}</td>
                                    <td>${new Date(invoice.date).toLocaleDateString()}</td>
                                    <td>${invoice.supplierName || 'مورد نقدي'}</td>
                                    <td>${invoice.total.toLocaleString()} ${window.currencySymbol}</td>
                                    <td>${invoice.paid.toLocaleString()} ${window.currencySymbol}</td>
                                    <td>${invoice.remaining.toLocaleString()} ${window.currencySymbol}</td>
                                    <td>${dueDate.toLocaleDateString()}</td>
                                    <td><span class="${statusClass}">${statusText}</span></td>
                                    <td class="actions-cell">
                                        <i class="fas fa-eye action-icon view-icon" data-id="${invoice.id}"></i>
                                        <i class="fas fa-print action-icon print-icon" data-id="${invoice.id}"></i>
                                        <i class="fas fa-money-bill-wave action-icon payment-icon" data-id="${invoice.id}"></i>
                                    </td>
                                `;

                                tbody.appendChild(row);
                            }
                        });

                        // تحديث الإحصائيات
                        document.getElementById('ap-total').textContent = totalDue.toLocaleString() + ' ' + window.currencySymbol;
                        document.getElementById('ap-count').textContent = invoiceCount;
                        document.getElementById('ap-average').textContent = invoiceCount > 0 ?
                            (totalDue / invoiceCount).toLocaleString() + ' ' + window.currencySymbol :
                            '0 ' + window.currencySymbol;
                    }
                })
                .catch(error => console.error('خطأ في تحميل بيانات حسابات الموردين:', error));
        }

        // تحميل بيانات دفتر الأستاذ العام
        function loadGeneralLedger() {
            // في هذه النسخة، سنقوم بإنشاء بيانات افتراضية لدفتر الأستاذ العام
            const ledgerTable = document.getElementById('ledger-table');
            ledgerTable.innerHTML = ''; // مسح الجدول

            // إنشاء بيانات افتراضية
            const entries = [
                { date: new Date(), entryNo: 'JE-001', description: 'قيد افتتاحي', accountNo: '1000', accountName: 'الصندوق', debit: 10000, credit: 0 },
                { date: new Date(), entryNo: 'JE-001', description: 'قيد افتتاحي', accountNo: '3000', accountName: 'رأس المال', debit: 0, credit: 10000 },
                { date: new Date(), entryNo: 'JE-002', description: 'شراء بضاعة', accountNo: '1200', accountName: 'المخزون', debit: 5000, credit: 0 },
                { date: new Date(), entryNo: 'JE-002', description: 'شراء بضاعة', accountNo: '1000', accountName: 'الصندوق', debit: 0, credit: 5000 },
                { date: new Date(), entryNo: 'JE-003', description: 'بيع بضاعة', accountNo: '1000', accountName: 'الصندوق', debit: 3000, credit: 0 },
                { date: new Date(), entryNo: 'JE-003', description: 'بيع بضاعة', accountNo: '4000', accountName: 'المبيعات', debit: 0, credit: 3000 }
            ];

            // حساب الرصيد
            let balance = 0;

            // إضافة القيود إلى الجدول
            entries.forEach(entry => {
                const row = document.createElement('tr');

                // حساب الرصيد
                if (entry.accountNo === '1000') { // حساب الصندوق
                    balance += entry.debit - entry.credit;
                }

                row.innerHTML = `
                    <td>${entry.date.toLocaleDateString()}</td>
                    <td>${entry.entryNo}</td>
                    <td>${entry.description}</td>
                    <td>${entry.accountNo}</td>
                    <td>${entry.accountName}</td>
                    <td>${entry.debit > 0 ? entry.debit.toLocaleString() + ' ' + window.currencySymbol : ''}</td>
                    <td>${entry.credit > 0 ? entry.credit.toLocaleString() + ' ' + window.currencySymbol : ''}</td>
                    <td>${entry.accountNo === '1000' ? balance.toLocaleString() + ' ' + window.currencySymbol : ''}</td>
                `;

                ledgerTable.appendChild(row);
            });
        }

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            // مسح بيانات المستخدم من الجلسة
            sessionStorage.removeItem('currentUser');

            // إخفاء الشاشة الرئيسية وإظهار شاشة تسجيل الدخول
            document.getElementById('dashboardScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        });

        // Menu navigation
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            if (item.id !== 'logoutBtn') {
                item.addEventListener('click', function() {
                    // Remove active class from all menu items
                    menuItems.forEach(mi => mi.classList.remove('active'));

                    // Add active class to clicked menu item
                    this.classList.add('active');

                    // Update page title
                    const pageTitle = this.querySelector('span').textContent;
                    document.getElementById('pageTitle').textContent = pageTitle;

                    // Hide all content sections
                    document.getElementById('dashboardContent').style.display = 'none';
                    document.getElementById('productsContent').style.display = 'none';
                    document.getElementById('customersContent').style.display = 'none';
                    document.getElementById('salesContent').style.display = 'none';
                    document.getElementById('purchasesContent').style.display = 'none';
                    document.getElementById('suppliersContent').style.display = 'none';
                    document.getElementById('inventoryContent').style.display = 'none';
                    document.getElementById('expensesContent').style.display = 'none';
                    document.getElementById('accountingContent').style.display = 'none';
                    document.getElementById('reportsContent').style.display = 'none';
                    document.getElementById('posContent').style.display = 'none';
                    document.getElementById('settingsContent').style.display = 'none';
                    document.getElementById('otherContent').style.display = 'none';

                    // Show appropriate content based on page
                    if (this.dataset.page === 'dashboard') {
                        document.getElementById('dashboardContent').style.display = 'block';
                        // تحديث بيانات لوحة التحكم عند الانتقال إلى صفحة لوحة التحكم
                        loadDashboardData();
                        console.log('تم تحميل صفحة لوحة التحكم');
                    } else if (this.dataset.page === 'products') {
                        document.getElementById('productsContent').style.display = 'block';
                        // تحديث بيانات المنتجات عند الانتقال إلى صفحة المنتجات
                        loadProductsData();
                        console.log('تم تحميل صفحة المنتجات');
                    } else if (this.dataset.page === 'customers') {
                        document.getElementById('customersContent').style.display = 'block';
                        // تحديث بيانات العملاء عند الانتقال إلى صفحة العملاء
                        loadCustomersData();
                        console.log('تم تحميل صفحة العملاء');
                    } else if (this.dataset.page === 'sales') {
                        document.getElementById('salesContent').style.display = 'block';
                        // تحديث بيانات المبيعات عند الانتقال إلى صفحة المبيعات
                        loadInvoicesData();
                        console.log('تم تحميل صفحة المبيعات');
                    } else if (this.dataset.page === 'purchases') {
                        document.getElementById('purchasesContent').style.display = 'block';
                        // تحديث بيانات المشتريات عند الانتقال إلى صفحة المشتريات
                        loadPurchasesData();
                        console.log('تم تحميل صفحة المشتريات');
                    } else if (this.dataset.page === 'inventory') {
                        document.getElementById('inventoryContent').style.display = 'block';
                        // تحديث بيانات المخزون عند الانتقال إلى صفحة المخزون
                        loadInventoryData();
                        console.log('تم تحميل صفحة المخزون');
                    } else if (this.dataset.page === 'suppliers') {
                        document.getElementById('suppliersContent').style.display = 'block';
                        // تحديث بيانات الموردين عند الانتقال إلى صفحة الموردين
                        loadSuppliersData();
                        console.log('تم تحميل صفحة الموردين');
                    } else if (this.dataset.page === 'expenses') {
                        document.getElementById('expensesContent').style.display = 'block';
                        // تحديث بيانات المصروفات عند الانتقال إلى صفحة المصروفات
                        loadExpensesData();
                        console.log('تم تحميل صفحة المصروفات');
                    } else if (this.dataset.page === 'accounting') {
                        document.getElementById('accountingContent').style.display = 'block';
                        // تحديث بيانات المحاسبة عند الانتقال إلى صفحة المحاسبة
                        loadAccountingData();
                        console.log('تم تحميل صفحة المحاسبة');
                    } else if (this.dataset.page === 'reports') {
                        document.getElementById('reportsContent').style.display = 'block';
                    } else if (this.dataset.page === 'settings') {
                        document.getElementById('settingsContent').style.display = 'block';
                    } else if (this.dataset.page === 'pos') {
                        document.getElementById('posContent').style.display = 'block';
                        // تحديث بيانات نقاط البيع عند الانتقال إلى صفحة نقاط البيع
                        loadPosData();
                        console.log('تم تحميل صفحة نقاط البيع');
                    } else {
                        document.getElementById('otherContent').style.display = 'block';
                    }
                });
            }
        });

        // متغيرات عامة
        let currentProductId = null;
        let currentCustomerId = null;
        let currentSupplierId = null;
        let currentExpenseId = null;
        let posCart = []; // سلة نقاط البيع

        // Product Modal
        const productModal = document.getElementById('productModal');
        const addProductBtn = document.getElementById('addProductBtn');
        const closeProductModal = document.getElementById('closeProductModal');
        const cancelProductBtn = document.getElementById('cancelProductBtn');
        const saveProductBtn = document.getElementById('saveProductBtn');

        // فتح نافذة إضافة منتج جديد
        addProductBtn.addEventListener('click', function() {
            // إعادة تعيين النموذج
            document.getElementById('productCode').value = '';
            document.getElementById('productBarcode').value = '';
            document.getElementById('productName').value = '';
            document.getElementById('productUnit').value = 'قطعة';
            document.getElementById('productPurchasePrice').value = '';
            document.getElementById('productSalePrice').value = '';
            document.getElementById('productInitialStock').value = '';
            document.getElementById('productMinStock').value = '';

            // إعادة تعيين معرف المنتج الحالي
            currentProductId = null;

            // تغيير عنوان النافذة
            document.querySelector('#productModal .modal-title').textContent = 'إضافة منتج جديد';

            // عرض النافذة
            productModal.style.display = 'flex';
        });

        // إغلاق نافذة المنتج
        closeProductModal.addEventListener('click', function() {
            productModal.style.display = 'none';
        });

        cancelProductBtn.addEventListener('click', function() {
            productModal.style.display = 'none';
        });

        // حفظ المنتج (إضافة أو تعديل)
        saveProductBtn.addEventListener('click', function() {
            // الحصول على قيم النموذج
            const code = document.getElementById('productCode').value;
            const barcode = document.getElementById('productBarcode').value;
            const name = document.getElementById('productName').value;
            const unit = document.getElementById('productUnit').value;
            const purchasePrice = parseFloat(document.getElementById('productPurchasePrice').value);
            const salePrice = parseFloat(document.getElementById('productSalePrice').value);
            const initialStock = parseInt(document.getElementById('productInitialStock').value) || 0;
            const minStock = parseInt(document.getElementById('productMinStock').value) || 0;

            // التحقق من صحة النموذج
            if (!code || !name || !unit || isNaN(purchasePrice) || isNaN(salePrice)) {
                alert('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            // إنشاء كائن المنتج
            const product = {
                code,
                barcode,
                name,
                description: '',
                unit,
                purchasePrice,
                salePrice,
                stock: initialStock,
                minStock,
                isActive: true,
                createdAt: new Date()
            };

            // إذا كان تعديل، أضف المعرف
            if (currentProductId) {
                product.id = currentProductId;
                product.updatedAt = new Date();

                // تحديث المنتج في قاعدة البيانات
                window.db.products.update(product)
                    .then(() => {
                        console.log('تم تحديث المنتج بنجاح');

                        // إعادة تحميل بيانات المنتجات
                        loadProductsData();

                        // إغلاق النافذة
                        productModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في تحديث المنتج:', error);
                        alert('حدث خطأ في تحديث المنتج: ' + error.message);
                    });
            } else {
                // إضافة المنتج إلى قاعدة البيانات
                window.db.products.add(product)
                    .then(id => {
                        console.log('تم إضافة المنتج بنجاح، المعرف:', id);

                        // إعادة تحميل بيانات المنتجات
                        loadProductsData();

                        // إغلاق النافذة وإعادة تعيين النموذج
                        productModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في إضافة المنتج:', error);
                        alert('حدث خطأ في إضافة المنتج: ' + error.message);
                    });
            }
        });

        // تحميل بيانات المنتج للتعديل
        function loadProductForEdit(id) {
            window.db.products.getById(id)
                .then(product => {
                    if (!product) {
                        alert('المنتج غير موجود');
                        return;
                    }

                    // تعيين معرف المنتج الحالي
                    currentProductId = product.id;

                    // ملء النموذج ببيانات المنتج
                    document.getElementById('productCode').value = product.code;
                    document.getElementById('productBarcode').value = product.barcode || '';
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productUnit').value = product.unit;
                    document.getElementById('productPurchasePrice').value = product.purchasePrice;
                    document.getElementById('productSalePrice').value = product.salePrice;
                    document.getElementById('productInitialStock').value = product.stock || 0;
                    document.getElementById('productMinStock').value = product.minStock || 0;

                    // تغيير عنوان النافذة
                    document.querySelector('#productModal .modal-title').textContent = 'تعديل المنتج';

                    // عرض النافذة
                    productModal.style.display = 'flex';
                })
                .catch(error => {
                    console.error('خطأ في تحميل بيانات المنتج:', error);
                    alert('حدث خطأ في تحميل بيانات المنتج');
                });
        }

        // حذف منتج
        function deleteProduct(id) {
            if (confirm('هل أنت متأكد من حذف هذا المنتج؟')) {
                window.db.products.delete(id)
                    .then(() => {
                        console.log('تم حذف المنتج بنجاح');

                        // إعادة تحميل بيانات المنتجات
                        loadProductsData();
                    })
                    .catch(error => {
                        console.error('خطأ في حذف المنتج:', error);
                        alert('حدث خطأ في حذف المنتج');
                    });
            }
        }

        // Customer Modal
        const customerModal = document.getElementById('customerModal');
        const addCustomerBtn = document.getElementById('addCustomerBtn');
        const closeCustomerModal = document.getElementById('closeCustomerModal');
        const cancelCustomerBtn = document.getElementById('cancelCustomerBtn');
        const saveCustomerBtn = document.getElementById('saveCustomerBtn');

        // فتح نافذة إضافة عميل جديد
        addCustomerBtn.addEventListener('click', function() {
            // إعادة تعيين النموذج
            document.getElementById('customerCode').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerContact').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerBalance').value = '';

            // إعادة تعيين معرف العميل الحالي
            currentCustomerId = null;

            // تغيير عنوان النافذة
            document.querySelector('#customerModal .modal-title').textContent = 'إضافة عميل جديد';

            // عرض النافذة
            customerModal.style.display = 'flex';
        });

        // إغلاق نافذة العميل
        closeCustomerModal.addEventListener('click', function() {
            customerModal.style.display = 'none';
        });

        cancelCustomerBtn.addEventListener('click', function() {
            customerModal.style.display = 'none';
        });

        // حفظ العميل (إضافة أو تعديل)
        saveCustomerBtn.addEventListener('click', function() {
            // الحصول على قيم النموذج
            const code = document.getElementById('customerCode').value;
            const name = document.getElementById('customerName').value;
            const contactPerson = document.getElementById('customerContact').value;
            const phone = document.getElementById('customerPhone').value;
            const email = document.getElementById('customerEmail').value;
            const address = document.getElementById('customerAddress').value;
            const balance = parseFloat(document.getElementById('customerBalance').value) || 0;

            // التحقق من صحة النموذج
            if (!code || !name) {
                alert('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            // إنشاء كائن العميل
            const customer = {
                code,
                name,
                contactPerson,
                phone,
                email,
                address,
                balance,
                isActive: true,
                createdAt: new Date()
            };

            // إذا كان تعديل، أضف المعرف
            if (currentCustomerId) {
                customer.id = currentCustomerId;
                customer.updatedAt = new Date();

                // تحديث العميل في قاعدة البيانات
                window.db.customers.update(customer)
                    .then(() => {
                        console.log('تم تحديث العميل بنجاح');

                        // إعادة تحميل بيانات العملاء
                        loadCustomersData();

                        // إغلاق النافذة
                        customerModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في تحديث العميل:', error);
                        alert('حدث خطأ في تحديث العميل: ' + error.message);
                    });
            } else {
                // إضافة العميل إلى قاعدة البيانات
                window.db.customers.add(customer)
                    .then(id => {
                        console.log('تم إضافة العميل بنجاح، المعرف:', id);

                        // إعادة تحميل بيانات العملاء
                        loadCustomersData();

                        // إغلاق النافذة وإعادة تعيين النموذج
                        customerModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في إضافة العميل:', error);
                        alert('حدث خطأ في إضافة العميل: ' + error.message);
                    });
            }
        });

        // تحميل بيانات العميل للتعديل
        function loadCustomerForEdit(id) {
            window.db.customers.getById(id)
                .then(customer => {
                    if (!customer) {
                        alert('العميل غير موجود');
                        return;
                    }

                    // تعيين معرف العميل الحالي
                    currentCustomerId = customer.id;

                    // ملء النموذج ببيانات العميل
                    document.getElementById('customerCode').value = customer.code;
                    document.getElementById('customerName').value = customer.name;
                    document.getElementById('customerContact').value = customer.contactPerson || '';
                    document.getElementById('customerPhone').value = customer.phone || '';
                    document.getElementById('customerEmail').value = customer.email || '';
                    document.getElementById('customerAddress').value = customer.address || '';
                    document.getElementById('customerBalance').value = customer.balance || 0;

                    // تغيير عنوان النافذة
                    document.querySelector('#customerModal .modal-title').textContent = 'تعديل العميل';

                    // عرض النافذة
                    customerModal.style.display = 'flex';
                })
                .catch(error => {
                    console.error('خطأ في تحميل بيانات العميل:', error);
                    alert('حدث خطأ في تحميل بيانات العميل');
                });
        }

        // حذف عميل
        function deleteCustomer(id) {
            if (confirm('هل أنت متأكد من حذف هذا العميل؟')) {
                window.db.customers.delete(id)
                    .then(() => {
                        console.log('تم حذف العميل بنجاح');

                        // إعادة تحميل بيانات العملاء
                        loadCustomersData();
                    })
                    .catch(error => {
                        console.error('خطأ في حذف العميل:', error);
                        alert('حدث خطأ في حذف العميل');
                    });
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target === productModal) {
                productModal.style.display = 'none';
            }
            if (event.target === customerModal) {
                customerModal.style.display = 'none';
            }
            if (event.target === purchaseModal) {
                purchaseModal.style.display = 'none';
            }
        });

        // Purchase Invoice Modal
        const purchaseModal = document.getElementById('purchaseModal');
        const addPurchaseBtn = document.getElementById('addPurchaseBtn');
        const closePurchaseModal = document.getElementById('closePurchaseModal');
        const cancelPurchaseBtn = document.getElementById('cancelPurchaseBtn');
        const savePurchaseBtn = document.getElementById('savePurchaseBtn');
        const addPurchaseItemBtn = document.getElementById('addPurchaseItemBtn');

        // فتح نافذة إضافة فاتورة مشتريات جديدة
        addPurchaseBtn.addEventListener('click', function() {
            // إعادة تعيين نموذج الفاتورة
            resetPurchaseInvoiceForm();

            // عرض النافذة
            purchaseModal.style.display = 'flex';
        });

        // إغلاق نافذة فاتورة المشتريات
        closePurchaseModal.addEventListener('click', function() {
            purchaseModal.style.display = 'none';
        });

        cancelPurchaseBtn.addEventListener('click', function() {
            purchaseModal.style.display = 'none';
        });

        // إضافة بند جديد لفاتورة المشتريات
        addPurchaseItemBtn.addEventListener('click', function() {
            const tbody = document.querySelector('#purchaseInvoiceItemsTable tbody');
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td>${tbody.children.length + 1}</td>
                <td>
                    <select class="form-select" style="width: 100%;">
                        <option value="">اختر الصنف</option>
                        <!-- سيتم ملؤها ديناميكيًا -->
                    </select>
                </td>
                <td><input type="number" class="form-input item-quantity" value="1" min="1"></td>
                <td><input type="number" class="form-input item-price" value="0" min="0"></td>
                <td><input type="number" class="form-input item-discount" value="0" min="0"></td>
                <td class="item-total">0 ر.س</td>
                <td class="actions-cell">
                    <i class="fas fa-trash action-icon delete-icon"></i>
                </td>
            `;

            tbody.appendChild(newRow);

            // تحميل المنتجات في القائمة
            const productSelect = newRow.querySelector('select');
            window.db.products.getAll()
                .then(products => {
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.text = product.name;
                        option.dataset.price = product.purchasePrice;
                        productSelect.add(option);
                    });
                })
                .catch(error => console.error('خطأ في تحميل المنتجات:', error));

            // إضافة مستمع للتغيير في اختيار المنتج
            productSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];
                if (selectedOption && selectedOption.dataset.price) {
                    // تعيين سعر المنتج في حقل السعر
                    const row = this.closest('tr');
                    const priceInput = row.querySelector('.item-price');
                    priceInput.value = selectedOption.dataset.price;

                    // إعادة حساب الإجماليات
                    calculatePurchaseInvoice();
                }
            });

            // إضافة مستمعي الأحداث للحقول
            const inputs = newRow.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', calculatePurchaseInvoice);
            });

            // إضافة مستمع لزر الحذف
            const deleteIcon = newRow.querySelector('.delete-icon');
            deleteIcon.addEventListener('click', function() {
                tbody.removeChild(newRow);
                // إعادة ترقيم الصفوف
                const rows = tbody.querySelectorAll('tr');
                rows.forEach((row, index) => {
                    row.cells[0].textContent = index + 1;
                });
                // إعادة حساب الإجماليات
                calculatePurchaseInvoice();
            });

            // حساب الإجماليات
            calculatePurchaseInvoice();
        });

        // حساب إجماليات فاتورة المشتريات
        function calculatePurchaseInvoice() {
            // حساب إجماليات البنود
            const rows = document.querySelectorAll('#purchaseInvoiceItemsTable tbody tr');
            let subtotal = 0;

            rows.forEach(row => {
                // حساب إجمالي البند
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const discount = parseFloat(row.querySelector('.item-discount').value) || 0;
                const total = (quantity * price) - discount;

                row.querySelector('.item-total').textContent = total.toLocaleString() + ' ر.س';
                subtotal += total;
            });

            // تحديث إجماليات الفاتورة
            const discountEl = document.getElementById('purchaseInvoiceDiscount');
            const discount = parseFloat(discountEl.value) || 0;
            const taxRate = 0.15; // 15%

            const tax = (subtotal - discount) * taxRate;
            const total = subtotal - discount + tax;

            document.getElementById('purchaseInvoiceSubtotal').value = subtotal.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('purchaseInvoiceTax').value = tax.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('purchaseInvoiceTotal').value = total.toLocaleString() + ' ' + window.currencySymbol;

            // حساب المتبقي
            const paid = parseFloat(document.getElementById('purchaseInvoicePaid').value) || 0;
            const remaining = total - paid;
            document.getElementById('purchaseInvoiceRemaining').value = remaining.toLocaleString() + ' ' + window.currencySymbol;
        }

        // إعادة تعيين نموذج فاتورة المشتريات
        function resetPurchaseInvoiceForm() {
            // توليد رقم فاتورة جديد
            const today = new Date();
            const invoiceNumber = 'PINV-' + today.getFullYear() +
                                (today.getMonth() + 1).toString().padStart(2, '0') +
                                today.getDate().toString().padStart(2, '0') + '-' +
                                Math.floor(Math.random() * 1000).toString().padStart(3, '0');

            document.getElementById('purchaseInvoiceNumber').value = invoiceNumber;
            document.getElementById('purchaseInvoiceDate').value = today.toISOString().split('T')[0];
            document.getElementById('purchaseInvoiceSupplier').value = '';
            document.getElementById('purchaseInvoicePaymentMethod').value = 'cash';
            document.getElementById('purchaseInvoiceDiscount').value = '0';
            document.getElementById('purchaseInvoicePaid').value = '0';
            document.getElementById('purchaseInvoiceNotes').value = '';

            // إعادة تعيين جدول البنود
            const tbody = document.querySelector('#purchaseInvoiceItemsTable tbody');
            tbody.innerHTML = '';

            // إضافة بند فارغ
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>1</td>
                <td>
                    <select class="form-select" style="width: 100%;">
                        <option value="">اختر الصنف</option>
                    </select>
                </td>
                <td><input type="number" class="form-input item-quantity" value="1" min="1"></td>
                <td><input type="number" class="form-input item-price" value="0" min="0"></td>
                <td><input type="number" class="form-input item-discount" value="0" min="0"></td>
                <td class="item-total">0 ر.س</td>
                <td class="actions-cell">
                    <i class="fas fa-trash action-icon delete-icon"></i>
                </td>
            `;

            tbody.appendChild(newRow);

            // تحميل المنتجات في القائمة
            const productSelect = newRow.querySelector('select');
            window.db.products.getAll()
                .then(products => {
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.text = product.name;
                        option.dataset.price = product.purchasePrice;
                        productSelect.add(option);
                    });
                })
                .catch(error => console.error('خطأ في تحميل المنتجات:', error));

            // تحميل الموردين في القائمة
            const supplierSelect = document.getElementById('purchaseInvoiceSupplier');
            supplierSelect.innerHTML = '<option value="">اختر المورد</option>';
            window.db.suppliers.getAll()
                .then(suppliers => {
                    suppliers.forEach(supplier => {
                        const option = document.createElement('option');
                        option.value = supplier.id;
                        option.text = supplier.name;
                        supplierSelect.add(option);
                    });
                })
                .catch(error => console.error('خطأ في تحميل الموردين:', error));

            // إعادة حساب الإجماليات
            calculatePurchaseInvoice();
        }

        // حفظ فاتورة المشتريات
        savePurchaseBtn.addEventListener('click', function() {
            // الحصول على قيم النموذج
            const invoiceNumber = document.getElementById('purchaseInvoiceNumber').value;
            const invoiceDate = document.getElementById('purchaseInvoiceDate').value;
            const supplierSelect = document.getElementById('purchaseInvoiceSupplier');
            const supplierId = parseInt(supplierSelect.value);
            const supplierName = supplierSelect.options[supplierSelect.selectedIndex]?.text || 'مورد نقدي';
            const paymentMethodSelect = document.getElementById('purchaseInvoicePaymentMethod');
            const paymentMethod = paymentMethodSelect.value;

            // الحصول على إجماليات الفاتورة
            const subtotal = parseFloat(document.getElementById('purchaseInvoiceSubtotal').value.replace(/[^\d.-]/g, ''));
            const discount = parseFloat(document.getElementById('purchaseInvoiceDiscount').value) || 0;
            const tax = parseFloat(document.getElementById('purchaseInvoiceTax').value.replace(/[^\d.-]/g, ''));
            const total = parseFloat(document.getElementById('purchaseInvoiceTotal').value.replace(/[^\d.-]/g, ''));
            const paid = parseFloat(document.getElementById('purchaseInvoicePaid').value) || 0;
            const remaining = total - paid;
            const notes = document.getElementById('purchaseInvoiceNotes').value;

            // التحقق من صحة النموذج
            if (!invoiceNumber || !invoiceDate) {
                alert('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            // الحصول على بنود الفاتورة
            const itemRows = document.querySelectorAll('#purchaseInvoiceItemsTable tbody tr');
            const items = [];

            for (let i = 0; i < itemRows.length; i++) {
                const row = itemRows[i];
                const productSelect = row.querySelector('select');
                const productId = parseInt(productSelect.value);
                const productName = productSelect.options[productSelect.selectedIndex]?.text;

                if (!productId) {
                    alert('الرجاء اختيار منتج لجميع البنود');
                    return;
                }

                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const itemDiscount = parseFloat(row.querySelector('.item-discount').value) || 0;
                const itemTotal = (quantity * price) - itemDiscount;

                items.push({
                    productId,
                    productName,
                    quantity,
                    price,
                    discount: itemDiscount,
                    total: itemTotal
                });
            }

            if (items.length === 0) {
                alert('الرجاء إضافة بند واحد على الأقل للفاتورة');
                return;
            }

            // إنشاء كائن الفاتورة
            const invoice = {
                invoiceNumber,
                date: new Date(invoiceDate),
                supplierId,
                supplierName,
                type: 'purchase',
                paymentMethod,
                subtotal,
                discount,
                tax,
                total,
                paid,
                remaining,
                notes,
                status: remaining <= 0 ? 'paid' : (paid > 0 ? 'partial' : 'unpaid'),
                createdAt: new Date()
            };

            // حفظ الفاتورة في قاعدة البيانات
            window.db.invoices.add(invoice, items)
                .then(id => {
                    console.log('تم إضافة فاتورة المشتريات بنجاح، المعرف:', id);

                    // إعادة تحميل بيانات الفواتير
                    loadPurchasesData();

                    // إعادة تحميل بيانات لوحة التحكم
                    loadDashboardData();

                    // إغلاق النافذة
                    purchaseModal.style.display = 'none';

                    // إعادة تعيين نموذج الفاتورة
                    resetPurchaseInvoiceForm();
                })
                .catch(error => {
                    console.error('خطأ في إضافة فاتورة المشتريات:', error);
                    alert('حدث خطأ في إضافة فاتورة المشتريات: ' + error.message);
                });
        });

        // Sales Invoice Modal
        const saleModal = document.getElementById('saleModal');
        const addSaleBtn = document.getElementById('addSaleBtn');
        const closeSaleModal = document.getElementById('closeSaleModal');
        const cancelSaleBtn = document.getElementById('cancelSaleBtn');
        const saveSaleBtn = document.getElementById('saveSaleBtn');
        const addItemBtn = document.getElementById('addItemBtn');

        // Invoice calculations
        function calculateInvoice() {
            // Calculate item totals
            const rows = document.querySelectorAll('#invoiceItemsTable tbody tr');
            let subtotal = 0;

            rows.forEach((row, index) => {
                // Update row number
                row.cells[0].textContent = index + 1;

                // Calculate item total
                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const discount = parseFloat(row.querySelector('.item-discount').value) || 0;
                const total = (quantity * price) - discount;

                row.querySelector('.item-total').textContent = total.toLocaleString() + ' ر.س';
                subtotal += total;
            });

            // Update invoice totals
            const discountEl = document.getElementById('invoiceDiscount');
            const discount = parseFloat(discountEl.value) || 0;
            const taxRate = 0.15; // 15%

            const tax = (subtotal - discount) * taxRate;
            const total = subtotal - discount + tax;

            document.getElementById('invoiceSubtotal').value = subtotal.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('invoiceTax').value = tax.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('invoiceTotal').value = total.toLocaleString() + ' ' + window.currencySymbol;

            // Calculate remaining
            const paid = parseFloat(document.getElementById('invoicePaid').value) || 0;
            const remaining = total - paid;
            document.getElementById('invoiceRemaining').value = remaining.toLocaleString() + ' ' + window.currencySymbol;
        }

        // Add event listeners for invoice calculations
        document.addEventListener('input', function(event) {
            if (event.target.classList.contains('item-quantity') ||
                event.target.classList.contains('item-price') ||
                event.target.classList.contains('item-discount') ||
                event.target.id === 'invoiceDiscount' ||
                event.target.id === 'invoicePaid') {
                calculateInvoice();
            }
        });

        // Add new item row
        addItemBtn.addEventListener('click', function() {
            const tbody = document.querySelector('#invoiceItemsTable tbody');
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td>${tbody.children.length + 1}</td>
                <td>
                    <select class="form-select" style="width: 100%;">
                        <option value="">اختر الصنف</option>
                        <option value="1">لابتوب HP ProBook</option>
                        <option value="2">طابعة Canon</option>
                        <option value="3">ماوس لاسلكي</option>
                        <option value="4">لوحة مفاتيح</option>
                        <option value="5">شاشة Samsung</option>
                    </select>
                </td>
                <td><input type="number" class="form-input item-quantity" value="1" min="1"></td>
                <td><input type="number" class="form-input item-price" value="0" min="0"></td>
                <td><input type="number" class="form-input item-discount" value="0" min="0"></td>
                <td class="item-total">0 ر.س</td>
                <td class="actions-cell">
                    <i class="fas fa-trash action-icon delete-icon"></i>
                </td>
            `;

            tbody.appendChild(newRow);
            calculateInvoice();
        });

        // Open sale modal
        addSaleBtn.addEventListener('click', function() {
            // إعادة تعيين نموذج الفاتورة
            resetInvoiceForm();

            // تحميل العملاء في القائمة
            loadCustomersForInvoice();

            // تحميل المنتجات في القائمة
            loadProductsForInvoice();

            // عرض النافذة
            saleModal.style.display = 'flex';
        });

        // تحميل العملاء في قائمة الفاتورة
        function loadCustomersForInvoice() {
            const customerSelect = document.getElementById('invoiceCustomer');
            customerSelect.innerHTML = '<option value="">اختر العميل</option>';

            window.db.customers.getAll()
                .then(customers => {
                    customers.forEach(customer => {
                        const option = document.createElement('option');
                        option.value = customer.id;
                        option.text = customer.name;
                        customerSelect.add(option);
                    });
                })
                .catch(error => console.error('خطأ في تحميل العملاء:', error));
        }

        // تحميل المنتجات في قائمة الفاتورة
        function loadProductsForInvoice() {
            // تحميل المنتجات في جميع قوائم المنتجات في بنود الفاتورة
            const productSelects = document.querySelectorAll('#invoiceItemsTable tbody tr select');

            window.db.products.getAll()
                .then(products => {
                    productSelects.forEach(select => {
                        // حفظ القيمة الحالية
                        const currentValue = select.value;

                        // مسح القائمة
                        select.innerHTML = '<option value="">اختر الصنف</option>';

                        // إضافة المنتجات
                        products.forEach(product => {
                            const option = document.createElement('option');
                            option.value = product.id;
                            option.text = product.name;
                            option.dataset.price = product.salePrice;
                            select.add(option);
                        });

                        // استعادة القيمة الحالية إذا كانت موجودة
                        if (currentValue) {
                            select.value = currentValue;
                        }
                    });

                    // إضافة مستمع للتغيير في اختيار المنتج
                    productSelects.forEach(select => {
                        select.addEventListener('change', function() {
                            const selectedOption = this.options[this.selectedIndex];
                            if (selectedOption && selectedOption.dataset.price) {
                                // تعيين سعر المنتج في حقل السعر
                                const row = this.closest('tr');
                                const priceInput = row.querySelector('.item-price');
                                priceInput.value = selectedOption.dataset.price;

                                // إعادة حساب الإجماليات
                                calculateInvoice();
                            }
                        });
                    });
                })
                .catch(error => console.error('خطأ في تحميل المنتجات:', error));
        }

        // Close sale modal
        closeSaleModal.addEventListener('click', function() {
            saleModal.style.display = 'none';
        });

        cancelSaleBtn.addEventListener('click', function() {
            saleModal.style.display = 'none';
        });

        // Save invoice
        saveSaleBtn.addEventListener('click', function() {
            // Get form values
            const invoiceNumber = document.getElementById('invoiceNumber').value;
            const invoiceDate = document.getElementById('invoiceDate').value;
            const customerSelect = document.getElementById('invoiceCustomer');
            const customerId = parseInt(customerSelect.value);
            const customerName = customerSelect.options[customerSelect.selectedIndex].text;
            const paymentMethodSelect = document.getElementById('invoicePaymentMethod');
            const paymentMethod = paymentMethodSelect.value;

            // Get invoice totals
            const subtotal = parseFloat(document.getElementById('invoiceSubtotal').value.replace(/[^\d.-]/g, ''));
            const discount = parseFloat(document.getElementById('invoiceDiscount').value) || 0;
            const tax = parseFloat(document.getElementById('invoiceTax').value.replace(/[^\d.-]/g, ''));
            const total = parseFloat(document.getElementById('invoiceTotal').value.replace(/[^\d.-]/g, ''));
            const paid = parseFloat(document.getElementById('invoicePaid').value) || 0;
            const remaining = total - paid;
            const notes = document.getElementById('invoiceNotes').value;

            // Validate form
            if (!invoiceNumber || !invoiceDate || !customerId) {
                alert('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            // Get invoice items
            const itemRows = document.querySelectorAll('#invoiceItemsTable tbody tr');
            const items = [];

            for (let i = 0; i < itemRows.length; i++) {
                const row = itemRows[i];
                const productSelect = row.querySelector('select');
                const productId = parseInt(productSelect.value);
                const productName = productSelect.options[productSelect.selectedIndex].text;

                if (!productId) {
                    alert('الرجاء اختيار منتج لجميع البنود');
                    return;
                }

                const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
                const price = parseFloat(row.querySelector('.item-price').value) || 0;
                const itemDiscount = parseFloat(row.querySelector('.item-discount').value) || 0;
                const itemTotal = (quantity * price) - itemDiscount;

                items.push({
                    productId,
                    productName,
                    quantity,
                    price,
                    discount: itemDiscount,
                    total: itemTotal
                });
            }

            if (items.length === 0) {
                alert('الرجاء إضافة بند واحد على الأقل للفاتورة');
                return;
            }

            // Create invoice object
            const invoice = {
                invoiceNumber,
                date: new Date(invoiceDate),
                customerId,
                customerName,
                type: 'sale',
                paymentMethod,
                subtotal,
                discount,
                tax,
                total,
                paid,
                remaining,
                notes,
                status: remaining <= 0 ? 'paid' : (paid > 0 ? 'partial' : 'unpaid'),
                createdAt: new Date()
            };

            // Save invoice to database
            window.db.invoices.add(invoice, items)
                .then(id => {
                    console.log('تم إضافة الفاتورة بنجاح، المعرف:', id);

                    // إعادة تحميل بيانات الفواتير
                    loadInvoicesData();

                    // إعادة تحميل بيانات لوحة التحكم
                    loadDashboardData();

                    // إغلاق النافذة
                    saleModal.style.display = 'none';

                    // إعادة تعيين نموذج الفاتورة
                    resetInvoiceForm();
                })
                .catch(error => {
                    console.error('خطأ في إضافة الفاتورة:', error);
                    alert('حدث خطأ في إضافة الفاتورة: ' + error.message);
                });
        });

        // إعادة تعيين نموذج الفاتورة
        function resetInvoiceForm() {
            // توليد رقم فاتورة جديد
            const today = new Date();
            const invoiceNumber = 'INV-' + today.getFullYear() +
                                 (today.getMonth() + 1).toString().padStart(2, '0') +
                                 today.getDate().toString().padStart(2, '0') + '-' +
                                 Math.floor(Math.random() * 1000).toString().padStart(3, '0');

            document.getElementById('invoiceNumber').value = invoiceNumber;
            document.getElementById('invoiceDate').value = today.toISOString().split('T')[0];
            document.getElementById('invoiceCustomer').value = '';
            document.getElementById('invoicePaymentMethod').value = 'cash';
            document.getElementById('invoiceDiscount').value = '0';
            document.getElementById('invoicePaid').value = '0';
            document.getElementById('invoiceNotes').value = '';

            // إعادة تعيين جدول البنود
            const tbody = document.querySelector('#invoiceItemsTable tbody');
            tbody.innerHTML = '';

            // إضافة بند فارغ
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>1</td>
                <td>
                    <select class="form-select" style="width: 100%;">
                        <option value="">اختر الصنف</option>
                    </select>
                </td>
                <td><input type="number" class="form-input item-quantity" value="1" min="1"></td>
                <td><input type="number" class="form-input item-price" value="0" min="0"></td>
                <td><input type="number" class="form-input item-discount" value="0" min="0"></td>
                <td class="item-total">0 ر.س</td>
                <td class="actions-cell">
                    <i class="fas fa-trash action-icon delete-icon"></i>
                </td>
            `;

            tbody.appendChild(newRow);

            // تحميل المنتجات في القائمة
            const productSelect = newRow.querySelector('select');
            window.db.products.getAll()
                .then(products => {
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.text = product.name;
                        option.dataset.price = product.salePrice;
                        productSelect.add(option);
                    });
                })
                .catch(error => console.error('خطأ في تحميل المنتجات:', error));

            // إعادة حساب الإجماليات
            calculateInvoice();
        }

        // إضافة مستمعي الأحداث لتسوية المخزون
        document.getElementById('adjustment-product').addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption && selectedOption.value) {
                const currentStock = parseInt(selectedOption.dataset.stock) || 0;
                document.getElementById('adjustment-current-quantity').value = currentStock;
                document.getElementById('adjustment-new-quantity').value = currentStock;
            } else {
                document.getElementById('adjustment-current-quantity').value = '';
                document.getElementById('adjustment-new-quantity').value = '';
            }
        });

        // حفظ تسوية المخزون
        document.getElementById('save-adjustment-btn').addEventListener('click', function() {
            const productSelect = document.getElementById('adjustment-product');
            const productId = parseInt(productSelect.value);
            const productName = productSelect.options[productSelect.selectedIndex].text;
            const currentQuantity = parseInt(document.getElementById('adjustment-current-quantity').value) || 0;
            const newQuantity = parseInt(document.getElementById('adjustment-new-quantity').value) || 0;
            const adjustmentType = document.getElementById('adjustment-type').value;
            const notes = document.getElementById('adjustment-notes').value;

            if (!productId) {
                alert('الرجاء اختيار منتج');
                return;
            }

            if (newQuantity < 0) {
                alert('الكمية الجديدة يجب أن تكون أكبر من أو تساوي صفر');
                return;
            }

            // إنشاء كائن حركة المخزون
            const transaction = {
                productId,
                date: new Date(),
                type: adjustmentType,
                reference: 'تسوية مخزون',
                notes: notes || 'تسوية مخزون يدوية',
                userId: 1 // المستخدم الحالي
            };

            // تحديد الكمية بناءً على نوع التسوية
            switch (adjustmentType) {
                case 'set':
                    transaction.quantity = newQuantity;
                    break;
                case 'add':
                    transaction.quantity = newQuantity;
                    break;
                case 'subtract':
                    transaction.quantity = newQuantity;
                    break;
            }

            // إضافة حركة المخزون
            window.db.inventory.addTransaction(transaction)
                .then(id => {
                    console.log('تمت تسوية المخزون بنجاح، المعرف:', id);

                    // إعادة تحميل بيانات المخزون
                    loadInventoryData();

                    // إعادة تعيين النموذج
                    document.getElementById('adjustment-product').value = '';
                    document.getElementById('adjustment-current-quantity').value = '';
                    document.getElementById('adjustment-new-quantity').value = '';
                    document.getElementById('adjustment-type').value = 'set';
                    document.getElementById('adjustment-notes').value = '';

                    alert('تمت تسوية المخزون بنجاح');
                })
                .catch(error => {
                    console.error('خطأ في تسوية المخزون:', error);
                    alert('حدث خطأ في تسوية المخزون: ' + error.message);
                });
        });

        // إضافة مستمعي الأحداث للتبديل بين علامات التبويب
        document.querySelectorAll('.tabs .tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');

                // تحديث العلامات النشطة
                document.querySelectorAll('.tabs .tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // تحديث المحتوى النشط
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
            });
        });

        // إضافة مستمعي الأحداث لإنشاء التقارير
        document.getElementById('generate-sales-report').addEventListener('click', function() {
            const fromDate = document.getElementById('sales-from-date').value;
            const toDate = document.getElementById('sales-to-date').value;
            const customerId = document.getElementById('sales-customer').value;
            const status = document.getElementById('sales-status').value;

            // إنشاء تقرير المبيعات
            window.db.reports.sales(fromDate, toDate, customerId || null, status || null)
                .then(result => {
                    const { invoices, stats } = result;

                    // تحديث ملخص التقرير
                    document.getElementById('sales-total').textContent = stats.totalSales.toLocaleString() + ' ر.س';
                    document.getElementById('sales-count').textContent = stats.count;
                    document.getElementById('sales-average').textContent = stats.averageSale.toLocaleString() + ' ر.س';
                    document.getElementById('sales-paid').textContent = stats.totalPaid.toLocaleString() + ' ر.س';
                    document.getElementById('sales-due').textContent = stats.totalDue.toLocaleString() + ' ر.س';

                    // تحديث جدول التقرير
                    const tbody = document.getElementById('sales-report-table');
                    tbody.innerHTML = ''; // مسح الجدول

                    invoices.forEach(invoice => {
                        const row = document.createElement('tr');

                        // تحديد حالة الفاتورة
                        let statusText = '';
                        let statusClass = '';

                        if (invoice.remaining <= 0) {
                            statusText = 'مدفوعة';
                            statusClass = 'status-active';
                        } else if (invoice.paid > 0) {
                            statusText = 'مدفوعة جزئياً';
                            statusClass = 'status-low';
                        } else {
                            statusText = 'غير مدفوعة';
                            statusClass = 'status-inactive';
                        }

                        row.innerHTML = `
                            <td>${invoice.invoiceNumber}</td>
                            <td>${new Date(invoice.date).toLocaleDateString()}</td>
                            <td>${invoice.customerName}</td>
                            <td>${invoice.total.toLocaleString()} ر.س</td>
                            <td>${invoice.paid.toLocaleString()} ر.س</td>
                            <td>${invoice.remaining.toLocaleString()} ر.س</td>
                            <td><span class="${statusClass}">${statusText}</span></td>
                        `;

                        tbody.appendChild(row);
                    });

                    // إنشاء الرسم البياني
                    createSalesChart(invoices);
                })
                .catch(error => {
                    console.error('خطأ في إنشاء تقرير المبيعات:', error);
                    alert('حدث خطأ في إنشاء تقرير المبيعات');
                });
        });

        // إنشاء رسم بياني للمبيعات
        function createSalesChart(invoices) {
            // تجميع البيانات حسب الشهر
            const salesByMonth = {};

            invoices.forEach(invoice => {
                const date = new Date(invoice.date);
                const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;

                if (!salesByMonth[monthYear]) {
                    salesByMonth[monthYear] = 0;
                }

                salesByMonth[monthYear] += invoice.total;
            });

            // تحويل البيانات إلى مصفوفات للرسم البياني
            const labels = Object.keys(salesByMonth).sort();
            const data = labels.map(label => salesByMonth[label]);

            // إنشاء الرسم البياني
            const ctx = document.getElementById('sales-chart').getContext('2d');

            // تدمير الرسم البياني السابق إذا وجد
            if (window.salesChart) {
                window.salesChart.destroy();
            }

            window.salesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'المبيعات الشهرية',
                        data: data,
                        backgroundColor: 'rgba(0, 150, 136, 0.7)',
                        borderColor: 'rgba(0, 150, 136, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // تحميل بيانات المصروفات
        function loadExpensesData() {
            window.db.expenses.getAll()
                .then(expenses => {
                    const tbody = document.querySelector('#expensesContent .data-table tbody');
                    tbody.innerHTML = ''; // مسح الجدول

                    // ترتيب المصروفات حسب التاريخ (الأحدث أولاً)
                    expenses.sort((a, b) => new Date(b.date) - new Date(a.date));

                    expenses.forEach(expense => {
                        const row = document.createElement('tr');

                        // تحديد نص طريقة الدفع
                        let paymentMethodText = '';
                        switch (expense.paymentMethod) {
                            case 'cash':
                                paymentMethodText = 'نقدي';
                                break;
                            case 'bank':
                                paymentMethodText = 'تحويل بنكي';
                                break;
                            case 'check':
                                paymentMethodText = 'شيك';
                                break;
                            case 'card':
                                paymentMethodText = 'بطاقة ائتمان';
                                break;
                            default:
                                paymentMethodText = expense.paymentMethod;
                        }

                        row.innerHTML = `
                            <td>${new Date(expense.date).toLocaleDateString()}</td>
                            <td>${expense.category}</td>
                            <td>${expense.description}</td>
                            <td>${expense.amount.toLocaleString()} ر.س</td>
                            <td>${paymentMethodText}</td>
                            <td>${expense.beneficiary || '-'}</td>
                            <td>${expense.notes || '-'}</td>
                            <td class="actions-cell">
                                <i class="fas fa-edit action-icon edit-icon" data-id="${expense.id}"></i>
                                <i class="fas fa-trash action-icon delete-icon" data-id="${expense.id}"></i>
                                <i class="fas fa-print action-icon print-icon" data-id="${expense.id}"></i>
                            </td>
                        `;

                        tbody.appendChild(row);
                    });

                    // تحديث معلومات الصفحة
                    document.querySelector('#expensesContent .pagination-info').textContent =
                        `عرض 1-${expenses.length} من ${expenses.length} مصروفات`;
                })
                .catch(error => console.error('خطأ في تحميل بيانات المصروفات:', error));
        }

        // Expense Modal
        const expenseModal = document.getElementById('expenseModal');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        const closeExpenseModal = document.getElementById('closeExpenseModal');
        const cancelExpenseBtn = document.getElementById('cancelExpenseBtn');
        const saveExpenseBtn = document.getElementById('saveExpenseBtn');

        // فتح نافذة إضافة مصروف جديد
        addExpenseBtn.addEventListener('click', function() {
            // إعادة تعيين النموذج
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expenseDate').value = today;
            document.getElementById('expenseCategory').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expensePaymentMethod').value = 'cash';
            document.getElementById('expenseBeneficiary').value = '';
            document.getElementById('expenseReference').value = '';
            document.getElementById('expenseNotes').value = '';

            // إعادة تعيين معرف المصروف الحالي
            currentExpenseId = null;

            // تغيير عنوان النافذة
            document.querySelector('#expenseModal .modal-title').textContent = 'إضافة مصروف جديد';

            // عرض النافذة
            expenseModal.style.display = 'flex';
        });

        // إغلاق نافذة المصروف
        closeExpenseModal.addEventListener('click', function() {
            expenseModal.style.display = 'none';
        });

        cancelExpenseBtn.addEventListener('click', function() {
            expenseModal.style.display = 'none';
        });

        // حفظ المصروف (إضافة أو تعديل)
        saveExpenseBtn.addEventListener('click', function() {
            // الحصول على قيم النموذج
            const date = document.getElementById('expenseDate').value;
            const category = document.getElementById('expenseCategory').value;
            const description = document.getElementById('expenseDescription').value;
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const paymentMethod = document.getElementById('expensePaymentMethod').value;
            const beneficiary = document.getElementById('expenseBeneficiary').value;
            const reference = document.getElementById('expenseReference').value;
            const notes = document.getElementById('expenseNotes').value;

            // التحقق من صحة النموذج
            if (!date || !category || !description || isNaN(amount) || amount <= 0) {
                alert('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            // إنشاء كائن المصروف
            const expense = {
                date: new Date(date),
                category,
                description,
                amount,
                paymentMethod,
                beneficiary,
                reference,
                notes,
                createdAt: new Date()
            };

            // إذا كان تعديل، أضف المعرف
            if (currentExpenseId) {
                expense.id = currentExpenseId;
                expense.updatedAt = new Date();

                // تحديث المصروف
                window.db.expenses.update(expense)
                    .then(() => {
                        console.log('تم تحديث المصروف بنجاح');

                        // إعادة تحميل بيانات المصروفات
                        loadExpensesData();

                        // إغلاق النافذة
                        expenseModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في تحديث المصروف:', error);
                        alert('حدث خطأ في تحديث المصروف: ' + error.message);
                    });
            } else {
                // إضافة المصروف إلى قاعدة البيانات
                window.db.expenses.add(expense)
                    .then(id => {
                        console.log('تم إضافة المصروف بنجاح، المعرف:', id);

                        // إعادة تحميل بيانات المصروفات
                        loadExpensesData();

                        // إغلاق النافذة وإعادة تعيين النموذج
                        expenseModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في إضافة المصروف:', error);
                        alert('حدث خطأ في إضافة المصروف: ' + error.message);
                    });
            }
        });

        // تحميل بيانات المصروف للتعديل
        function loadExpenseForEdit(id) {
            window.db.expenses.getById(id)
                .then(expense => {
                    if (!expense) {
                        alert('المصروف غير موجود');
                        return;
                    }

                    // تعيين معرف المصروف الحالي
                    currentExpenseId = expense.id;

                    // ملء النموذج ببيانات المصروف
                    document.getElementById('expenseDate').value = new Date(expense.date).toISOString().split('T')[0];
                    document.getElementById('expenseCategory').value = expense.category;
                    document.getElementById('expenseDescription').value = expense.description;
                    document.getElementById('expenseAmount').value = expense.amount;
                    document.getElementById('expensePaymentMethod').value = expense.paymentMethod;
                    document.getElementById('expenseBeneficiary').value = expense.beneficiary || '';
                    document.getElementById('expenseReference').value = expense.reference || '';
                    document.getElementById('expenseNotes').value = expense.notes || '';

                    // تغيير عنوان النافذة
                    document.querySelector('#expenseModal .modal-title').textContent = 'تعديل المصروف';

                    // عرض النافذة
                    expenseModal.style.display = 'flex';
                })
                .catch(error => {
                    console.error('خطأ في تحميل بيانات المصروف:', error);
                    alert('حدث خطأ في تحميل بيانات المصروف');
                });
        }

        // حذف مصروف
        function deleteExpense(id) {
            if (confirm('هل أنت متأكد من حذف هذا المصروف؟')) {
                window.db.expenses.delete(id)
                    .then(() => {
                        console.log('تم حذف المصروف بنجاح');

                        // إعادة تحميل بيانات المصروفات
                        loadExpensesData();
                    })
                    .catch(error => {
                        console.error('خطأ في حذف المصروف:', error);
                        alert('حدث خطأ في حذف المصروف: ' + error.message);
                    });
            }
        }

        // ======== وظائف نظام نقاط البيع ========

        // تحميل بيانات نقاط البيع
        function loadPosData() {
            // تحميل المنتجات
            window.db.products.getAll()
                .then(products => {
                    const productsContainer = document.getElementById('posProducts');
                    productsContainer.innerHTML = '';

                    products.forEach(product => {
                        // إنشاء عنصر المنتج
                        const productElement = document.createElement('div');
                        productElement.className = 'pos-product';
                        productElement.dataset.id = product.id;
                        productElement.dataset.name = product.name;
                        productElement.dataset.price = product.salePrice;
                        productElement.dataset.stock = product.stock || 0;

                        // إضافة صورة افتراضية
                        const productImage = document.createElement('img');
                        productImage.src = 'https://via.placeholder.com/80?text=' + encodeURIComponent(product.name.substring(0, 2));
                        productElement.appendChild(productImage);

                        // إضافة اسم المنتج
                        const productName = document.createElement('div');
                        productName.className = 'pos-product-name';
                        productName.textContent = product.name;
                        productElement.appendChild(productName);

                        // إضافة سعر المنتج
                        const productPrice = document.createElement('div');
                        productPrice.className = 'pos-product-price';
                        productPrice.textContent = product.salePrice.toLocaleString() + ' ر.س';
                        productElement.appendChild(productPrice);

                        // إضافة حدث النقر لإضافة المنتج إلى السلة
                        productElement.addEventListener('click', function() {
                            addToCart(product);
                        });

                        productsContainer.appendChild(productElement);
                    });
                })
                .catch(error => console.error('خطأ في تحميل المنتجات:', error));

            // تحميل العملاء
            window.db.customers.getAll()
                .then(customers => {
                    const customerSelect = document.getElementById('posCustomer');

                    // الاحتفاظ بالخيار الأول (عميل نقدي)
                    const cashOption = customerSelect.options[0];
                    customerSelect.innerHTML = '';
                    customerSelect.appendChild(cashOption);

                    customers.forEach(customer => {
                        const option = document.createElement('option');
                        option.value = customer.id;
                        option.textContent = customer.name;
                        customerSelect.appendChild(option);
                    });
                })
                .catch(error => console.error('خطأ في تحميل العملاء:', error));

            // تهيئة سلة المشتريات
            posCart = [];
            updateCartDisplay();
            updateTotals();
        }

        // إضافة منتج إلى السلة
        function addToCart(product) {
            // التحقق من وجود المنتج في السلة
            const existingItemIndex = posCart.findIndex(item => item.productId === product.id);

            if (existingItemIndex !== -1) {
                // زيادة الكمية إذا كان المنتج موجودًا بالفعل
                posCart[existingItemIndex].quantity += 1;
            } else {
                // إضافة المنتج إلى السلة
                posCart.push({
                    productId: product.id,
                    name: product.name,
                    price: product.salePrice,
                    quantity: 1,
                    total: product.salePrice
                });
            }

            // تحديث عرض السلة والإجماليات
            updateCartDisplay();
            updateTotals();
        }

        // تحديث عرض السلة
        function updateCartDisplay() {
            const cartItems = document.getElementById('posCartItems');
            cartItems.innerHTML = '';

            if (posCart.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = '<td colspan="5" style="text-align: center;">السلة فارغة</td>';
                cartItems.appendChild(emptyRow);
                return;
            }

            posCart.forEach((item, index) => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td>${item.name}</td>
                    <td>${item.price.toLocaleString()} ر.س</td>
                    <td>
                        <input type="number" class="cart-quantity" value="${item.quantity}" min="1" data-index="${index}">
                    </td>
                    <td>${(item.price * item.quantity).toLocaleString()} ر.س</td>
                    <td><i class="fas fa-trash remove-item" data-index="${index}"></i></td>
                `;

                cartItems.appendChild(row);
            });

            // إضافة أحداث تغيير الكمية
            document.querySelectorAll('.cart-quantity').forEach(input => {
                input.addEventListener('change', function() {
                    const index = parseInt(this.dataset.index);
                    const quantity = parseInt(this.value);

                    if (quantity > 0) {
                        posCart[index].quantity = quantity;
                        posCart[index].total = posCart[index].price * quantity;
                        updateCartDisplay();
                        updateTotals();
                    }
                });
            });

            // إضافة أحداث حذف العناصر
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    posCart.splice(index, 1);
                    updateCartDisplay();
                    updateTotals();
                });
            });
        }

        // تحديث الإجماليات
        function updateTotals() {
            const subtotal = posCart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const discountValue = parseFloat(document.getElementById('posDiscountValue').value) || 0;
            const discountType = document.getElementById('posDiscountType').value;

            let discount = 0;
            if (discountType === 'percentage') {
                discount = subtotal * (discountValue / 100);
            } else {
                discount = discountValue;
            }

            const afterDiscount = subtotal - discount;
            const tax = afterDiscount * 0.15; // ضريبة القيمة المضافة 15%
            const total = afterDiscount + tax;

            // تحديث العرض
            document.getElementById('posSubtotal').textContent = subtotal.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('posTax').textContent = tax.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('posTotal').textContent = total.toLocaleString() + ' ' + window.currencySymbol;

            // تحديث المدفوع والمتبقي
            updatePayment(total);
        }

        // تحديث المدفوع والمتبقي
        function updatePayment(total) {
            const paid = parseFloat(document.getElementById('posPaidAmount').value) || 0;
            const paymentMethod = document.getElementById('posPaymentMethod').value;

            let remaining = 0;
            let change = 0;

            if (paymentMethod === 'credit') {
                // في حالة الدفع الآجل، المتبقي هو الإجمالي
                remaining = total;
                document.getElementById('posPaidAmount').value = 0;
                document.getElementById('posPaidAmount').disabled = true;
            } else {
                document.getElementById('posPaidAmount').disabled = false;

                if (paid >= total) {
                    // في حالة الدفع الكامل، الباقي هو الفرق
                    change = paid - total;
                    remaining = 0;
                } else {
                    // في حالة الدفع الجزئي، المتبقي هو الفرق
                    remaining = total - paid;
                    change = 0;
                }
            }

            document.getElementById('posRemainingAmount').textContent = remaining.toLocaleString() + ' ' + window.currencySymbol;
            document.getElementById('posChangeAmount').textContent = change.toLocaleString() + ' ' + window.currencySymbol;
        }

        // أحداث نظام نقاط البيع

        // تغيير طريقة الدفع
        document.getElementById('posPaymentMethod').addEventListener('change', function() {
            const total = parseFloat(document.getElementById('posTotal').textContent.replace(/[^\d.-]/g, '')) || 0;
            updatePayment(total);
        });

        // تغيير قيمة المدفوع
        document.getElementById('posPaidAmount').addEventListener('input', function() {
            const total = parseFloat(document.getElementById('posTotal').textContent.replace(/[^\d.-]/g, '')) || 0;
            updatePayment(total);
        });

        // تغيير قيمة الخصم أو نوعه
        document.getElementById('posDiscountValue').addEventListener('input', updateTotals);
        document.getElementById('posDiscountType').addEventListener('change', updateTotals);

        // البحث عن المنتجات
        document.getElementById('posSearchInput').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const products = document.querySelectorAll('.pos-product');

            products.forEach(product => {
                const name = product.dataset.name.toLowerCase();
                const id = product.dataset.id;

                if (name.includes(searchTerm) || id.toString().includes(searchTerm)) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
        });

        // تصفية المنتجات حسب الفئة
        document.querySelectorAll('.pos-category').forEach(button => {
            button.addEventListener('click', function() {
                // إزالة الفئة النشطة من جميع الأزرار
                document.querySelectorAll('.pos-category').forEach(btn => {
                    btn.classList.remove('active');
                });

                // إضافة الفئة النشطة للزر المحدد
                this.classList.add('active');

                const category = this.dataset.category;
                const products = document.querySelectorAll('.pos-product');

                if (category === 'all') {
                    // عرض جميع المنتجات
                    products.forEach(product => {
                        product.style.display = 'block';
                    });
                } else {
                    // عرض المنتجات حسب الفئة
                    products.forEach(product => {
                        if (product.dataset.category === category) {
                            product.style.display = 'block';
                        } else {
                            product.style.display = 'none';
                        }
                    });
                }
            });
        });

        // إضافة عميل جديد من نقاط البيع
        document.getElementById('addPosCustomerBtn').addEventListener('click', function() {
            // فتح نافذة إضافة عميل
            document.getElementById('customerCode').value = '';
            document.getElementById('customerName').value = '';
            document.getElementById('customerContact').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('customerBalance').value = '';

            // إعادة تعيين معرف العميل الحالي
            currentCustomerId = null;

            // تغيير عنوان النافذة
            document.querySelector('#customerModal .modal-title').textContent = 'إضافة عميل جديد';

            // عرض النافذة
            document.getElementById('customerModal').style.display = 'flex';
        });

        // إلغاء عملية البيع
        document.getElementById('posCancelBtn').addEventListener('click', function() {
            if (posCart.length > 0) {
                if (confirm('هل أنت متأكد من إلغاء عملية البيع؟')) {
                    posCart = [];
                    updateCartDisplay();
                    updateTotals();
                    document.getElementById('posCustomer').value = '';
                    document.getElementById('posDiscountValue').value = 0;
                    document.getElementById('posDiscountType').value = 'percentage';
                    document.getElementById('posPaymentMethod').value = 'cash';
                    document.getElementById('posPaidAmount').value = 0;
                }
            }
        });

        // حفظ عملية البيع
        document.getElementById('posSaveBtn').addEventListener('click', function() {
            savePos(false);
        });

        // إتمام عملية البيع
        document.getElementById('posPayBtn').addEventListener('click', function() {
            savePos(true);
        });

        // ======== وظائف تصدير البيانات ========

        // تصدير البيانات إلى ملف Excel
        function exportToExcel(data, fileName, sheetName = 'Sheet1') {
            // إنشاء مصفوفة من البيانات
            const worksheet = XLSX.utils.json_to_sheet(data);

            // إنشاء مصنف عمل
            const workbook = XLSX.utils.book_new();

            // إضافة ورقة عمل إلى المصنف
            XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);

            // تصدير المصنف إلى ملف Excel
            XLSX.writeFile(workbook, fileName + '.xlsx');
        }

        // تصدير البيانات إلى ملف PDF
        function exportToPDF(data, columns, fileName, title) {
            // تهيئة jsPDF
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // إضافة دعم اللغة العربية
            doc.setFont('Helvetica', 'normal');
            doc.setR2L(true);

            // إضافة العنوان
            doc.setFontSize(18);
            doc.text(title, doc.internal.pageSize.width / 2, 15, { align: 'center' });

            // إضافة التاريخ
            doc.setFontSize(12);
            doc.text('تاريخ التصدير: ' + new Date().toLocaleDateString(), doc.internal.pageSize.width - 15, 25, { align: 'right' });

            // إنشاء جدول البيانات
            doc.autoTable({
                head: [columns.map(col => col.header)],
                body: data.map(item => columns.map(col => item[col.dataKey])),
                startY: 35,
                styles: {
                    font: 'Helvetica',
                    halign: 'right',
                    textColor: [0, 0, 0],
                    lineColor: [0, 0, 0],
                    lineWidth: 0.1
                },
                headStyles: {
                    fillColor: [0, 150, 136],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [240, 240, 240]
                },
                margin: { top: 35 }
            });

            // إضافة ترويسة وتذييل
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);

                // ترويسة
                doc.setFontSize(10);
                doc.text('نظام المحاسبة', 15, 10);

                // تذييل
                doc.setFontSize(10);
                doc.text('الصفحة ' + i + ' من ' + pageCount, doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 10, { align: 'center' });
            }

            // حفظ الملف
            doc.save(fileName + '.pdf');
        }

        // حفظ عملية البيع
        function savePos(isPaid) {
            // التحقق من وجود منتجات في السلة
            if (posCart.length === 0) {
                alert('لا يمكن إتمام عملية البيع. السلة فارغة.');
                return;
            }

            // الحصول على بيانات الفاتورة
            const customerId = document.getElementById('posCustomer').value;
            const subtotal = parseFloat(document.getElementById('posSubtotal').textContent.replace(/[^\d.-]/g, '')) || 0;
            const discountValue = parseFloat(document.getElementById('posDiscountValue').value) || 0;
            const discountType = document.getElementById('posDiscountType').value;
            const tax = parseFloat(document.getElementById('posTax').textContent.replace(/[^\d.-]/g, '')) || 0;
            const total = parseFloat(document.getElementById('posTotal').textContent.replace(/[^\d.-]/g, '')) || 0;
            const paymentMethod = document.getElementById('posPaymentMethod').value;
            const paid = isPaid ? (paymentMethod === 'credit' ? 0 : total) : 0;
            const remaining = isPaid ? (paymentMethod === 'credit' ? total : 0) : total;

            // إنشاء كائن الفاتورة
            const invoice = {
                type: 'sale',
                invoiceNumber: 'POS-' + new Date().getTime(),
                date: new Date(),
                customerId: customerId || null,
                subtotal: subtotal,
                discount: discountType === 'percentage' ? (subtotal * (discountValue / 100)) : discountValue,
                tax: tax,
                total: total,
                paid: paid,
                remaining: remaining,
                paymentMethod: paymentMethod,
                status: isPaid ? (remaining > 0 ? 'partial' : 'paid') : 'unpaid',
                notes: 'تم إنشاؤها من نظام نقاط البيع',
                createdAt: new Date()
            };

            // إنشاء بنود الفاتورة
            const items = posCart.map(item => ({
                productId: item.productId,
                quantity: item.quantity,
                price: item.price,
                discount: 0,
                tax: item.price * item.quantity * 0.15,
                total: item.price * item.quantity
            }));

            // حفظ الفاتورة
            window.db.invoices.add(invoice, items)
                .then(id => {
                    console.log('تم إنشاء الفاتورة بنجاح، المعرف:', id);

                    // إعادة تعيين نقاط البيع
                    posCart = [];
                    updateCartDisplay();
                    updateTotals();
                    document.getElementById('posCustomer').value = '';
                    document.getElementById('posDiscountValue').value = 0;
                    document.getElementById('posDiscountType').value = 'percentage';
                    document.getElementById('posPaymentMethod').value = 'cash';
                    document.getElementById('posPaidAmount').value = 0;

                    // عرض رسالة نجاح
                    alert('تم إنشاء الفاتورة بنجاح');
                })
                .catch(error => {
                    console.error('خطأ في إنشاء الفاتورة:', error);
                    alert('حدث خطأ في إنشاء الفاتورة: ' + error.message);
                });
        }

        // Supplier Modal
        const supplierModal = document.getElementById('supplierModal');
        const addSupplierBtn = document.getElementById('addSupplierBtn');
        const closeSupplierModal = document.getElementById('closeSupplierModal');
        const cancelSupplierBtn = document.getElementById('cancelSupplierBtn');
        const saveSupplierBtn = document.getElementById('saveSupplierBtn');

        // فتح نافذة إضافة مورد جديد
        addSupplierBtn.addEventListener('click', function() {
            // إعادة تعيين النموذج
            document.getElementById('supplierCode').value = '';
            document.getElementById('supplierName').value = '';
            document.getElementById('supplierContact').value = '';
            document.getElementById('supplierPhone').value = '';
            document.getElementById('supplierEmail').value = '';
            document.getElementById('supplierAddress').value = '';
            document.getElementById('supplierBalance').value = '';
            document.getElementById('supplierNotes').value = '';

            // إعادة تعيين معرف المورد الحالي
            currentSupplierId = null;

            // تغيير عنوان النافذة
            document.querySelector('#supplierModal .modal-title').textContent = 'إضافة مورد جديد';

            // عرض النافذة
            supplierModal.style.display = 'flex';
        });

        // إغلاق نافذة المورد
        closeSupplierModal.addEventListener('click', function() {
            supplierModal.style.display = 'none';
        });

        cancelSupplierBtn.addEventListener('click', function() {
            supplierModal.style.display = 'none';
        });

        // حفظ المورد (إضافة أو تعديل)
        saveSupplierBtn.addEventListener('click', function() {
            // الحصول على قيم النموذج
            const code = document.getElementById('supplierCode').value;
            const name = document.getElementById('supplierName').value;
            const contactPerson = document.getElementById('supplierContact').value;
            const phone = document.getElementById('supplierPhone').value;
            const email = document.getElementById('supplierEmail').value;
            const address = document.getElementById('supplierAddress').value;
            const balance = parseFloat(document.getElementById('supplierBalance').value) || 0;
            const notes = document.getElementById('supplierNotes').value;

            // التحقق من صحة النموذج
            if (!code || !name) {
                alert('الرجاء إدخال جميع الحقول المطلوبة');
                return;
            }

            // إنشاء كائن المورد
            const supplier = {
                code,
                name,
                contactPerson,
                phone,
                email,
                address,
                balance,
                notes,
                isActive: true,
                createdAt: new Date()
            };

            // إذا كان تعديل، أضف المعرف
            if (currentSupplierId) {
                supplier.id = currentSupplierId;
                supplier.updatedAt = new Date();

                // تحديث المورد
                window.db.suppliers.update(supplier)
                    .then(() => {
                        console.log('تم تحديث المورد بنجاح');

                        // إعادة تحميل بيانات الموردين
                        loadSuppliersData();

                        // إغلاق النافذة
                        supplierModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في تحديث المورد:', error);
                        alert('حدث خطأ في تحديث المورد: ' + error.message);
                    });
            } else {
                // إضافة المورد إلى قاعدة البيانات
                window.db.suppliers.add(supplier)
                    .then(id => {
                        console.log('تم إضافة المورد بنجاح، المعرف:', id);

                        // إعادة تحميل بيانات الموردين
                        loadSuppliersData();

                        // إغلاق النافذة وإعادة تعيين النموذج
                        supplierModal.style.display = 'none';
                    })
                    .catch(error => {
                        console.error('خطأ في إضافة المورد:', error);
                        alert('حدث خطأ في إضافة المورد: ' + error.message);
                    });
            }
        });

        // تحميل بيانات المورد للتعديل
        function loadSupplierForEdit(id) {
            window.db.suppliers.getById(id)
                .then(supplier => {
                    if (!supplier) {
                        alert('المورد غير موجود');
                        return;
                    }

                    // تعيين معرف المورد الحالي
                    currentSupplierId = supplier.id;

                    // ملء النموذج ببيانات المورد
                    document.getElementById('supplierCode').value = supplier.code;
                    document.getElementById('supplierName').value = supplier.name;
                    document.getElementById('supplierContact').value = supplier.contactPerson || '';
                    document.getElementById('supplierPhone').value = supplier.phone || '';
                    document.getElementById('supplierEmail').value = supplier.email || '';
                    document.getElementById('supplierAddress').value = supplier.address || '';
                    document.getElementById('supplierBalance').value = supplier.balance || 0;
                    document.getElementById('supplierNotes').value = supplier.notes || '';

                    // تغيير عنوان النافذة
                    document.querySelector('#supplierModal .modal-title').textContent = 'تعديل المورد';

                    // عرض النافذة
                    supplierModal.style.display = 'flex';
                })
                .catch(error => {
                    console.error('خطأ في تحميل بيانات المورد:', error);
                    alert('حدث خطأ في تحميل بيانات المورد');
                });
        }

        // حذف مورد
        function deleteSupplier(id) {
            if (confirm('هل أنت متأكد من حذف هذا المورد؟')) {
                window.db.suppliers.delete(id)
                    .then(() => {
                        console.log('تم حذف المورد بنجاح');

                        // إعادة تحميل بيانات الموردين
                        loadSuppliersData();
                    })
                    .catch(error => {
                        console.error('خطأ في حذف المورد:', error);
                        alert('حدث خطأ في حذف المورد: ' + error.message);
                    });
            }
        }

        // أحداث تصدير البيانات

        // تصدير المنتجات إلى Excel
        document.getElementById('exportProductsExcel').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.products.getAll()
                .then(products => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = products.map(product => ({
                        'الكود': product.code,
                        'الباركود': product.barcode || '',
                        'اسم المنتج': product.name,
                        'الوحدة': product.unit,
                        'سعر الشراء': product.purchasePrice,
                        'سعر البيع': product.salePrice,
                        'المخزون': product.stock || 0,
                        'حد الطلب': product.minStock || 0,
                        'القيمة': (product.stock || 0) * product.purchasePrice
                    }));

                    // تصدير البيانات
                    exportToExcel(exportData, 'المنتجات', 'المنتجات');
                })
                .catch(error => {
                    console.error('خطأ في تصدير المنتجات:', error);
                    alert('حدث خطأ في تصدير المنتجات');
                });
        });

        // تصدير المنتجات إلى PDF
        document.getElementById('exportProductsPDF').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.products.getAll()
                .then(products => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = products.map(product => ({
                        code: product.code,
                        barcode: product.barcode || '',
                        name: product.name,
                        unit: product.unit,
                        purchasePrice: product.purchasePrice,
                        salePrice: product.salePrice,
                        stock: product.stock || 0,
                        minStock: product.minStock || 0,
                        value: (product.stock || 0) * product.purchasePrice
                    }));

                    // تعريف الأعمدة
                    const columns = [
                        { header: 'الكود', dataKey: 'code' },
                        { header: 'الباركود', dataKey: 'barcode' },
                        { header: 'اسم المنتج', dataKey: 'name' },
                        { header: 'الوحدة', dataKey: 'unit' },
                        { header: 'سعر الشراء', dataKey: 'purchasePrice' },
                        { header: 'سعر البيع', dataKey: 'salePrice' },
                        { header: 'المخزون', dataKey: 'stock' },
                        { header: 'حد الطلب', dataKey: 'minStock' },
                        { header: 'القيمة', dataKey: 'value' }
                    ];

                    // تصدير البيانات
                    exportToPDF(exportData, columns, 'المنتجات', 'تقرير المنتجات');
                })
                .catch(error => {
                    console.error('خطأ في تصدير المنتجات:', error);
                    alert('حدث خطأ في تصدير المنتجات');
                });
        });

        // تصدير العملاء إلى Excel
        document.getElementById('exportCustomersExcel').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.customers.getAll()
                .then(customers => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = customers.map(customer => ({
                        'الكود': customer.code,
                        'اسم العميل': customer.name,
                        'جهة الاتصال': customer.contactPerson || '',
                        'رقم الهاتف': customer.phone || '',
                        'البريد الإلكتروني': customer.email || '',
                        'العنوان': customer.address || '',
                        'الرصيد': customer.balance || 0
                    }));

                    // تصدير البيانات
                    exportToExcel(exportData, 'العملاء', 'العملاء');
                })
                .catch(error => {
                    console.error('خطأ في تصدير العملاء:', error);
                    alert('حدث خطأ في تصدير العملاء');
                });
        });

        // تصدير العملاء إلى PDF
        document.getElementById('exportCustomersPDF').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.customers.getAll()
                .then(customers => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = customers.map(customer => ({
                        code: customer.code,
                        name: customer.name,
                        contactPerson: customer.contactPerson || '',
                        phone: customer.phone || '',
                        email: customer.email || '',
                        address: customer.address || '',
                        balance: customer.balance || 0
                    }));

                    // تعريف الأعمدة
                    const columns = [
                        { header: 'الكود', dataKey: 'code' },
                        { header: 'اسم العميل', dataKey: 'name' },
                        { header: 'جهة الاتصال', dataKey: 'contactPerson' },
                        { header: 'رقم الهاتف', dataKey: 'phone' },
                        { header: 'البريد الإلكتروني', dataKey: 'email' },
                        { header: 'العنوان', dataKey: 'address' },
                        { header: 'الرصيد', dataKey: 'balance' }
                    ];

                    // تصدير البيانات
                    exportToPDF(exportData, columns, 'العملاء', 'تقرير العملاء');
                })
                .catch(error => {
                    console.error('خطأ في تصدير العملاء:', error);
                    alert('حدث خطأ في تصدير العملاء');
                });
        });

        // تصدير الموردين إلى Excel
        document.getElementById('exportSuppliersExcel').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.suppliers.getAll()
                .then(suppliers => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = suppliers.map(supplier => ({
                        'الكود': supplier.code,
                        'اسم المورد': supplier.name,
                        'جهة الاتصال': supplier.contactPerson || '',
                        'رقم الهاتف': supplier.phone || '',
                        'البريد الإلكتروني': supplier.email || '',
                        'العنوان': supplier.address || '',
                        'الرصيد': supplier.balance || 0
                    }));

                    // تصدير البيانات
                    exportToExcel(exportData, 'الموردين', 'الموردين');
                })
                .catch(error => {
                    console.error('خطأ في تصدير الموردين:', error);
                    alert('حدث خطأ في تصدير الموردين');
                });
        });

        // تصدير الموردين إلى PDF
        document.getElementById('exportSuppliersPDF').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.suppliers.getAll()
                .then(suppliers => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = suppliers.map(supplier => ({
                        code: supplier.code,
                        name: supplier.name,
                        contactPerson: supplier.contactPerson || '',
                        phone: supplier.phone || '',
                        email: supplier.email || '',
                        address: supplier.address || '',
                        balance: supplier.balance || 0
                    }));

                    // تعريف الأعمدة
                    const columns = [
                        { header: 'الكود', dataKey: 'code' },
                        { header: 'اسم المورد', dataKey: 'name' },
                        { header: 'جهة الاتصال', dataKey: 'contactPerson' },
                        { header: 'رقم الهاتف', dataKey: 'phone' },
                        { header: 'البريد الإلكتروني', dataKey: 'email' },
                        { header: 'العنوان', dataKey: 'address' },
                        { header: 'الرصيد', dataKey: 'balance' }
                    ];

                    // تصدير البيانات
                    exportToPDF(exportData, columns, 'الموردين', 'تقرير الموردين');
                })
                .catch(error => {
                    console.error('خطأ في تصدير الموردين:', error);
                    alert('حدث خطأ في تصدير الموردين');
                });
        });

        // تصدير المصروفات إلى Excel
        document.getElementById('exportExpensesExcel').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.expenses.getAll()
                .then(expenses => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = expenses.map(expense => {
                        let paymentMethodText = '';
                        switch (expense.paymentMethod) {
                            case 'cash':
                                paymentMethodText = 'نقدي';
                                break;
                            case 'bank':
                                paymentMethodText = 'تحويل بنكي';
                                break;
                            case 'check':
                                paymentMethodText = 'شيك';
                                break;
                            case 'card':
                                paymentMethodText = 'بطاقة ائتمان';
                                break;
                            default:
                                paymentMethodText = expense.paymentMethod;
                        }

                        return {
                            'التاريخ': new Date(expense.date).toLocaleDateString(),
                            'الفئة': expense.category,
                            'الوصف': expense.description,
                            'المبلغ': expense.amount,
                            'طريقة الدفع': paymentMethodText,
                            'المستفيد': expense.beneficiary || '',
                            'المرجع': expense.reference || '',
                            'ملاحظات': expense.notes || ''
                        };
                    });

                    // تصدير البيانات
                    exportToExcel(exportData, 'المصروفات', 'المصروفات');
                })
                .catch(error => {
                    console.error('خطأ في تصدير المصروفات:', error);
                    alert('حدث خطأ في تصدير المصروفات');
                });
        });

        // تصدير المصروفات إلى PDF
        document.getElementById('exportExpensesPDF').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.expenses.getAll()
                .then(expenses => {
                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = expenses.map(expense => {
                        let paymentMethodText = '';
                        switch (expense.paymentMethod) {
                            case 'cash':
                                paymentMethodText = 'نقدي';
                                break;
                            case 'bank':
                                paymentMethodText = 'تحويل بنكي';
                                break;
                            case 'check':
                                paymentMethodText = 'شيك';
                                break;
                            case 'card':
                                paymentMethodText = 'بطاقة ائتمان';
                                break;
                            default:
                                paymentMethodText = expense.paymentMethod;
                        }

                        return {
                            date: new Date(expense.date).toLocaleDateString(),
                            category: expense.category,
                            description: expense.description,
                            amount: expense.amount,
                            paymentMethod: paymentMethodText,
                            beneficiary: expense.beneficiary || '',
                            reference: expense.reference || '',
                            notes: expense.notes || ''
                        };
                    });

                    // تعريف الأعمدة
                    const columns = [
                        { header: 'التاريخ', dataKey: 'date' },
                        { header: 'الفئة', dataKey: 'category' },
                        { header: 'الوصف', dataKey: 'description' },
                        { header: 'المبلغ', dataKey: 'amount' },
                        { header: 'طريقة الدفع', dataKey: 'paymentMethod' },
                        { header: 'المستفيد', dataKey: 'beneficiary' },
                        { header: 'المرجع', dataKey: 'reference' },
                        { header: 'ملاحظات', dataKey: 'notes' }
                    ];

                    // تصدير البيانات
                    exportToPDF(exportData, columns, 'المصروفات', 'تقرير المصروفات');
                })
                .catch(error => {
                    console.error('خطأ في تصدير المصروفات:', error);
                    alert('حدث خطأ في تصدير المصروفات');
                });
        });

        // تصدير المبيعات إلى Excel
        document.getElementById('exportSalesExcel').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.invoices.getAll()
                .then(invoices => {
                    // تصفية الفواتير للحصول على فواتير المبيعات فقط
                    const salesInvoices = invoices.filter(invoice => invoice.type === 'sale');

                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = salesInvoices.map(invoice => {
                        let statusText = '';
                        switch (invoice.status) {
                            case 'paid':
                                statusText = 'مدفوعة';
                                break;
                            case 'partial':
                                statusText = 'مدفوعة جزئياً';
                                break;
                            case 'unpaid':
                                statusText = 'غير مدفوعة';
                                break;
                            default:
                                statusText = invoice.status;
                        }

                        return {
                            'رقم الفاتورة': invoice.invoiceNumber,
                            'التاريخ': new Date(invoice.date).toLocaleDateString(),
                            'العميل': invoice.customerName || 'عميل نقدي',
                            'إجمالي الفاتورة': invoice.total,
                            'المدفوع': invoice.paid,
                            'المتبقي': invoice.remaining,
                            'الحالة': statusText
                        };
                    });

                    // تصدير البيانات
                    exportToExcel(exportData, 'المبيعات', 'المبيعات');
                })
                .catch(error => {
                    console.error('خطأ في تصدير المبيعات:', error);
                    alert('حدث خطأ في تصدير المبيعات');
                });
        });

        // تصدير المبيعات إلى PDF
        document.getElementById('exportSalesPDF').addEventListener('click', function(e) {
            e.preventDefault();

            window.db.invoices.getAll()
                .then(invoices => {
                    // تصفية الفواتير للحصول على فواتير المبيعات فقط
                    const salesInvoices = invoices.filter(invoice => invoice.type === 'sale');

                    // تحويل البيانات إلى تنسيق مناسب للتصدير
                    const exportData = salesInvoices.map(invoice => {
                        let statusText = '';
                        switch (invoice.status) {
                            case 'paid':
                                statusText = 'مدفوعة';
                                break;
                            case 'partial':
                                statusText = 'مدفوعة جزئياً';
                                break;
                            case 'unpaid':
                                statusText = 'غير مدفوعة';
                                break;
                            default:
                                statusText = invoice.status;
                        }

                        return {
                            invoiceNumber: invoice.invoiceNumber,
                            date: new Date(invoice.date).toLocaleDateString(),
                            customer: invoice.customerName || 'عميل نقدي',
                            total: invoice.total,
                            paid: invoice.paid,
                            remaining: invoice.remaining,
                            status: statusText
                        };
                    });

                    // تعريف الأعمدة
                    const columns = [
                        { header: 'رقم الفاتورة', dataKey: 'invoiceNumber' },
                        { header: 'التاريخ', dataKey: 'date' },
                        { header: 'العميل', dataKey: 'customer' },
                        { header: 'إجمالي الفاتورة', dataKey: 'total' },
                        { header: 'المدفوع', dataKey: 'paid' },
                        { header: 'المتبقي', dataKey: 'remaining' },
                        { header: 'الحالة', dataKey: 'status' }
                    ];

                    // تصدير البيانات
                    exportToPDF(exportData, columns, 'المبيعات', 'تقرير المبيعات');
                })
                .catch(error => {
                    console.error('خطأ في تصدير المبيعات:', error);
                    alert('حدث خطأ في تصدير المبيعات');
                });
        });

        // وظائف النسخ الاحتياطي واستعادة البيانات

        // إنشاء نسخة احتياطية
        document.getElementById('createBackupBtn').addEventListener('click', function() {
            // إنشاء نسخة احتياطية من جميع البيانات
            window.db.backup.create()
                .then(backupData => {
                    // تحويل البيانات إلى سلسلة JSON
                    const jsonData = JSON.stringify(backupData, null, 2);

                    // إنشاء ملف للتنزيل
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // إنشاء رابط وهمي للتنزيل
                    const a = document.createElement('a');
                    a.href = url;

                    // تعيين اسم الملف بالتاريخ الحالي
                    const date = new Date();
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    a.download = `backup-${formattedDate}.json`;

                    // إضافة الرابط إلى المستند والنقر عليه
                    document.body.appendChild(a);
                    a.click();

                    // إزالة الرابط من المستند
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);

                    alert('تم إنشاء النسخة الاحتياطية بنجاح');
                })
                .catch(error => {
                    console.error('خطأ في إنشاء النسخة الاحتياطية:', error);
                    alert('حدث خطأ في إنشاء النسخة الاحتياطية');
                });
        });

        // اختيار ملف النسخة الاحتياطية
        document.getElementById('selectRestoreFileBtn').addEventListener('click', function() {
            document.getElementById('restoreFile').click();
        });

        // تحديث اسم الملف المختار
        document.getElementById('restoreFile').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('selectedFileName').textContent = file.name;
                document.getElementById('restoreBackupBtn').disabled = false;
            } else {
                document.getElementById('selectedFileName').textContent = 'لم يتم اختيار ملف';
                document.getElementById('restoreBackupBtn').disabled = true;
            }
        });

        // إعادة تعيين قاعدة البيانات
        document.getElementById('resetDbBtn').addEventListener('click', function() {
            // التأكيد قبل إعادة تعيين قاعدة البيانات
            if (!confirm('تحذير: سيتم حذف جميع البيانات الحالية نهائياً. هل أنت متأكد من المتابعة؟')) {
                return;
            }

            if (!confirm('تأكيد نهائي: هذا الإجراء لا يمكن التراجع عنه. هل أنت متأكد من حذف جميع البيانات؟')) {
                return;
            }

            // استدعاء وظيفة حذف قاعدة البيانات
            window.db.deleteDatabase()
                .then(() => {
                    alert('تم حذف قاعدة البيانات بنجاح. سيتم إعادة تحميل الصفحة.');
                    // إعادة تحميل الصفحة
                    window.location.reload();
                })
                .catch(error => {
                    console.error('خطأ في حذف قاعدة البيانات:', error);
                    alert('حدث خطأ في حذف قاعدة البيانات: ' + error.message);
                });
        });

        // استعادة البيانات من نسخة احتياطية
        document.getElementById('restoreBackupBtn').addEventListener('click', function() {
            const file = document.getElementById('restoreFile').files[0];
            if (!file) {
                alert('الرجاء اختيار ملف النسخة الاحتياطية أولاً');
                return;
            }

            // التأكيد قبل استعادة البيانات
            if (!confirm('سيتم استبدال جميع البيانات الحالية بالبيانات من النسخة الاحتياطية. هل أنت متأكد من المتابعة؟')) {
                return;
            }

            // قراءة الملف
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // تحليل البيانات من الملف
                    const backupData = JSON.parse(e.target.result);

                    // استعادة البيانات
                    window.db.backup.restore(backupData)
                        .then(() => {
                            alert('تم استعادة البيانات بنجاح. سيتم إعادة تحميل الصفحة.');

                            // إعادة تحميل الصفحة لتطبيق التغييرات
                            window.location.reload();
                        })
                        .catch(error => {
                            console.error('خطأ في استعادة البيانات:', error);
                            alert('حدث خطأ في استعادة البيانات: ' + error.message);
                        });
                } catch (error) {
                    console.error('خطأ في قراءة ملف النسخة الاحتياطية:', error);
                    alert('ملف النسخة الاحتياطية غير صالح');
                }
            };

            reader.readAsText(file);
        });

        // تصدير جميع البيانات
        document.getElementById('exportAllDataBtn').addEventListener('click', function() {
            window.db.backup.create()
                .then(backupData => {
                    // تحويل البيانات إلى سلسلة JSON
                    const jsonData = JSON.stringify(backupData, null, 2);

                    // إنشاء ملف للتنزيل
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // إنشاء رابط وهمي للتنزيل
                    const a = document.createElement('a');
                    a.href = url;

                    // تعيين اسم الملف بالتاريخ الحالي
                    const date = new Date();
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    a.download = `all-data-${formattedDate}.json`;

                    // إضافة الرابط إلى المستند والنقر عليه
                    document.body.appendChild(a);
                    a.click();

                    // إزالة الرابط من المستند
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error('خطأ في تصدير البيانات:', error);
                    alert('حدث خطأ في تصدير البيانات');
                });
        });

        // تصدير بيانات المنتجات
        document.getElementById('exportProductsDataBtn').addEventListener('click', function() {
            window.db.products.getAll()
                .then(products => {
                    // تحويل البيانات إلى سلسلة JSON
                    const jsonData = JSON.stringify(products, null, 2);

                    // إنشاء ملف للتنزيل
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // إنشاء رابط وهمي للتنزيل
                    const a = document.createElement('a');
                    a.href = url;

                    // تعيين اسم الملف بالتاريخ الحالي
                    const date = new Date();
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    a.download = `products-${formattedDate}.json`;

                    // إضافة الرابط إلى المستند والنقر عليه
                    document.body.appendChild(a);
                    a.click();

                    // إزالة الرابط من المستند
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error('خطأ في تصدير بيانات المنتجات:', error);
                    alert('حدث خطأ في تصدير بيانات المنتجات');
                });
        });

        // تصدير بيانات العملاء
        document.getElementById('exportCustomersDataBtn').addEventListener('click', function() {
            window.db.customers.getAll()
                .then(customers => {
                    // تحويل البيانات إلى سلسلة JSON
                    const jsonData = JSON.stringify(customers, null, 2);

                    // إنشاء ملف للتنزيل
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // إنشاء رابط وهمي للتنزيل
                    const a = document.createElement('a');
                    a.href = url;

                    // تعيين اسم الملف بالتاريخ الحالي
                    const date = new Date();
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    a.download = `customers-${formattedDate}.json`;

                    // إضافة الرابط إلى المستند والنقر عليه
                    document.body.appendChild(a);
                    a.click();

                    // إزالة الرابط من المستند
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error('خطأ في تصدير بيانات العملاء:', error);
                    alert('حدث خطأ في تصدير بيانات العملاء');
                });
        });

        // تصدير بيانات الموردين
        document.getElementById('exportSuppliersDataBtn').addEventListener('click', function() {
            window.db.suppliers.getAll()
                .then(suppliers => {
                    // تحويل البيانات إلى سلسلة JSON
                    const jsonData = JSON.stringify(suppliers, null, 2);

                    // إنشاء ملف للتنزيل
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // إنشاء رابط وهمي للتنزيل
                    const a = document.createElement('a');
                    a.href = url;

                    // تعيين اسم الملف بالتاريخ الحالي
                    const date = new Date();
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    a.download = `suppliers-${formattedDate}.json`;

                    // إضافة الرابط إلى المستند والنقر عليه
                    document.body.appendChild(a);
                    a.click();

                    // إزالة الرابط من المستند
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error('خطأ في تصدير بيانات الموردين:', error);
                    alert('حدث خطأ في تصدير بيانات الموردين');
                });
        });

        // تصدير بيانات الفواتير
        document.getElementById('exportInvoicesDataBtn').addEventListener('click', function() {
            window.db.invoices.getAll()
                .then(invoices => {
                    // تحويل البيانات إلى سلسلة JSON
                    const jsonData = JSON.stringify(invoices, null, 2);

                    // إنشاء ملف للتنزيل
                    const blob = new Blob([jsonData], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);

                    // إنشاء رابط وهمي للتنزيل
                    const a = document.createElement('a');
                    a.href = url;

                    // تعيين اسم الملف بالتاريخ الحالي
                    const date = new Date();
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    a.download = `invoices-${formattedDate}.json`;

                    // إضافة الرابط إلى المستند والنقر عليه
                    document.body.appendChild(a);
                    a.click();

                    // إزالة الرابط من المستند
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error('خطأ في تصدير بيانات الفواتير:', error);
                    alert('حدث خطأ في تصدير بيانات الفواتير');
                });
        });

        // أحداث علامات التبويب في صفحة الإعدادات والمخزون
        document.querySelectorAll('.tabs .tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // إزالة الفئة النشطة من جميع علامات التبويب في نفس المجموعة
                const tabsContainer = this.closest('.tabs');
                tabsContainer.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

                // إضافة الفئة النشطة إلى علامة التبويب المنقورة
                this.classList.add('active');

                // إخفاء جميع محتويات علامات التبويب في نفس المجموعة
                const tabContentsContainer = this.closest('.tabs-container');
                tabContentsContainer.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                // إظهار محتوى علامة التبويب المنقورة
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // أحداث تحميل الشعار
        document.getElementById('uploadLogoBtn').addEventListener('click', function() {
            document.getElementById('companyLogo').click();
        });

        document.getElementById('companyLogo').addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoPreview = document.getElementById('logoPreview');
                    logoPreview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 100%;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // حفظ الإعدادات
        document.getElementById('saveSettingsBtn').addEventListener('click', function() {
            const settings = {
                companyName: document.getElementById('companyName').value,
                companyAddress: document.getElementById('companyAddress').value,
                companyPhone: document.getElementById('companyPhone').value,
                companyEmail: document.getElementById('companyEmail').value,
                taxNumber: document.getElementById('taxNumber').value,
                taxRate: parseFloat(document.getElementById('taxRate').value) || 15,
                currency: document.getElementById('currency').value,
                currencySymbol: document.getElementById('currencySymbol').value,
                updatedAt: new Date()
            };

            // حفظ الإعدادات في التخزين المحلي
            localStorage.setItem('settings', JSON.stringify(settings));

            // تحديث رمز العملة في جميع أنحاء التطبيق
            window.currencySymbol = settings.currencySymbol;
            updateCurrencySymbols();

            alert('تم حفظ الإعدادات بنجاح');
        });

        // تحديث رموز العملة في جميع أنحاء التطبيق
        function updateCurrencySymbols() {
            // تحديث جميع العناصر التي تحتوي على رمز العملة
            const currencyElements = document.querySelectorAll('.currency-symbol');
            currencyElements.forEach(element => {
                element.textContent = window.currencySymbol;
            });

            // تحديث النصوص التي تحتوي على "ر.س" أو أي رمز عملة آخر
            const priceElements = document.querySelectorAll('.card-value, .summary-value, .item-total, .form-input[readonly]');
            priceElements.forEach(element => {
                // استخدام تعبير منتظم للبحث عن أي رمز عملة (مثل ر.س، د.ك، $، إلخ)
                const regex = /(\d[\d,\.]*)\s*([^\d\s]+)$/;
                if (element.textContent) {
                    if (regex.test(element.textContent)) {
                        element.textContent = element.textContent.replace(regex, '$1 ' + window.currencySymbol);
                    }
                } else if (element.value && regex.test(element.value)) {
                    element.value = element.value.replace(regex, '$1 ' + window.currencySymbol);
                }
            });
        }

        // تحميل الإعدادات
        function loadSettings() {
            window.db.settings.get()
                .then(settings => {
                    if (settings) {
                        document.getElementById('companyName').value = settings.companyName || '';
                        document.getElementById('companyAddress').value = settings.companyAddress || '';
                        document.getElementById('companyPhone').value = settings.companyPhone || '';
                        document.getElementById('companyEmail').value = settings.companyEmail || '';
                        document.getElementById('taxNumber').value = settings.taxNumber || '';
                        document.getElementById('taxRate').value = settings.taxRate || 15;
                        document.getElementById('currency').value = settings.currency || 'KWD';
                        document.getElementById('currencySymbol').value = settings.currencySymbol || 'د.ك';

                        // تطبيق رمز العملة في جميع أنحاء التطبيق
                        window.currencySymbol = settings.currencySymbol || 'د.ك';
                        updateCurrencySymbols();

                        if (settings.logo) {
                            const logoPreview = document.getElementById('logoPreview');
                            logoPreview.innerHTML = '';
                            const img = document.createElement('img');
                            img.src = settings.logo;
                            img.style.maxWidth = '100%';
                            img.style.maxHeight = '100%';
                            logoPreview.appendChild(img);
                        }
                    } else {
                        // إعدادات افتراضية
                        window.currencySymbol = 'د.ك';
                        updateCurrencySymbols();
                    }
                })
                .catch(error => console.error('خطأ في تحميل الإعدادات:', error));
        }

        // أحداث تسوية المخزون
        document.getElementById('adjustment-product').addEventListener('change', function() {
            const productId = this.value;
            if (!productId) {
                document.getElementById('adjustment-current-quantity').value = '';
                return;
            }

            // عرض الكمية الحالية للمنتج المحدد
            const currentStock = this.options[this.selectedIndex].dataset.stock;
            document.getElementById('adjustment-current-quantity').value = currentStock;
        });

        // حفظ تسوية المخزون
        document.getElementById('save-adjustment-btn').addEventListener('click', function() {
            const productId = document.getElementById('adjustment-product').value;
            const adjustmentType = document.getElementById('adjustment-type').value;
            const newQuantity = parseInt(document.getElementById('adjustment-new-quantity').value);
            const notes = document.getElementById('adjustment-notes').value;

            if (!productId) {
                alert('الرجاء اختيار منتج');
                return;
            }

            if (isNaN(newQuantity) || newQuantity < 0) {
                alert('الرجاء إدخال كمية صحيحة');
                return;
            }

            // الحصول على المنتج
            window.db.products.get(parseInt(productId))
                .then(product => {
                    if (!product) {
                        throw new Error('المنتج غير موجود');
                    }

                    // حساب الكمية الجديدة بناءً على نوع التسوية
                    let finalQuantity = 0;
                    let currentStock = product.stock || 0;

                    if (adjustmentType === 'set') {
                        finalQuantity = newQuantity;
                    } else if (adjustmentType === 'add') {
                        finalQuantity = currentStock + newQuantity;
                    } else if (adjustmentType === 'subtract') {
                        finalQuantity = Math.max(0, currentStock - newQuantity);
                    }

                    // تحديث مخزون المنتج
                    product.stock = finalQuantity;

                    // حفظ التغييرات
                    return window.db.products.update(product);
                })
                .then(() => {
                    // إضافة حركة مخزون جديدة
                    const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));

                    const transaction = {
                        productId: parseInt(productId),
                        productName: document.getElementById('adjustment-product').options[document.getElementById('adjustment-product').selectedIndex].text,
                        type: adjustmentType,
                        quantity: newQuantity,
                        date: new Date(),
                        userName: currentUser ? currentUser.name : 'مدير النظام',
                        notes: notes || 'تسوية مخزون'
                    };

                    return window.db.inventory.addTransaction(transaction);
                })
                .then(() => {
                    alert('تم تسوية المخزون بنجاح');

                    // إعادة تعيين النموذج
                    document.getElementById('adjustment-product').value = '';
                    document.getElementById('adjustment-current-quantity').value = '';
                    document.getElementById('adjustment-type').value = 'set';
                    document.getElementById('adjustment-new-quantity').value = '';
                    document.getElementById('adjustment-notes').value = '';

                    // تحديث بيانات المخزون
                    loadInventoryData();
                })
                .catch(error => {
                    console.error('خطأ في تسوية المخزون:', error);
                    alert('حدث خطأ في تسوية المخزون: ' + error.message);
                });
        });

        // Add event listeners for edit and delete icons
        document.addEventListener('click', function(event) {
            // تعديل عنصر
            if (event.target.classList.contains('edit-icon')) {
                const id = parseInt(event.target.getAttribute('data-id'));

                if (!id) {
                    alert('معرف العنصر غير صحيح');
                    return;
                }

                // تحديد نوع العنصر
                if (event.target.closest('#productsContent')) {
                    // تعديل منتج
                    loadProductForEdit(id);
                } else if (event.target.closest('#customersContent')) {
                    // تعديل عميل
                    loadCustomerForEdit(id);
                } else if (event.target.closest('#suppliersContent')) {
                    // تعديل مورد
                    loadSupplierForEdit(id);
                } else if (event.target.closest('#expensesContent')) {
                    // تعديل مصروف
                    loadExpenseForEdit(id);
                } else if (event.target.closest('#salesContent')) {
                    // تعديل فاتورة
                    alert('تعديل الفواتير غير متاح حالياً');
                }
            }

            // حذف عنصر
            if (event.target.classList.contains('delete-icon')) {
                const id = parseInt(event.target.getAttribute('data-id'));

                if (!id) {
                    // إذا كان في جدول بنود الفاتورة
                    if (event.target.closest('#invoiceItemsTable')) {
                        if (confirm('هل أنت متأكد من حذف هذا البند؟')) {
                            event.target.closest('tr').remove();
                            calculateInvoice();
                        }
                        return;
                    }

                    alert('معرف العنصر غير صحيح');
                    return;
                }

                // تحديد نوع العنصر
                if (event.target.closest('#productsContent')) {
                    // حذف منتج
                    deleteProduct(id);
                } else if (event.target.closest('#customersContent')) {
                    // حذف عميل
                    deleteCustomer(id);
                } else if (event.target.closest('#suppliersContent')) {
                    // حذف مورد
                    deleteSupplier(id);
                } else if (event.target.closest('#expensesContent')) {
                    // حذف مصروف
                    deleteExpense(id);
                } else if (event.target.closest('#salesContent')) {
                    // حذف فاتورة
                    if (confirm('هل أنت متأكد من حذف هذه الفاتورة؟')) {
                        window.db.invoices.delete(id)
                            .then(() => {
                                console.log('تم حذف الفاتورة بنجاح');
                                loadInvoicesData();
                            })
                            .catch(error => {
                                console.error('خطأ في حذف الفاتورة:', error);
                                alert('حدث خطأ في حذف الفاتورة');
                            });
                    }
                }
            }

            // إنشاء فاتورة لعميل
            if (event.target.classList.contains('invoice-icon')) {
                const id = parseInt(event.target.getAttribute('data-id'));

                if (!id) {
                    alert('معرف العميل غير صحيح');
                    return;
                }

                // تحميل بيانات العميل
                window.db.customers.getById(id)
                    .then(customer => {
                        if (!customer) {
                            alert('العميل غير موجود');
                            return;
                        }

                        // تعيين العميل في نافذة الفاتورة
                        const customerSelect = document.getElementById('invoiceCustomer');

                        // إضافة العميل إلى القائمة إذا لم يكن موجوداً
                        let found = false;
                        for (let i = 0; i < customerSelect.options.length; i++) {
                            if (parseInt(customerSelect.options[i].value) === customer.id) {
                                customerSelect.selectedIndex = i;
                                found = true;
                                break;
                            }
                        }

                        if (!found) {
                            const option = document.createElement('option');
                            option.value = customer.id;
                            option.text = customer.name;
                            customerSelect.add(option);
                            customerSelect.value = customer.id;
                        }

                        // فتح نافذة الفاتورة
                        document.getElementById('saleModal').style.display = 'flex';
                    })
                    .catch(error => {
                        console.error('خطأ في تحميل بيانات العميل:', error);
                        alert('حدث خطأ في تحميل بيانات العميل');
                    });
            }

            // عرض فاتورة
            if (event.target.classList.contains('view-icon')) {
                const id = parseInt(event.target.getAttribute('data-id'));

                if (!id) {
                    alert('معرف الفاتورة غير صحيح');
                    return;
                }

                alert('عرض تفاصيل الفاتورة غير متاح حالياً');
            }

            // طباعة فاتورة
            if (event.target.classList.contains('print-icon')) {
                const id = parseInt(event.target.getAttribute('data-id'));

                if (!id) {
                    alert('معرف الفاتورة غير صحيح');
                    return;
                }

                // الحصول على بيانات الفاتورة
                window.db.invoices.getWithItems(id)
                    .then(result => {
                        if (!result) {
                            alert('الفاتورة غير موجودة');
                            return;
                        }

                        const { invoice, items } = result;

                        // إنشاء نموذج الطباعة
                        createInvoicePrintTemplate(invoice, items);

                        // طباعة الفاتورة
                        window.print();
                    })
                    .catch(error => {
                        console.error('خطأ في تحميل بيانات الفاتورة:', error);
                        alert('حدث خطأ في تحميل بيانات الفاتورة');
                    });
            }

            // طباعة التقارير
            if (event.target.id === 'print-sales-report' ||
                event.target.id === 'print-inventory-report' ||
                event.target.id === 'print-customer-report' ||
                event.target.id === 'print-profit-report') {

                // تحديد القسم المراد طباعته
                let reportSection;

                switch (event.target.id) {
                    case 'print-sales-report':
                        reportSection = document.getElementById('sales-report');
                        break;
                    case 'print-inventory-report':
                        reportSection = document.getElementById('inventory-report');
                        break;
                    case 'print-customer-report':
                        reportSection = document.getElementById('customers-report');
                        break;
                    case 'print-profit-report':
                        reportSection = document.getElementById('profit-report');
                        break;
                }

                if (reportSection) {
                    // إضافة فئة الطباعة للقسم
                    reportSection.classList.add('print-section');

                    // إخفاء أزرار الطباعة والتصدير
                    const actionButtons = reportSection.querySelectorAll('.report-actions button');
                    actionButtons.forEach(button => button.classList.add('no-print'));

                    // طباعة التقرير
                    window.print();

                    // إزالة فئة الطباعة بعد الانتهاء
                    setTimeout(() => {
                        reportSection.classList.remove('print-section');
                        actionButtons.forEach(button => button.classList.remove('no-print'));
                    }, 1000);
                }
            }
        });

        // إنشاء نموذج طباعة الفاتورة
        function createInvoicePrintTemplate(invoice, items) {
            // إنشاء عنصر div للطباعة
            let printSection = document.getElementById('invoice-print-section');

            if (!printSection) {
                printSection = document.createElement('div');
                printSection.id = 'invoice-print-section';
                printSection.className = 'print-section';
                document.body.appendChild(printSection);
            }

            // تحديد حالة الفاتورة
            let statusText = '';

            if (invoice.remaining <= 0) {
                statusText = 'مدفوعة';
            } else if (invoice.paid > 0) {
                statusText = 'مدفوعة جزئياً';
            } else {
                statusText = 'غير مدفوعة';
            }

            // تنسيق التاريخ
            const invoiceDate = new Date(invoice.date).toLocaleDateString();

            // إنشاء محتوى الفاتورة
            const content = `
                <div class="invoice-print">
                    <div class="invoice-header">
                        <div class="company-info">
                            <h1>شركة أبو سليمان للتجارة</h1>
                            <p>الرياض - المملكة العربية السعودية</p>
                            <p>هاتف: 0555123456</p>
                            <p>البريد الإلكتروني: info@abosuliman.com</p>
                            <p>الرقم الضريبي: 123456789</p>
                        </div>
                        <div class="invoice-info">
                            <h2>فاتورة ${invoice.type === 'sale' ? 'مبيعات' : 'مشتريات'}</h2>
                            <p>رقم الفاتورة: ${invoice.invoiceNumber}</p>
                            <p>التاريخ: ${invoiceDate}</p>
                            <p>الحالة: ${statusText}</p>
                        </div>
                    </div>

                    <div class="customer-info">
                        <h3>معلومات العميل</h3>
                        <p>الاسم: ${invoice.customerName}</p>
                    </div>

                    <table class="invoice-items">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>المنتج</th>
                                <th>الكمية</th>
                                <th>السعر</th>
                                <th>الخصم</th>
                                <th>الإجمالي</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${items.map((item, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${item.productName}</td>
                                    <td>${item.quantity}</td>
                                    <td>${item.price.toLocaleString()} ر.س</td>
                                    <td>${item.discount.toLocaleString()} ر.س</td>
                                    <td>${item.total.toLocaleString()} ر.س</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>

                    <div class="invoice-summary">
                        <div class="summary-item">
                            <span>المجموع الفرعي:</span>
                            <span>${invoice.subtotal.toLocaleString()} ر.س</span>
                        </div>
                        <div class="summary-item">
                            <span>الخصم:</span>
                            <span>${invoice.discount.toLocaleString()} ر.س</span>
                        </div>
                        <div class="summary-item">
                            <span>ضريبة القيمة المضافة (15%):</span>
                            <span>${invoice.tax.toLocaleString()} ر.س</span>
                        </div>
                        <div class="summary-item total">
                            <span>الإجمالي:</span>
                            <span>${invoice.total.toLocaleString()} ر.س</span>
                        </div>
                        <div class="summary-item">
                            <span>المدفوع:</span>
                            <span>${invoice.paid.toLocaleString()} ر.س</span>
                        </div>
                        <div class="summary-item">
                            <span>المتبقي:</span>
                            <span>${invoice.remaining.toLocaleString()} ر.س</span>
                        </div>
                    </div>

                    <div class="invoice-notes">
                        <h3>ملاحظات</h3>
                        <p>${invoice.notes || 'لا توجد ملاحظات'}</p>
                    </div>

                    <div class="invoice-footer">
                        <p>شكراً لتعاملكم معنا</p>
                        <p>تم إنشاء هذه الفاتورة بواسطة نظام المحاسبة</p>
                    </div>
                </div>

                <style>
                    @media print {
                        body * {
                            visibility: hidden;
                        }

                        #invoice-print-section, #invoice-print-section * {
                            visibility: visible;
                        }

                        #invoice-print-section {
                            position: absolute;
                            left: 0;
                            top: 0;
                            width: 100%;
                        }

                        .invoice-print {
                            direction: rtl;
                            font-family: Arial, sans-serif;
                            padding: 20px;
                        }

                        .invoice-header {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #333;
                            padding-bottom: 20px;
                        }

                        .company-info h1 {
                            margin: 0 0 10px 0;
                            color: #009688;
                        }

                        .company-info p {
                            margin: 5px 0;
                        }

                        .invoice-info h2 {
                            margin: 0 0 10px 0;
                            color: #009688;
                        }

                        .invoice-info p {
                            margin: 5px 0;
                        }

                        .customer-info {
                            margin-bottom: 20px;
                            padding: 10px;
                            background-color: #f9f9f9;
                            border-radius: 5px;
                        }

                        .customer-info h3 {
                            margin: 0 0 10px 0;
                            color: #333;
                        }

                        .customer-info p {
                            margin: 5px 0;
                        }

                        .invoice-items {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 20px;
                        }

                        .invoice-items th, .invoice-items td {
                            border: 1px solid #ddd;
                            padding: 10px;
                            text-align: right;
                        }

                        .invoice-items th {
                            background-color: #f2f2f2;
                        }

                        .invoice-summary {
                            width: 50%;
                            margin-left: 0;
                            margin-right: auto;
                        }

                        .summary-item {
                            display: flex;
                            justify-content: space-between;
                            padding: 5px 0;
                            border-bottom: 1px solid #eee;
                        }

                        .summary-item.total {
                            font-weight: bold;
                            font-size: 1.2em;
                            border-bottom: 2px solid #333;
                            margin: 10px 0;
                            padding: 10px 0;
                        }

                        .invoice-notes {
                            margin-top: 30px;
                            padding: 10px;
                            background-color: #f9f9f9;
                            border-radius: 5px;
                        }

                        .invoice-notes h3 {
                            margin: 0 0 10px 0;
                            color: #333;
                        }

                        .invoice-footer {
                            margin-top: 50px;
                            text-align: center;
                            color: #777;
                            border-top: 1px solid #eee;
                            padding-top: 20px;
                        }
                    }
                </style>
            `;

            // تعيين المحتوى
            printSection.innerHTML = content;
        }
    </script>

    <!-- قاعدة البيانات -->
    <script src="database.js"></script>

    <!-- مكتبات تصدير البيانات -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- وظائف تصدير البيانات -->
    <script>
        // تصدير البيانات إلى Excel
        function exportToExcel(data, sheetName, fileName) {
            // إنشاء مصنف جديد
            const workbook = XLSX.utils.book_new();

            // تحويل البيانات إلى ورقة عمل
            const worksheet = XLSX.utils.json_to_sheet(data);

            // إضافة ورقة العمل إلى المصنف
            XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);

            // تصدير المصنف كملف Excel
            XLSX.writeFile(workbook, `${fileName}.xlsx`);
        }

        // تصدير البيانات إلى PDF
        function exportToPDF(data, columns, fileName, title) {
            // إنشاء مستند PDF جديد
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // landscape

            // إضافة العنوان
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            doc.text(title, doc.internal.pageSize.getWidth() / 2, 20, { align: 'center' });

            // إضافة التاريخ
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(10);
            const today = new Date().toLocaleDateString();
            doc.text(`تاريخ التقرير: ${today}`, doc.internal.pageSize.getWidth() - 20, 30, { align: 'right' });

            // إنشاء جدول البيانات
            doc.autoTable({
                head: [columns.map(col => col.header)],
                body: data.map(item => columns.map(col => item[col.dataKey])),
                startY: 40,
                theme: 'grid',
                styles: {
                    font: 'helvetica',
                    fontSize: 10,
                    cellPadding: 5,
                    overflow: 'linebreak',
                    halign: 'right'
                },
                headStyles: {
                    fillColor: [0, 150, 136],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [240, 240, 240]
                },
                margin: { top: 40 }
            });

            // حفظ الملف
            doc.save(`${fileName}.pdf`);
        }
    </script>
</body>
</html>
